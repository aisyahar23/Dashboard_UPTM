<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Graduate Analytics Dashboard | MARA Professional</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary-navy: #283E56;
            --primary-maroon: #970747;
            --primary-blue: #1989AC;
            --primary-beige: #FEF4E8;
            --text-dark: #1f2937;
            --text-medium: #6b7280;
            --text-light: #9ca3af;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--primary-beige);
            min-height: 100vh;
            color: var(--primary-navy);
        }
        
        .dashboard-container {
            background: white;
            border-radius: 16px;
            border: 1px solid rgba(40, 62, 86, 0.1);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        .glass-card {
            background: white;
            border: 1px solid rgba(40, 62, 86, 0.1);
            box-shadow: 0 2px 4px -1px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        
        .glass-card:hover {
            box-shadow: 0 8px 25px -5px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }
        
        .metric-card {
            background: white;
            border: 2px solid;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .metric-card.navy {
            border-color: var(--primary-navy);
        }
        
        .metric-card.maroon {
            border-color: var(--primary-maroon);
        }
        
        .metric-card.blue {
            border-color: var(--primary-blue);
        }
        
        .metric-card.beige {
            border-color: var(--primary-beige);
            background-color: var(--primary-beige);
        }
        
        .metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            border-radius: 8px 8px 0 0;
        }
        
        .metric-card.navy::before {
            background-color: var(--primary-navy);
        }
        
        .metric-card.maroon::before {
            background-color: var(--primary-maroon);
        }
        
        .metric-card.blue::before {
            background-color: var(--primary-blue);
        }
        
        .metric-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.15);
        }
        
        .chart-container {
            position: relative;
            height: 500px;
            padding: 24px;
            transition: all 0.3s ease;
        }
        
        .chart-container.large {
            height: 600px;
        }
        
        .chart-container.extra-large {
            height: 700px;
        }
        
        .chart-container.medium {
            height: 450px;
        }
        
        .chart-container:hover {
            transform: scale(1.01);
        }
        
        .filter-section {
            background: white;
            border: 1px solid rgba(40, 62, 86, 0.1);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 2px 4px -1px rgba(0, 0, 0, 0.1);
        }
        
        .filter-dropdown {
            background: white;
            border: 2px solid rgba(40, 62, 86, 0.2);
            border-radius: 8px;
            padding: 12px 16px;
            color: var(--primary-navy);
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .filter-dropdown:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(25, 137, 172, 0.1);
        }
        
        .tab-button {
            background: transparent;
            border: none;
            padding: 16px 24px;
            font-weight: 600;
            color: var(--text-medium);
            transition: all 0.3s ease;
            position: relative;
            border-radius: 12px;
        }
        
        .tab-button::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 0;
            height: 3px;
            background-color: var(--primary-blue);
            transition: all 0.3s ease;
            transform: translateX(-50%);
            border-radius: 2px;
        }
        
        .tab-button:hover {
            background-color: rgba(25, 137, 172, 0.1);
            color: var(--primary-blue);
            transform: translateY(-2px);
        }
        
        .tab-button:hover::after {
            width: 80%;
        }
        
        .tab-button.active {
            background-color: var(--primary-blue);
            color: white;
            box-shadow: 0 4px 12px rgba(25, 137, 172, 0.3);
        }
        
        .tab-button.active::after {
            width: 100%;
            background-color: rgba(255, 255, 255, 0.3)
        }
        
        .metric-icon {
            border-radius: 16px;
            width: 80px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 32px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transition: all 0.3s ease;
        }
        
        .metric-icon.navy {
            background-color: var(--primary-navy);
        }
        
        .metric-icon.maroon {
            background-color: var(--primary-maroon);
        }
        
        .metric-icon.blue {
            background-color: var(--primary-blue);
        }
        
        .metric-icon:hover {
            transform: rotate(5deg) scale(1.1);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }
        
        .progress-bar {
            height: 8px;
            border-radius: 4px;
            transition: width 2s ease;
            position: relative;
            overflow: hidden;
        }
        
        .progress-bar.navy {
            background-color: var(--primary-navy);
        }
        
        .progress-bar.maroon {
            background-color: var(--primary-maroon);
        }
        
        .progress-bar.blue {
            background-color: var(--primary-blue);
        }
        
        .chart-actions {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 8px;
            z-index: 10;
        }
        
        .chart-action-btn {
            background: white;
            border: 1px solid rgba(40, 62, 86, 0.2);
            border-radius: 8px;
            padding: 8px 12px;
            font-size: 12px;
            font-weight: 600;
            color: var(--primary-navy);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .chart-action-btn:hover {
            background-color: var(--primary-blue);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(25, 137, 172, 0.3);
        }
        
        .comparison-section {
            background: linear-gradient(135deg, rgba(25, 137, 172, 0.1), rgba(40, 62, 86, 0.05));
            border: 2px solid rgba(25, 137, 172, 0.2);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 4px 20px rgba(25, 137, 172, 0.1);
        }
        
        .comparison-toggle {
            background: linear-gradient(135deg, var(--primary-blue), var(--primary-navy));
            color: white;
            padding: 12px 24px;
            border-radius: 10px;
            font-weight: 700;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(25, 137, 172, 0.3);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .comparison-toggle:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(25, 137, 172, 0.4);
        }
        
        .comparison-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-top: 20px;
        }
        
        .comparison-card {
            background: white;
            border: 2px solid rgba(25, 137, 172, 0.3);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        
        .comparison-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }
        
        .floating-action {
            position: fixed;
            bottom: 32px;
            right: 32px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        
        .floating-btn {
            background-color: var(--primary-maroon);
            width: 68px;
            height: 68px;
            border-radius: 50%;
            box-shadow: 0 4px 12px rgba(151, 7, 71, 0.3);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
        }
        
        .floating-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 20px rgba(151, 7, 71, 0.4);
        }
        
        .notification {
            position: fixed;
            top: 24px;
            right: 24px;
            z-index: 1000;
            padding: 16px 24px;
            border-radius: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
            transform: translateX(100%);
            opacity: 0;
        }
        
        .notification.show {
            transform: translateX(0);
            opacity: 1;
        }
        
        .notification.success {
            background-color: var(--primary-blue);
            color: white;
        }
        
        .notification.error {
            background-color: var(--primary-maroon);
            color: white;
        }
        
        .modal {
            backdrop-filter: blur(10px);
            background: rgba(0, 0, 0, 0.5);
            transition: all 0.3s ease;
        }
        
        .modal-content {
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .text-navy {
            color: var(--primary-navy);
        }
        
        .text-maroon {
            color: var(--primary-maroon);
        }
        
        .text-blue {
            color: var(--primary-blue);
        }
        
        .bg-navy {
            background-color: var(--primary-navy);
        }
        
        .bg-maroon {
            background-color: var(--primary-maroon);
        }
        
        .bg-blue {
            background-color: var(--primary-blue);
        }
        
        .bg-beige {
            background-color: var(--primary-beige);
        }
        
        .border-navy {
            border-color: var(--primary-navy);
        }
        
        .border-maroon {
            border-color: var(--primary-maroon);
        }
        
        .border-blue {
            border-color: var(--primary-blue);
        }
        
        .animate-fade-in {
            animation: fadeIn 0.8s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .filter-badge {
            background-color: var(--primary-navy);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-right: 8px;
            display: inline-block;
        }
        
        .export-btn {
            background-color: var(--primary-blue);
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(25, 137, 172, 0.3);
        }
        
        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(25, 137, 172, 0.4);
        }
        
        .reset-btn {
            background-color: var(--primary-maroon);
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(151, 7, 71, 0.3);
        }
        
        .reset-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(151, 7, 71, 0.4);
        }
        
        .summary-card {
            background: white;
            border: 1px solid rgba(40, 62, 86, 0.1);
            border-radius: 12px;
            padding: 24px;
            margin: 16px 0;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .summary-title {
            color: var(--primary-navy);
            font-weight: 700;
            font-size: 18px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .summary-content {
            color: var(--text-medium);
            line-height: 1.6;
        }
        
        .key-metric {
            background-color: var(--primary-navy);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 14px;
            display: inline-block;
            margin: 4px 8px 4px 0;
        }
        
        .insight-card {
            background-color: rgba(25, 137, 172, 0.05);
            border: 1px solid rgba(25, 137, 172, 0.2);
            border-radius: 12px;
            padding: 20px;
            margin-top: 16px;
        }
        
        .loading-spinner {
            border: 4px solid rgba(40, 62, 86, 0.2);
            border-radius: 50%;
            border-top: 4px solid var(--primary-navy);
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .table-responsive {
            overflow-x: auto;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            background: white;
        }
        
        .table-hover:hover {
            background-color: rgba(25, 137, 172, 0.05);
            transform: scale(1.001);
            transition: all 0.2s ease;
        }
        
        @media (max-width: 768px) {
            .chart-container {
                height: 400px;
                padding: 16px;
            }
            
            .chart-container.large {
                height: 500px;
            }
            
            .chart-container.extra-large {
                height: 600px;
            }
            
            .metric-icon {
                width: 60px;
                height: 60px;
                font-size: 24px;
            }
            
            .floating-btn {
                width: 56px;
                height: 56px;
                font-size: 20px;
            }
        }
    </style>
</head>

<body class="bg-beige">
    <!-- Main Dashboard Container -->
    <div class="dashboard-container m-4 p-8">
        <!-- Header -->
        <div class="glass-card rounded-2xl p-8 mb-8">
            <div class="flex items-center justify-between flex-wrap gap-6">
                <div class="flex items-center space-x-6">
                    <div class="metric-icon navy">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div>
                        <h1 class="text-5xl font-black text-navy">Graduate Analytics Dashboard</h1>
                        <p class="text-xl font-medium text-gray-600 mt-2">MARA Professional College • Advanced Analytics Platform</p>
                    </div>
                </div>
                
                <div class="flex space-x-8">
                    <div class="text-center">
                        <p class="text-sm text-gray-500 font-medium">Total Graduates</p>
                        <p id="headerTotalGraduates" class="text-3xl font-black text-navy">-</p>
                    </div>
                    <div class="text-center">
                        <p class="text-sm text-gray-500 font-medium">Employment Rate</p>
                        <p id="headerEmploymentRate" class="text-3xl font-black text-blue">-</p>
                    </div>
                    <div class="text-center">
                        <p class="text-sm text-gray-500 font-medium">Status</p>
                        <div class="flex items-center justify-center space-x-2 mt-1">
                            <div class="w-3 h-3 bg-blue rounded-full animate-pulse"></div>
                            <span class="text-lg font-bold text-blue">LIVE</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Global Filter Section -->
        <div class="filter-section animate-fade-in">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold text-navy">
                    <i class="fas fa-filter mr-3 text-blue"></i>
                    Global Filters
                </h2>
                <div class="flex gap-4">
                    <button class="comparison-toggle" onclick="toggleComparison()">
                        <i class="fas fa-balance-scale mr-2"></i>
                        Comparison Mode
                    </button>
                    <button class="export-btn" onclick="exportFilteredData()">
                        <i class="fas fa-download mr-2"></i>
                        Export Data
                    </button>
                    <button class="reset-btn" onclick="resetFilters()">
                        <i class="fas fa-undo mr-2"></i>
                        Reset All
                    </button>
                </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4">
                <div>
                    <label class="block text-sm font-medium mb-2 text-navy">Graduation Year</label>
                    <select id="yearFilter" class="filter-dropdown w-full" onchange="applyGlobalFilter()">
                        <option value="">All Years</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2 text-navy">Study Field</label>
                    <select id="fieldFilter" class="filter-dropdown w-full" onchange="applyGlobalFilter()">
                        <option value="">All Fields</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2 text-navy">Employment Status</label>
                    <select id="employmentFilter" class="filter-dropdown w-full" onchange="applyGlobalFilter()">
                        <option value="">All Status</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2 text-navy">Gender</label>
                    <select id="genderFilter" class="filter-dropdown w-full" onchange="applyGlobalFilter()">
                        <option value="">All Genders</option>
                        <option value="Lelaki">Male</option>
                        <option value="Perempuan">Female</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2 text-navy">Institution</label>
                    <select id="institutionFilter" class="filter-dropdown w-full" onchange="applyGlobalFilter()">
                        <option value="">All Institutions</option>
                    </select>
                </div>
            </div>
            
            <div id="activeFilters" class="mt-4 flex flex-wrap gap-2"></div>
        </div>

        <!-- Enhanced Comparison Mode Section -->
        <div id="comparisonMode" class="comparison-section hidden">
            <h3 class="text-2xl font-bold mb-6 text-navy flex items-center">
                <i class="fas fa-chart-line mr-3 text-blue"></i>
                Advanced Comparison Analysis
            </h3>
            
            <div class="comparison-controls">
                <div class="comparison-card">
                    <h4 class="font-bold text-navy mb-3">📊 Year Comparison</h4>
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="block text-sm font-medium mb-2 text-navy">Year 1</label>
                            <select id="compareYear1" class="filter-dropdown w-full" onchange="updateComparison()">
                                <option value="">Select Year</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2 text-navy">Year 2</label>
                            <select id="compareYear2" class="filter-dropdown w-full" onchange="updateComparison()">
                                <option value="">Select Year</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="comparison-card">
                    <h4 class="font-bold text-navy mb-3">🎓 Field Comparison</h4>
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="block text-sm font-medium mb-2 text-navy">Field 1</label>
                            <select id="compareField1" class="filter-dropdown w-full" onchange="updateComparison()">
                                <option value="">Select Field</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2 text-navy">Field 2</label>
                            <select id="compareField2" class="filter-dropdown w-full" onchange="updateComparison()">
                                <option value="">Select Field</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="comparison-card">
                    <h4 class="font-bold text-navy mb-3">🏢 Institution Comparison</h4>
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="block text-sm font-medium mb-2 text-navy">Institution 1</label>
                            <select id="compareInst1" class="filter-dropdown w-full" onchange="updateComparison()">
                                <option value="">Select Institution</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2 text-navy">Institution 2</label>
                            <select id="compareInst2" class="filter-dropdown w-full" onchange="updateComparison()">
                                <option value="">Select Institution</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Comparison Results -->
            <div id="comparisonResults" class="mt-6 hidden">
                <div class="glass-card rounded-xl p-6">
                    <h4 class="text-xl font-bold text-navy mb-4">📈 Comparison Results</h4>
                    <div id="comparisonSummary" class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <!-- Dynamic comparison results will be displayed here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Summary Metrics -->
        <div class="py-6">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <div class="metric-card navy rounded-xl p-6 animate-fade-in">
                    <div class="flex items-center justify-between">
                        <div class="flex-1">
                            <p class="text-sm text-gray-500 font-medium">Total Graduates</p>
                            <p id="totalGraduates" class="text-4xl font-black mt-2 text-navy">-</p>
                            <div class="mt-4">
                                <div class="w-full bg-gray-200 rounded-full h-2">
                                    <div class="progress-bar navy h-2 rounded-full" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                        <div class="metric-icon navy">
                            <i class="fas fa-graduation-cap"></i>
                        </div>
                    </div>
                </div>

                <div class="metric-card blue rounded-xl p-6 animate-fade-in" style="animation-delay: 0.1s">
                    <div class="flex items-center justify-between">
                        <div class="flex-1">
                            <p class="text-sm text-gray-500 font-medium">Employment Rate</p>
                            <p id="employmentRate" class="text-4xl font-black mt-2 text-blue">-</p>
                            <div class="mt-4">
                                <div class="w-full bg-gray-200 rounded-full h-2">
                                    <div class="progress-bar blue h-2 rounded-full" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                        <div class="metric-icon blue">
                            <i class="fas fa-briefcase"></i>
                        </div>
                    </div>
                </div>

                <div class="metric-card maroon rounded-xl p-6 animate-fade-in" style="animation-delay: 0.2s">
                    <div class="flex items-center justify-between">
                        <div class="flex-1">
                            <p class="text-sm text-gray-500 font-medium">Study Fields</p>
                            <p id="fieldsCount" class="text-4xl font-black mt-2 text-maroon">-</p>
                            <div class="mt-4">
                                <div class="w-full bg-gray-200 rounded-full h-2">
                                    <div class="progress-bar maroon h-2 rounded-full" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                        <div class="metric-icon maroon">
                            <i class="fas fa-university"></i>
                        </div>
                    </div>
                </div>

                <div class="metric-card navy rounded-xl p-6 animate-fade-in" style="animation-delay: 0.3s">
                    <div class="flex items-center justify-between">
                        <div class="flex-1">
                            <p class="text-sm text-gray-500 font-medium">Graduation Years</p>
                            <p id="yearRange" class="text-4xl font-black mt-2 text-navy">-</p>
                            <div class="mt-4">
                                <div class="w-full bg-gray-200 rounded-full h-2">
                                    <div class="progress-bar navy h-2 rounded-full" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                        <div class="metric-icon navy">
                            <i class="fas fa-calendar-alt"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Navigation Tabs -->
        <div class="mb-8">
            <div class="glass-card rounded-xl p-2">
                <div class="flex flex-wrap gap-2">
                    <button class="tab-button active" data-tab="overview">
                        <i class="fas fa-tachometer-alt mr-2"></i>Overview
                    </button>
                    <button class="tab-button" data-tab="employment">
                        <i class="fas fa-chart-pie mr-2"></i>Employment
                    </button>
                    <button class="tab-button" data-tab="salary">
                        <i class="fas fa-dollar-sign mr-2"></i>Salary
                    </button>
                    <button class="tab-button" data-tab="out-of-field">
                        <i class="fas fa-exchange-alt mr-2"></i>Out-of-Field
                    </button>
                    <button class="tab-button" data-tab="challenges">
                        <i class="fas fa-exclamation-triangle mr-2"></i>Insights
                    </button>
                </div>
            </div>
        </div>

        <!-- Tab Content -->
        <div class="pb-20">
            <!-- Overview Tab -->
            <div id="overview" class="tab-content">
                <div class="grid grid-cols-1 xl:grid-cols-2 gap-8 mb-8">
                    <div class="glass-card rounded-2xl overflow-hidden">
                        <div class="p-6 bg-blue bg-opacity-5 border-b border-gray-200">
                            <div class="flex items-center justify-between">
                                <div>
                                    <h3 class="text-2xl font-bold text-navy">Employment Status</h3>
                                    <p class="text-gray-600 mt-1">Current employment distribution</p>
                                </div>
                            </div>
                        </div>
                        <div class="chart-wrapper">
                            <div class="chart-actions">
                                <button class="chart-action-btn" onclick="showSummary('employment-status')">
                                    <i class="fas fa-chart-pie mr-1"></i>Summary
                                </button>
                                <button class="chart-action-btn" onclick="showTableModal('employment-status')">
                                    <i class="fas fa-table mr-1"></i>Table
                                </button>
                            </div>
                            <div class="chart-container large">
                                <canvas id="employmentStatusChart"></canvas>
                            </div>
                        </div>
                        <div id="employmentstatusSummary" class="summary-card hidden">
                            <div class="summary-title">
                                <i class="fas fa-lightbulb text-blue"></i>
                                Employment Status Analysis
                            </div>
                            <div class="summary-content">
                                <p>Employment analysis will appear here based on the current data.</p>
                            </div>
                        </div>
                    </div>

                    <div class="glass-card rounded-2xl overflow-hidden">
                        <div class="p-6 bg-maroon bg-opacity-5 border-b border-gray-200">
                            <div class="flex items-center justify-between">
                                <div>
                                    <h3 class="text-2xl font-bold text-navy">Job Types</h3>
                                    <p class="text-gray-600 mt-1">Distribution of employment types</p>
                                </div>
                            </div>
                        </div>
                        <div class="chart-wrapper">
                            <div class="chart-actions">
                                <button class="chart-action-btn" onclick="showSummary('job-types')">
                                    <i class="fas fa-chart-bar mr-1"></i>Summary
                                </button>
                                <button class="chart-action-btn" onclick="showTableModal('job-types')">
                                    <i class="fas fa-table mr-1"></i>Table
                                </button>
                            </div>
                            <div class="chart-container large">
                                <canvas id="jobTypesChart"></canvas>
                            </div>
                        </div>
                        <div id="jobtypesSummary" class="summary-card hidden">
                            <div class="summary-title">
                                <i class="fas fa-chart-bar text-blue"></i>
                                Job Types Analysis
                            </div>
                            <div class="summary-content">
                                <p>Job type distribution insights will appear here.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="glass-card rounded-2xl overflow-hidden">
                    <div class="p-6 bg-navy bg-opacity-5 border-b border-gray-200">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="text-2xl font-bold text-navy">Graduates by Field and Year</h3>
                                <p class="text-gray-600 mt-1">Trends across different study fields over time</p>
                            </div>
                        </div>
                    </div>
                    <div class="chart-wrapper">
                        <div class="chart-actions">
                            <button class="chart-action-btn" onclick="showSummary('field-year')">
                                <i class="fas fa-chart-line mr-1"></i>Summary
                            </button>
                            <button class="chart-action-btn" onclick="showTableModal('field-year')">
                                <i class="fas fa-table mr-1"></i>Table
                            </button>
                        </div>
                        <div class="chart-container extra-large">
                            <canvas id="fieldYearChart"></canvas>
                        </div>
                    </div>
                    <div id="fieldyearSummary" class="summary-card hidden">
                        <div class="summary-title">
                            <i class="fas fa-chart-line text-blue"></i>
                            Field & Year Trends Analysis
                        </div>
                        <div class="summary-content">
                            <p>Graduation trends analysis will appear here.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Employment Tab -->
            <div id="employment" class="tab-content hidden">
                <div class="grid grid-cols-1 xl:grid-cols-2 gap-8 mb-8">
                    <div class="glass-card rounded-2xl overflow-hidden">
                        <div class="p-6 bg-blue bg-opacity-5 border-b border-gray-200">
                            <h3 class="text-2xl font-bold text-navy">Time to Employment</h3>
                            <p class="text-gray-600 mt-1">Job search duration analysis</p>
                        </div>
                        <div class="chart-wrapper">
                            <div class="chart-actions">
                                <button class="chart-action-btn" onclick="showSummary('time-employment')">
                                    <i class="fas fa-clock mr-1"></i>Summary
                                </button>
                                <button class="chart-action-btn" onclick="showTableModal('time-employment')">
                                    <i class="fas fa-table mr-1"></i>Table
                                </button>
                            </div>
                            <div class="chart-container large">
                                <canvas id="timeEmploymentChart"></canvas>
                            </div>
                        </div>
                        <div id="timeemploymentSummary" class="summary-card hidden">
                            <div class="summary-title">
                                <i class="fas fa-clock text-blue"></i>
                                Time to Employment Analysis
                            </div>
                            <div class="summary-content">
                                <p>Employment duration analysis will appear here.</p>
                            </div>
                        </div>
                    </div>

                    <div class="glass-card rounded-2xl overflow-hidden">
                        <div class="p-6 bg-maroon bg-opacity-5 border-b border-gray-200">
                            <h3 class="text-2xl font-bold text-navy">Success Factors</h3>
                            <p class="text-gray-600 mt-1">Key factors leading to employment success</p>
                        </div>
                        <div class="chart-wrapper">
                            <div class="chart-actions">
                                <button class="chart-action-btn" onclick="showSummary('success-factors')">
                                    <i class="fas fa-star mr-1"></i>Summary
                                </button>
                            </div>
                            <div class="chart-container large">
                                <canvas id="successFactorsChart"></canvas>
                            </div>
                        </div>
                        <div id="successfactorsSummary" class="summary-card hidden">
                            <div class="summary-title">
                                <i class="fas fa-star text-blue"></i>
                                Success Factors Analysis
                            </div>
                            <div class="summary-content">
                                <p>Employment success factors will appear here.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="glass-card rounded-2xl overflow-hidden">
                    <div class="p-6 bg-navy bg-opacity-5 border-b border-gray-200">
                        <h3 class="text-2xl font-bold text-navy">Employment Sectors</h3>
                        <p class="text-gray-600 mt-1">Industry distribution and sector analysis</p>
                    </div>
                    <div class="chart-wrapper">
                        <div class="chart-actions">
                            <button class="chart-action-btn" onclick="showSummary('sectors')">
                                <i class="fas fa-industry mr-1"></i>Summary
                            </button>
                        </div>
                        <div class="chart-container extra-large">
                            <canvas id="sectorsChart"></canvas>
                        </div>
                    </div>
                    <div id="sectorsSummary" class="summary-card hidden">
                        <div class="summary-title">
                            <i class="fas fa-industry text-blue"></i>
                            Employment Sectors Analysis
                        </div>
                        <div class="summary-content">
                            <p>Industry sector distribution will appear here.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Salary Tab -->
            <div id="salary" class="tab-content hidden">
                <div class="grid grid-cols-1 xl:grid-cols-2 gap-8 mb-8">
                    <div class="glass-card rounded-2xl overflow-hidden">
                        <div class="p-6 bg-blue bg-opacity-5 border-b border-gray-200">
                            <h3 class="text-2xl font-bold text-navy">Current Salary</h3>
                            <p class="text-gray-600 mt-1">Monthly salary distribution</p>
                        </div>
                        <div class="chart-wrapper">
                            <div class="chart-actions">
                                <button class="chart-action-btn" onclick="showSummary('current-salary')">
                                    <i class="fas fa-dollar-sign mr-1"></i>Summary
                                </button>
                            </div>
                            <div class="chart-container large">
                                <canvas id="currentSalaryChart"></canvas>
                            </div>
                        </div>
                        <div id="currentsalarySummary" class="summary-card hidden">
                            <div class="summary-title">
                                <i class="fas fa-dollar-sign text-blue"></i>
                                Current Salary Analysis
                            </div>
                            <div class="summary-content">
                                <p>Current salary distribution analysis will appear here.</p>
                            </div>
                        </div>
                    </div>

                    <div class="glass-card rounded-2xl overflow-hidden">
                        <div class="p-6 bg-maroon bg-opacity-5 border-b border-gray-200">
                            <h3 class="text-2xl font-bold text-navy">Salary Expectations</h3>
                            <p class="text-gray-600 mt-1">Expected vs actual comparison</p>
                        </div>
                        <div class="chart-wrapper">
                            <div class="chart-actions">
                                <button class="chart-action-btn" onclick="showSummary('salary-expectations')">
                                    <i class="fas fa-chart-bar mr-1"></i>Summary
                                </button>
                            </div>
                            <div class="chart-container large">
                                <canvas id="salaryExpectationChart"></canvas>
                            </div>
                        </div>
                        <div id="salaryexpectationsSummary" class="summary-card hidden">
                            <div class="summary-title">
                                <i class="fas fa-chart-bar text-blue"></i>
                                Salary Expectations Analysis
                            </div>
                            <div class="summary-content">
                                <p>Expected vs actual salary comparison will appear here.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="glass-card rounded-2xl overflow-hidden">
                    <div class="p-6 bg-navy bg-opacity-5 border-b border-gray-200">
                        <h3 class="text-2xl font-bold text-navy">Salary by Field</h3>
                        <p class="text-gray-600 mt-1">Salary distribution across academic fields</p>
                    </div>
                    <div class="chart-wrapper">
                        <div class="chart-actions">
                            <button class="chart-action-btn" onclick="showSummary('salary-by-field')">
                                <i class="fas fa-graduation-cap mr-1"></i>Summary
                            </button>
                        </div>
                        <div class="chart-container extra-large">
                            <canvas id="salaryByFieldChart"></canvas>
                        </div>
                    </div>
                    <div id="salarybyieldSummary" class="summary-card hidden">
                        <div class="summary-title">
                            <i class="fas fa-graduation-cap text-blue"></i>
                            Salary by Field Analysis
                        </div>
                        <div class="summary-content">
                            <p>Field-specific salary analysis will appear here.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- NEW: Out-of-Field Tab -->
            <div id="out-of-field" class="tab-content hidden">
                <div class="grid grid-cols-1 xl:grid-cols-2 gap-8 mb-8">
                    <div class="glass-card rounded-2xl overflow-hidden">
                        <div class="p-6 bg-blue bg-opacity-5 border-b border-gray-200">
                            <h3 class="text-2xl font-bold text-navy">Out-of-Field Job Types</h3>
                            <p class="text-gray-600 mt-1">Focus on graduates working outside their field of study</p>
                        </div>
                        <div class="chart-wrapper">
                            <div class="chart-actions">
                                <button class="chart-action-btn" onclick="showSummary('out-of-field-jobs')">
                                    <i class="fas fa-exchange-alt mr-1"></i>Summary
                                </button>
                                <button class="chart-action-btn" onclick="showTableModal('out-of-field-jobs')">
                                    <i class="fas fa-table mr-1"></i>Table
                                </button>
                            </div>
                            <div class="chart-container large">
                                <canvas id="outOfFieldJobsChart"></canvas>
                            </div>
                        </div>
                        <div id="outoffieldSummary" class="summary-card hidden">
                            <div class="summary-title">
                                <i class="fas fa-exchange-alt text-blue"></i>
                                Out-of-Field Employment Analysis
                            </div>
                            <div class="summary-content">
                                <p>Analysis of graduates working outside their field of study will appear here.</p>
                            </div>
                        </div>
                    </div>

                    <div class="glass-card rounded-2xl overflow-hidden">
                        <div class="p-6 bg-maroon bg-opacity-5 border-b border-gray-200">
                            <h3 class="text-2xl font-bold text-navy">Main Reasons</h3>
                            <p class="text-gray-600 mt-1">Why graduates work outside their field</p>
                        </div>
                        <div class="chart-wrapper">
                            <div class="chart-actions">
                                <button class="chart-action-btn" onclick="showSummary('out-of-field-reasons')">
                                    <i class="fas fa-question-circle mr-1"></i>Summary
                                </button>
                                <button class="chart-action-btn" onclick="showTableModal('out-of-field-reasons')">
                                    <i class="fas fa-table mr-1"></i>Table
                                </button>
                            </div>
                            <div class="chart-container large">
                                <canvas id="outOfFieldReasonsChart"></canvas>
                            </div>
                        </div>
                        <div id="outoffieldreasonsSummary" class="summary-card hidden">
                            <div class="summary-title">
                                <i class="fas fa-question-circle text-blue"></i>
                                Out-of-Field Reasons Analysis
                            </div>
                            <div class="summary-content">
                                <p>Main reasons for working outside field of study will appear here.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="glass-card rounded-2xl overflow-hidden">
                    <div class="p-6 bg-navy bg-opacity-5 border-b border-gray-200">
                        <h3 class="text-2xl font-bold text-navy">Academic Skills Requirement</h3>
                        <p class="text-gray-600 mt-1">Whether out-of-field jobs still require academic skills</p>
                    </div>
                    <div class="chart-wrapper">
                        <div class="chart-actions">
                            <button class="chart-action-btn" onclick="showSummary('academic-skills-needed')">
                                <i class="fas fa-brain mr-1"></i>Summary
                            </button>
                            <button class="chart-action-btn" onclick="showTableModal('academic-skills-needed')">
                                <i class="fas fa-table mr-1"></i>Table
                            </button>
                        </div>
                        <div class="chart-container large">
                            <canvas id="academicSkillsChart"></canvas>
                        </div>
                    </div>
                    <div id="academicskillsSummary" class="summary-card hidden">
                        <div class="summary-title">
                            <i class="fas fa-brain text-blue"></i>
                            Academic Skills Requirement Analysis
                        </div>
                        <div class="summary-content">
                            <p>Analysis of academic skills requirement in out-of-field jobs will appear here.</p>
                        </div>
                    </div>
                </div>

                <!-- Out-of-Field Statistics Panel -->
                <div class="glass-card rounded-2xl p-8 bg-gradient-to-r from-blue-50 to-navy-50">
                    <h3 class="text-2xl font-bold text-navy mb-6 flex items-center">
                        <i class="fas fa-chart-pie mr-3 text-blue"></i>
                        Out-of-Field Employment Statistics
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="text-center">
                            <div class="text-4xl font-black text-blue mb-2" id="outOfFieldCount">-</div>
                            <div class="text-sm text-gray-600 font-medium">Total Out-of-Field</div>
                        </div>
                        <div class="text-center">
                            <div class="text-4xl font-black text-maroon mb-2" id="outOfFieldPercentage">-</div>
                            <div class="text-sm text-gray-600 font-medium">Percentage of Total</div>
                        </div>
                        <div class="text-center">
                            <div class="text-4xl font-black text-navy mb-2" id="skillsStillNeeded">-</div>
                            <div class="text-sm text-gray-600 font-medium">Skills Still Needed</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Challenges Tab -->
            <div id="challenges" class="tab-content hidden">
                <div class="grid grid-cols-1 xl:grid-cols-2 gap-8 mb-8">
                    <div class="glass-card rounded-2xl overflow-hidden">
                        <div class="p-6 bg-maroon bg-opacity-5 border-b border-gray-200">
                            <h3 class="text-2xl font-bold text-navy">Job Search Challenges</h3>
                            <p class="text-gray-600 mt-1">Main obstacles faced (12 categories)</p>
                        </div>
                        <div class="chart-wrapper">
                            <div class="chart-actions">
                                <button class="chart-action-btn" onclick="showSummary('challenges')">
                                    <i class="fas fa-exclamation-triangle mr-1"></i>Summary
                                </button>
                                <button class="chart-action-btn" onclick="showTableModal('challenges')">
                                    <i class="fas fa-table mr-1"></i>Table
                                </button>
                            </div>
                            <div class="chart-container large">
                                <canvas id="challengesChart"></canvas>
                            </div>
                        </div>
                        <div id="challengesSummary" class="summary-card hidden">
                            <div class="summary-title">
                                <i class="fas fa-exclamation-triangle text-blue"></i>
                                Job Search Challenges Analysis
                            </div>
                            <div class="summary-content">
                                <p>Main employment challenges will appear here.</p>
                            </div>
                        </div>
                    </div>

                    <div class="glass-card rounded-2xl overflow-hidden">
                        <div class="p-6 bg-navy bg-opacity-5 border-b border-gray-200">
                            <h3 class="text-2xl font-bold text-navy">Gig Economy</h3>
                            <p class="text-gray-600 mt-1">Freelance participation</p>
                        </div>
                        <div class="chart-wrapper">
                            <div class="chart-actions">
                                <button class="chart-action-btn" onclick="showSummary('gig-economy')">
                                    <i class="fas fa-laptop mr-1"></i>Summary
                                </button>
                            </div>
                            <div class="chart-container large">
                                <canvas id="gigEconomyChart"></canvas>
                            </div>
                        </div>
                        <div id="gigeconomySummary" class="summary-card hidden">
                            <div class="summary-title">
                                <i class="fas fa-laptop text-blue"></i>
                                Gig Economy Analysis
                            </div>
                            <div class="summary-content">
                                <p>Gig economy participation trends will appear here.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Professional Development Section -->
                <div class="grid grid-cols-1 xl:grid-cols-2 gap-8 mb-8">
                    <div class="glass-card rounded-2xl overflow-hidden">
                        <div class="p-6 bg-blue bg-opacity-5 border-b border-gray-200">
                            <h3 class="text-2xl font-bold text-navy">Professional Certifications</h3>
                            <p class="text-gray-600 mt-1">Additional qualifications</p>
                        </div>
                        <div class="chart-wrapper">
                            <div class="chart-actions">
                                <button class="chart-action-btn" onclick="showSummary('certifications')">
                                    <i class="fas fa-certificate mr-1"></i>Summary
                                </button>
                            </div>
                            <div class="chart-container large">
                                <canvas id="certificationsChart"></canvas>
                            </div>
                        </div>
                        <div id="certificationsSummary" class="summary-card hidden">
                            <div class="summary-title">
                                <i class="fas fa-certificate text-blue"></i>
                                Certifications Analysis
                            </div>
                            <div class="summary-content">
                                <p>Professional certifications impact will appear here.</p>
                            </div>
                        </div>
                    </div>

                    <div class="glass-card rounded-2xl overflow-hidden">
                        <div class="p-6 bg-maroon bg-opacity-5 border-b border-gray-200">
                            <h3 class="text-2xl font-bold text-navy">Internship Impact</h3>
                            <p class="text-gray-600 mt-1">Effect on employment</p>
                        </div>
                        <div class="chart-wrapper">
                            <div class="chart-actions">
                                <button class="chart-action-btn" onclick="showSummary('internship')">
                                    <i class="fas fa-handshake mr-1"></i>Summary
                                </button>
                            </div>
                            <div class="chart-container large">
                                <canvas id="internshipChart"></canvas>
                            </div>
                        </div>
                        <div id="internshipSummary" class="summary-card hidden">
                            <div class="summary-title">
                                <i class="fas fa-handshake text-blue"></i>
                                Internship Impact Analysis
                            </div>
                            <div class="summary-content">
                                <p>Internship impact on employment will appear here.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="glass-card rounded-2xl overflow-hidden mb-8">
                    <div class="p-6 bg-blue bg-opacity-5 border-b border-gray-200">
                        <h3 class="text-2xl font-bold text-navy">Support Needed</h3>
                        <p class="text-gray-600 mt-1">Types of support graduates need</p>
                    </div>
                    <div class="chart-wrapper">
                        <div class="chart-actions">
                            <button class="chart-action-btn" onclick="showSummary('support-needed')">
                                <i class="fas fa-hands-helping mr-1"></i>Summary
                            </button>
                        </div>
                        <div class="chart-container large">
                            <canvas id="supportNeededChart"></canvas>
                        </div>
                    </div>
                    <div id="supportneededSummary" class="summary-card hidden">
                        <div class="summary-title">
                            <i class="fas fa-hands-helping text-blue"></i>
                            Support Needed Analysis
                        </div>
                        <div class="summary-content">
                            <p>Graduate support requirements will appear here.</p>
                        </div>
                    </div>
                </div>

                <!-- Key Insights Section -->
                <div class="glass-card rounded-2xl p-8 bg-navy bg-opacity-5">
                    <h3 class="text-3xl font-bold text-navy mb-6">Key Insights & Recommendations</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div class="glass-card rounded-xl p-6 hover:shadow-xl transition-all duration-300">
                            <div class="flex items-center gap-4 mb-4">
                                <div class="w-12 h-12 bg-blue rounded-xl flex items-center justify-center text-white">
                                    <i class="fas fa-lightbulb"></i>
                                </div>
                                <h4 class="font-bold text-navy">Challenge Mitigation</h4>
                            </div>
                            <p class="text-gray-600">Address the top challenges identified in the 12-category analysis through targeted support programs.</p>
                        </div>
                        
                        <div class="glass-card rounded-xl p-6 hover:shadow-xl transition-all duration-300">
                            <div class="flex items-center gap-4 mb-4">
                                <div class="w-12 h-12 bg-maroon rounded-xl flex items-center justify-center text-white">
                                    <i class="fas fa-exchange-alt"></i>
                                </div>
                                <h4 class="font-bold text-navy">Out-of-Field Strategy</h4>
                            </div>
                            <p class="text-gray-600">Develop strategies to better align graduate skills with market demands and support career transitions.</p>
                        </div>
                        
                        <div class="glass-card rounded-xl p-6 hover:shadow-xl transition-all duration-300">
                            <div class="flex items-center gap-4 mb-4">
                                <div class="w-12 h-12 bg-navy rounded-xl flex items-center justify-center text-white">
                                    <i class="fas fa-graduation-cap"></i>
                                </div>
                                <h4 class="font-bold text-navy">Skills Enhancement</h4>
                            </div>
                            <p class="text-gray-600">Focus on developing transferable skills that remain valuable even in out-of-field employment.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for Table View -->
    <div id="dataModal" class="fixed inset-0 modal hidden z-50 flex items-center justify-center p-8">
        <div class="modal-content w-full max-w-7xl p-8">
            <div class="flex items-center justify-between mb-6">
                <h3 id="modalTitle" class="text-3xl font-bold text-navy">Data Table</h3>
                <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600 transition-colors text-2xl">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="table-responsive">
                <table id="dataTable" class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <!-- Dynamic headers -->
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        <!-- Dynamic content -->
                    </tbody>
                </table>
            </div>
            
            <div class="mt-6 flex justify-end space-x-4">
                <button onclick="exportTableData()" class="export-btn">
                    <i class="fas fa-download mr-2"></i>Export CSV
                </button>
                <button onclick="closeModal()" class="bg-gray-500 text-white px-6 py-3 rounded-lg hover:shadow-lg transition-all duration-300">
                    Close
                </button>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-50 hidden">
        <div class="glass-card rounded-2xl p-8 text-center">
            <div class="loading-spinner mx-auto mb-4"></div>
            <h3 class="text-2xl font-bold mb-2 text-navy">Loading Analytics...</h3>
            <p class="text-gray-600">Processing graduate data with AI insights</p>
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notificationContainer" class="fixed top-4 right-4 z-50 space-y-4"></div>

    <!-- Floating Action Buttons -->
    <div class="floating-action">
        <button class="floating-btn" title="Refresh Data" onclick="refreshAllData()">
            <i class="fas fa-sync-alt"></i>
        </button>
        <button class="floating-btn" title="Export Report" onclick="exportReport()">
            <i class="fas fa-file-pdf"></i>
        </button>
        <button class="floating-btn" title="Share Dashboard" onclick="shareDashboard()">
            <i class="fas fa-share-alt"></i>
        </button>
    </div>

    <script>
        // Global variables
        let currentData = {};
        let filteredData = {};
        let charts = {};
        let globalFilters = {
            year: '',
            field: '',
            employment: '',
            gender: '',
            institution: ''
        };
        
        // Color palette using the 3 specified colors
        const colors = {
            primary: '#283E56',      // Navy
            secondary: '#970747',    // Maroon
            accent: '#1989AC',       // Blue
            background: '#FEF4E8',   // Beige
            palette: [
                '#283E56', '#970747', '#1989AC', '#FEF4E8',
                '#283E56', '#970747', '#1989AC', '#FEF4E8',
                '#283E56', '#970747', '#1989AC', '#FEF4E8',
                '#283E56', '#970747', '#1989AC', '#FEF4E8'
            ]
        };

        // Modern chart defaults
        const chartDefaults = {
            responsive: true,
            maintainAspectRatio: false,
            interaction: {
                mode: 'index',
                intersect: false,
            },
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        padding: 20,
                        usePointStyle: true,
                        font: { family: 'Inter', size: 13, weight: '600' },
                        color: '#283E56',
                        boxWidth: 12,
                        boxHeight: 12,
                        generateLabels: function(chart) {
                            const data = chart.data;
                            if (data.labels.length && data.datasets.length) {
                                return data.labels.map((label, i) => {
                                    const meta = chart.getDatasetMeta(0);
                                    const dataset = data.datasets[0];
                                    const value = dataset.data[i];
                                    
                                    const truncatedLabel = label && label.length > 20 ? 
                                        label.substring(0, 17) + '...' : label;
                                    
                                    return {
                                        text: truncatedLabel,
                                        fillStyle: dataset.backgroundColor[i],
                                        strokeStyle: dataset.borderColor ? dataset.borderColor[i] : dataset.backgroundColor[i],
                                        lineWidth: 2,
                                        hidden: meta.data[i] ? meta.data[i].hidden : false,
                                        index: i
                                    };
                                });
                            }
                            return [];
                        }
                    }
                },
                tooltip: {
                    backgroundColor: 'rgba(255, 255, 255, 0.95)',
                    titleColor: '#283E56',
                    bodyColor: '#6b7280',
                    borderColor: '#e5e7eb',
                    borderWidth: 1,
                    cornerRadius: 12,
                    padding: 16,
                    titleFont: { family: 'Inter', size: 14, weight: '700' },
                    bodyFont: { family: 'Inter', size: 13, weight: '500' },
                    boxPadding: 8,
                    usePointStyle: true,
                    callbacks: {
                        title: function(context) {
                            const title = context[0].label;
                            return title;
                        },
                        label: function(context) {
                            let label = context.dataset.label || '';
                            if (label) {
                                label += ': ';
                            }
                            label += context.parsed.y !== undefined ? context.parsed.y : context.parsed;
                            
                            if (context.chart.config.type === 'doughnut' || context.chart.config.type === 'pie') {
                                const dataset = context.dataset;
                                const total = dataset.data.reduce((sum, val) => sum + val, 0);
                                const percentage = ((context.parsed / total) * 100).toFixed(1);
                                label += ` (${percentage}%)`;
                            }
                            
                            return label;
                        }
                    }
                }
            },
            animation: { 
                duration: 1500, 
                easing: 'easeInOutQuart'
            },
            scales: {
                x: {
                    ticks: {
                        color: '#6b7280',
                        font: { family: 'Inter', weight: '500', size: 11 },
                        maxRotation: 45,
                        minRotation: 0,
                        callback: function(value, index, values) {
                            const label = this.getLabelForValue(value);
                            if (label && label.length > 15) {
                                return label.substring(0, 12) + '...';
                            }
                            return label;
                        }
                    },
                    grid: { 
                        display: false,
                        color: '#f3f4f6'
                    }
                },
                y: {
                    ticks: {
                        color: '#6b7280',
                        font: { family: 'Inter', weight: '500', size: 11 },
                        callback: function(value, index, values) {
                            const label = this.getLabelForValue(value);
                            if (typeof label === 'string' && label.length > 20) {
                                return label.substring(0, 17) + '...';
                            }
                            return label;
                        }
                    },
                    grid: { color: '#f3f4f6' },
                    beginAtZero: true
                }
            },
            onHover: (event, activeElements) => {
                if (event.native && event.native.target) {
                    event.native.target.style.cursor = activeElements.length > 0 ? 'pointer' : 'default';
                }
            }
        };

        // Enhanced notification system
        function showNotification(message, type = 'success', duration = 4000) {
            const container = document.getElementById('notificationContainer');
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-triangle'} mr-2"></i>
                ${message}
            `;
            container.appendChild(notification);
            
            setTimeout(() => notification.classList.add('show'), 100);
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, duration);
        }

        // Loading functions
        function showLoading() {
            document.getElementById('loadingOverlay').classList.remove('hidden');
        }

        function hideLoading() {
            setTimeout(() => {
                document.getElementById('loadingOverlay').classList.add('hidden');
            }, 1000);
        }

        // Counter animation
        function animateCounter(element, target, suffix = '', duration = 2000) {
            if (!element) return;
            let current = 0;
            const increment = target / (duration / 16);
            const timer = setInterval(() => {
                current += increment;
                if (current >= target) {
                    current = target;
                    clearInterval(timer);
                }
                element.textContent = Math.round(current) + suffix;
            }, 16);
        }

        // API call wrapper with filters
        async function safeApiCall(url, errorMessage = 'API call failed') {
            try {
                // Add filters to URL
                const urlParams = new URLSearchParams();
                Object.entries(globalFilters).forEach(([key, value]) => {
                    if (value) {
                        urlParams.append(key, value);
                    }
                });
                
                const fullUrl = urlParams.toString() ? `${url}?${urlParams.toString()}` : url;
                
                const response = await fetch(fullUrl);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                const result = await response.json();
                
                if (result.success === false) {
                    throw new Error(result.error || errorMessage);
                }
                
                return result.data || result;
            } catch (error) {
                console.error(`❌ ${errorMessage}:`, error);
                showNotification(`${errorMessage}: ${error.message}`, 'error');
                throw error;
            }
        }

        // Enhanced chart creation
        function createModernChart(ctx, type, data, options = {}) {
            try {
                if (!data || !data.labels || !data.datasets || data.datasets.length === 0) {
                    console.warn('Invalid chart data:', data);
                    return null;
                }

                if (data.labels) {
                    data.labels = data.labels.map(label => {
                        if (typeof label === 'string' && label.length > 25) {
                            return label;
                        }
                        return label;
                    });
                }

                const mergedOptions = {
                    ...chartDefaults,
                    ...options,
                    plugins: {
                        ...chartDefaults.plugins,
                        ...options.plugins
                    },
                    scales: {
                        ...chartDefaults.scales,
                        ...options.scales
                    }
                };

                if (options.indexAxis === 'y') {
                    mergedOptions.scales = {
                        ...mergedOptions.scales,
                        x: {
                            ...mergedOptions.scales.y,
                            position: 'bottom'
                        },
                        y: {
                            ...mergedOptions.scales.x,
                            position: 'left',
                            ticks: {
                                ...mergedOptions.scales.x.ticks,
                                callback: function(value, index, values) {
                                    const label = this.getLabelForValue(value);
                                    if (typeof label === 'string' && label.length > 20) {
                                        return label.substring(0, 17) + '...';
                                    }
                                    return label;
                                }
                            }
                        }
                    };
                }

                return new Chart(ctx, {
                    type: type,
                    data: data,
                    options: mergedOptions
                });
            } catch (error) {
                console.error('Error creating chart:', error);
                showNotification('Error creating chart: ' + error.message, 'error');
                return null;
            }
        }

        // Show/Hide Summary Functions
        function showSummary(chartType) {
            const normalizedId = chartType.replace(/-/g, '').toLowerCase();
            const summaryElement = document.getElementById(normalizedId + 'Summary');
            
            if (summaryElement) {
                const isHidden = summaryElement.classList.contains('hidden');
                
                // Hide all other summaries first
                document.querySelectorAll('.summary-card').forEach(card => {
                    card.classList.add('hidden');
                });
                
                if (isHidden) {
                    summaryElement.classList.remove('hidden');
                    generateSummary(chartType, summaryElement);
                    showNotification(`📊 ${chartType.replace('-', ' ')} summary displayed`, 'success', 2000);
                } else {
                    summaryElement.classList.add('hidden');
                }
            } else {
                console.warn(`Summary element not found for: ${chartType} (looking for: ${normalizedId}Summary)`);
                showNotification(`Summary not available for ${chartType}`, 'error', 2000);
            }
        }

        function generateSummary(chartType, summaryElement) {
            const data = currentData[chartType];
            const contentDiv = summaryElement.querySelector('.summary-content');
            let summaryHTML = '';
            
            // Generate summary based on chart type
            switch(chartType) {
                case 'employment-status':
                    if (data && data.analysis) {
                        summaryHTML = `
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                                <div class="text-center">
                                    <span class="key-metric">${data.analysis.employment_rate}%</span>
                                    <p class="text-sm">Employment Rate</p>
                                </div>
                                <div class="text-center">
                                    <span class="key-metric">${data.analysis.total_graduates}</span>
                                    <p class="text-sm">Total Graduates</p>
                                </div>
                                <div class="text-center">
                                    <span class="key-metric">${data.analysis.unemployment_rate}%</span>
                                    <p class="text-sm">Unemployment Rate</p>
                                </div>
                            </div>
                            <p><strong>Key Insight:</strong> ${data.analysis.employment_rate}% of graduates are currently employed.</p>
                        `;
                    } else {
                        summaryHTML = `
                            <p><strong>Employment Status Analysis</strong></p>
                            <p>This chart shows the current employment distribution among graduates. The data helps identify employment patterns and success rates.</p>
                        `;
                    }
                    break;
                    
                case 'out-of-field-jobs':
                    if (data && data.summary) {
                        summaryHTML = `
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                                <div class="text-center">
                                    <span class="key-metric">${data.summary.total_out_of_field}</span>
                                    <p class="text-sm">Out-of-Field Workers</p>
                                </div>
                                <div class="text-center">
                                    <span class="key-metric">${data.summary.percentage_of_total}%</span>
                                    <p class="text-sm">Percentage of Total</p>
                                </div>
                                <div class="text-center">
                                    <span class="key-metric">${data.summary.total_graduates}</span>
                                    <p class="text-sm">Total Graduates</p>
                                </div>
                            </div>
                            <p><strong>Key Insight:</strong> ${data.summary.percentage_of_total}% of graduates work outside their field of study.</p>
                        `;
                    } else {
                        summaryHTML = `
                            <p><strong>Out-of-Field Employment Analysis</strong></p>
                            <p>This analysis shows graduates working outside their field of study, providing insights into career flexibility and market adaptation.</p>
                        `;
                    }
                    break;
                    
                case 'challenges':
                    if (data && data.analysis) {
                        summaryHTML = `
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                                <div class="text-center">
                                    <span class="key-metric">${data.analysis.top_challenge_percentage}%</span>
                                    <p class="text-sm">Top Challenge Rate</p>
                                </div>
                                <div class="text-center">
                                    <span class="key-metric">${data.analysis.diversity_of_challenges}</span>
                                    <p class="text-sm">Different Challenges</p>
                                </div>
                                <div class="text-center">
                                    <span class="key-metric">${data.analysis.total_responses}</span>
                                    <p class="text-sm">Total Responses</p>
                                </div>
                            </div>
                            <p><strong>Key Insight:</strong> "${data.analysis.top_challenge}" is the primary challenge.</p>
                        `;
                    } else {
                        summaryHTML = `
                            <p><strong>Job Search Challenges</strong></p>
                            <p>Analysis of the main obstacles graduates face when searching for employment, helping identify areas for support and improvement.</p>
                        `;
                    }
                    break;
                    
                default:
                    summaryHTML = `
                        <p><strong>Data Analysis</strong></p>
                        <p>This chart provides insights into graduate employment patterns and trends. The data helps identify key factors affecting career success.</p>
                        <div class="mt-4 p-4 bg-blue-50 rounded-lg border border-blue-200">
                            <p class="text-sm text-blue-800"><strong>Note:</strong> Detailed analysis is available based on current filter selections.</p>
                        </div>
                    `;
                    break;
            }
            
            contentDiv.innerHTML = summaryHTML;
        }

        // Filter Management
        function initializeFilters() {
            populateFilterDropdowns();
        }

        async function populateFilterDropdowns() {
            try {
                // Populate year filter
                const yearFilter = document.getElementById('yearFilter');
                const compareYear1 = document.getElementById('compareYear1');
                const compareYear2 = document.getElementById('compareYear2');
                
                for (let year = 2020; year <= 2024; year++) {
                    const option = new Option(year.toString(), year.toString());
                    yearFilter.add(option.cloneNode(true));
                    compareYear1.add(option.cloneNode(true));
                    compareYear2.add(option.cloneNode(true));
                }
                
                // Populate field filter
                const fieldFilter = document.getElementById('fieldFilter');
                const compareField1 = document.getElementById('compareField1');
                const compareField2 = document.getElementById('compareField2');
                const fields = ['Teknologi Maklumat', 'Perniagaan', 'Kejuruteraan', 'Perakaunan', 'Pemasaran', 'Sains Komputer', 'Pengurusan', 'Kewangan'];
                fields.forEach(field => {
                    fieldFilter.add(new Option(field, field));
                    compareField1.add(new Option(field, field));
                    compareField2.add(new Option(field, field));
                });
                
                // Populate employment filter
                const employmentFilter = document.getElementById('employmentFilter');
                const employmentTypes = ['Ya, bekerja sepenuh masa', 'Tidak, sedang mencari pekerjaan', 'Ya, bekerja separuh masa'];
                employmentTypes.forEach(type => {
                    employmentFilter.add(new Option(type, type));
                });
                
                // Populate institution filter
                const institutionFilter = document.getElementById('institutionFilter');
                const compareInst1 = document.getElementById('compareInst1');
                const compareInst2 = document.getElementById('compareInst2');
                const institutions = ['MARA Professional College', 'MARA University of Technology', 'MARA Skills Institute'];
                institutions.forEach(institution => {
                    institutionFilter.add(new Option(institution, institution));
                    compareInst1.add(new Option(institution, institution));
                    compareInst2.add(new Option(institution, institution));
                });
                
            } catch (error) {
                console.error('Error populating filters:', error);
            }
        }

        function applyGlobalFilter() {
            globalFilters.year = document.getElementById('yearFilter').value;
            globalFilters.field = document.getElementById('fieldFilter').value;
            globalFilters.employment = document.getElementById('employmentFilter').value;
            globalFilters.gender = document.getElementById('genderFilter').value;
            globalFilters.institution = document.getElementById('institutionFilter').value;
            
            updateActiveFiltersDisplay();
            
            const activeTab = document.querySelector('.tab-button.active');
            if (activeTab) {
                const tabName = activeTab.getAttribute('data-tab');
                loadTabData(tabName);
            }
            
            loadSummaryStats();
            showNotification('🔄 Filters applied successfully!', 'success', 2000);
        }

        function updateActiveFiltersDisplay() {
            const activeFiltersContainer = document.getElementById('activeFilters');
            activeFiltersContainer.innerHTML = '';
            
            Object.entries(globalFilters).forEach(([key, value]) => {
                if (value) {
                    const badge = document.createElement('span');
                    badge.className = 'filter-badge';
                    badge.innerHTML = `${key}: ${value} <i class="fas fa-times ml-2 cursor-pointer" onclick="removeFilter('${key}')"></i>`;
                    activeFiltersContainer.appendChild(badge);
                }
            });
        }

        function removeFilter(filterKey) {
            globalFilters[filterKey] = '';
            document.getElementById(filterKey + 'Filter').value = '';
            applyGlobalFilter();
        }

        function resetFilters() {
            Object.keys(globalFilters).forEach(key => {
                globalFilters[key] = '';
                const filterElement = document.getElementById(key + 'Filter');
                if (filterElement) {
                    filterElement.value = '';
                }
            });
            updateActiveFiltersDisplay();
            
            const activeTab = document.querySelector('.tab-button.active');
            if (activeTab) {
                const tabName = activeTab.getAttribute('data-tab');
                loadTabData(tabName);
            }
            
            loadSummaryStats();
            showNotification('🔄 All filters reset!', 'success', 2000);
        }

        // Enhanced Comparison Functions
        function toggleComparison() {
            const comparisonMode = document.getElementById('comparisonMode');
            const isHidden = comparisonMode.classList.contains('hidden');
            
            if (isHidden) {
                comparisonMode.classList.remove('hidden');
                showNotification('📊 Advanced comparison mode enabled', 'success', 2000);
            } else {
                comparisonMode.classList.add('hidden');
                document.getElementById('comparisonResults').classList.add('hidden');
                showNotification('📊 Comparison mode disabled', 'success', 2000);
            }
        }

        function updateComparison() {
            const year1 = document.getElementById('compareYear1').value;
            const year2 = document.getElementById('compareYear2').value;
            const field1 = document.getElementById('compareField1').value;
            const field2 = document.getElementById('compareField2').value;
            const inst1 = document.getElementById('compareInst1').value;
            const inst2 = document.getElementById('compareInst2').value;
            
            let comparisonText = [];
            
            if (year1 && year2 && year1 !== year2) {
                comparisonText.push(`${year1} vs ${year2}`);
                performYearComparison(year1, year2);
            }
            
            if (field1 && field2 && field1 !== field2) {
                comparisonText.push(`${field1} vs ${field2}`);
                performFieldComparison(field1, field2);
            }
            
            if (inst1 && inst2 && inst1 !== inst2) {
                comparisonText.push(`${inst1} vs ${inst2}`);
                performInstitutionComparison(inst1, inst2);
            }
            
            if (comparisonText.length > 0) {
                document.getElementById('comparisonResults').classList.remove('hidden');
                showNotification(`📈 Comparing: ${comparisonText.join(', ')}`, 'success', 3000);
            }
        }

        async function performYearComparison(year1, year2) {
            try {
                // Save current filters
                const currentFilters = {...globalFilters};
                
                // Get data for year1
                globalFilters.year = year1;
                const data1 = await safeApiCall('/api/summary-stats');
                
                // Get data for year2
                globalFilters.year = year2;
                const data2 = await safeApiCall('/api/summary-stats');
                
                // Restore filters
                globalFilters = currentFilters;
                
                // Display comparison
                displayComparisonResults('Year Comparison', [
                    { label: year1, employment_rate: data1.employment_rate, total_graduates: data1.total_graduates },
                    { label: year2, employment_rate: data2.employment_rate, total_graduates: data2.total_graduates }
                ]);
                
            } catch (error) {
                console.error('Comparison error:', error);
            }
        }

        async function performFieldComparison(field1, field2) {
            try {
                const currentFilters = {...globalFilters};
                
                globalFilters.field = field1;
                const data1 = await safeApiCall('/api/summary-stats');
                
                globalFilters.field = field2;
                const data2 = await safeApiCall('/api/summary-stats');
                
                globalFilters = currentFilters;
                
                displayComparisonResults('Field Comparison', [
                    { label: field1, employment_rate: data1.employment_rate, total_graduates: data1.total_graduates },
                    { label: field2, employment_rate: data2.employment_rate, total_graduates: data2.total_graduates }
                ]);
                
            } catch (error) {
                console.error('Field comparison error:', error);
            }
        }

        async function performInstitutionComparison(inst1, inst2) {
            try {
                const currentFilters = {...globalFilters};
                
                globalFilters.institution = inst1;
                const data1 = await safeApiCall('/api/summary-stats');
                
                globalFilters.institution = inst2;
                const data2 = await safeApiCall('/api/summary-stats');
                
                globalFilters = currentFilters;
                
                displayComparisonResults('Institution Comparison', [
                    { label: inst1, employment_rate: data1.employment_rate, total_graduates: data1.total_graduates },
                    { label: inst2, employment_rate: data2.employment_rate, total_graduates: data2.total_graduates }
                ]);
                
            } catch (error) {
                console.error('Institution comparison error:', error);
            }
        }

        function displayComparisonResults(title, data) {
            const summaryDiv = document.getElementById('comparisonSummary');
            summaryDiv.innerHTML = `
                <h5 class="col-span-full text-lg font-bold text-navy mb-4">${title}</h5>
                ${data.map(item => `
                    <div class="glass-card rounded-lg p-4 text-center">
                        <h6 class="font-bold text-navy mb-2">${item.label}</h6>
                        <div class="text-2xl font-black text-blue">${item.employment_rate}%</div>
                        <div class="text-sm text-gray-600">Employment Rate</div>
                        <div class="text-lg font-bold text-navy mt-2">${item.total_graduates}</div>
                        <div class="text-sm text-gray-600">Graduates</div>
                    </div>
                `).join('')}
            `;
        }

        function exportFilteredData() {
            let csvContent = '\uFEFF';
            csvContent += 'Filter,Value\n';
            
            Object.entries(globalFilters).forEach(([key, value]) => {
                if (value) {
                    csvContent += `"${key}","${value}"\n`;
                }
            });
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `graduate_analytics_filtered_${new Date().toISOString().slice(0, 10)}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            
            showNotification('📥 Filtered data exported successfully!', 'success');
        }

        // Summary statistics
        async function loadSummaryStats() {
            try {
                const data = await safeApiCall('/api/summary-stats', 'Failed to load summary statistics');
                
                setTimeout(() => {
                    animateCounter(document.getElementById('totalGraduates'), data.total_graduates);
                    animateCounter(document.getElementById('headerTotalGraduates'), data.total_graduates);
                    const progressBars = document.querySelectorAll('.progress-bar');
                    if (progressBars[0]) progressBars[0].style.width = '100%';
                }, 200);
                
                setTimeout(() => {
                    animateCounter(document.getElementById('employmentRate'), data.employment_rate, '%');
                    animateCounter(document.getElementById('headerEmploymentRate'), data.employment_rate, '%');
                    if (progressBars[1]) progressBars[1].style.width = data.employment_rate + '%';
                }, 400);
                
                setTimeout(() => {
                    animateCounter(document.getElementById('fieldsCount'), data.fields_count);
                    if (progressBars[2]) progressBars[2].style.width = Math.min(data.fields_count * 10, 100) + '%';
                }, 600);
                
                setTimeout(() => {
                    const yearElement = document.getElementById('yearRange');
                    if (yearElement) yearElement.textContent = data.year_range;
                    if (progressBars[3]) progressBars[3].style.width = '85%';
                }, 800);

                showNotification('📊 Dashboard data loaded successfully!', 'success');
            } catch (error) {
                console.error('Error loading summary stats:', error);
            }
        }

        // Tab switching
        function switchTab(tabName) {
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            const activeButton = document.querySelector(`[data-tab="${tabName}"]`);
            if (activeButton) {
                activeButton.classList.add('active');
            }
            
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            const activeContent = document.getElementById(tabName);
            if (activeContent) {
                activeContent.classList.remove('hidden');
                activeContent.classList.add('animate-fade-in');
            }
            
            // Hide all summary cards when switching tabs
            document.querySelectorAll('.summary-card').forEach(card => {
                card.classList.add('hidden');
            });
            
            loadTabData(tabName);
        }

        // Tab data loading
        async function loadTabData(tabName) {
            showLoading();
            try {
                switch(tabName) {
                    case 'overview':
                        await Promise.all([
                            loadEmploymentStatus(),
                            loadJobTypes(),
                            loadFieldYear()
                        ]);
                        break;
                    case 'employment':
                        await Promise.all([
                            loadTimeToEmployment(),
                            loadSuccessFactors(),
                            loadSectors()
                        ]);
                        break;
                    case 'salary':
                        await Promise.all([
                            loadCurrentSalary(),
                            loadSalaryExpectation(),
                            loadSalaryByField()
                        ]);
                        break;
                    case 'out-of-field':
                        await Promise.all([
                            loadOutOfFieldAnalysis(),
                            loadOutOfFieldStatistics()
                        ]);
                        break;
                    case 'challenges':
                        await Promise.all([
                            loadChallenges(),
                            loadGigEconomy(),
                            loadCertifications(),
                            loadInternship(),
                            loadSupportNeeded()
                        ]);
                        break;
                }
                showNotification(`✨ ${tabName.charAt(0).toUpperCase() + tabName.slice(1)} data loaded!`, 'success');
            } catch (error) {
                console.error(`❌ Error loading ${tabName} data:`, error);
                showNotification(`Failed to load ${tabName} data`, 'error');
            } finally {
                hideLoading();
            }
        }

        // Chart loading functions - Updated and New
        async function loadEmploymentStatus() {
            try {
                const data = await safeApiCall('/api/employment-status');
                currentData['employment-status'] = data;
                
                const ctx = document.getElementById('employmentStatusChart');
                if (!ctx) return;
                
                if (charts.employmentStatus) {
                    charts.employmentStatus.destroy();
                }
                
                if (!data.chart_data || !data.chart_data.labels || !data.chart_data.data) {
                    console.warn('Invalid employment status data:', data);
                    return;
                }
                
                charts.employmentStatus = createModernChart(ctx.getContext('2d'), 'doughnut', {
                    labels: data.chart_data.labels,
                    datasets: [{
                        data: data.chart_data.data,
                        backgroundColor: colors.palette.slice(0, data.chart_data.labels.length),
                        borderWidth: 3,
                        borderColor: '#ffffff',
                        hoverOffset: 15,
                        hoverBorderWidth: 5
                    }]
                }, {
                    cutout: '70%',
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true,
                                font: { family: 'Inter', size: 12, weight: '600' },
                                color: '#283E56',
                                boxWidth: 12,
                                boxHeight: 12
                            }
                        }
                    }
                });
            } catch (error) {
                console.error('Error loading employment status:', error);
            }
        }

        async function loadJobTypes() {
            try {
                const data = await safeApiCall('/api/job-types');
                currentData['job-types'] = data;
                
                const ctx = document.getElementById('jobTypesChart');
                if (!ctx) return;
                
                if (charts.jobTypes) {
                    charts.jobTypes.destroy();
                }
                
                if (!data.chart_data || !data.chart_data.labels || !data.chart_data.data) {
                    console.warn('Invalid job types data:', data);
                    return;
                }
                
                charts.jobTypes = createModernChart(ctx.getContext('2d'), 'bar', {
                    labels: data.chart_data.labels,
                    datasets: [{
                        label: 'Number of Graduates',
                        data: data.chart_data.data,
                        backgroundColor: colors.palette.slice(0, data.chart_data.labels.length),
                        borderRadius: 12,
                        borderSkipped: false
                    }]
                }, {
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { 
                                color: '#6b7280',
                                font: { family: 'Inter', weight: '500' }
                            },
                            grid: { color: '#f3f4f6' }
                        },
                        x: {
                            ticks: { 
                                color: '#6b7280',
                                font: { family: 'Inter', weight: '500' },
                                maxRotation: 45,
                                minRotation: 45,
                                callback: function(value, index, values) {
                                    const label = this.getLabelForValue(value);
                                    return label && label.length > 20 ? label.substring(0, 17) + '...' : label;
                                }
                            },
                            grid: { display: false }
                        }
                    }
                });
            } catch (error) {
                console.error('Error loading job types:', error);
            }
        }

        async function loadFieldYear() {
            try {
                const data = await safeApiCall('/api/graduates-by-field-year');
                currentData['field-year'] = data;
                
                const ctx = document.getElementById('fieldYearChart');
                if (!ctx) return;
                
                if (charts.fieldYear) {
                    charts.fieldYear.destroy();
                }
                
                if (!data.chart_data || !data.chart_data.labels || !data.chart_data.datasets) {
                    console.warn('Invalid field year data:', data);
                    return;
                }
                
                charts.fieldYear = createModernChart(ctx.getContext('2d'), 'bar', {
                    labels: data.chart_data.labels,
                    datasets: data.chart_data.datasets.map((dataset, index) => ({
                        ...dataset,
                        backgroundColor: colors.palette[index % colors.palette.length],
                        borderRadius: 8,
                        borderSkipped: false
                    }))
                }, {
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true,
                                font: { family: 'Inter', size: 11, weight: '600' },
                                color: '#283E56',
                                boxWidth: 12,
                                boxHeight: 12
                            }
                        }
                    },
                    scales: {
                        x: { 
                            stacked: true,
                            ticks: { color: '#6b7280' },
                            grid: { display: false }
                        },
                        y: { 
                            stacked: true,
                            beginAtZero: true,
                            ticks: { color: '#6b7280' },
                            grid: { color: '#f3f4f6' }
                        }
                    }
                });
            } catch (error) {
                console.error('Error loading field year data:', error);
            }
        }

        // NEW: Out-of-Field Analysis Functions
        async function loadOutOfFieldAnalysis() {
            try {
                const data = await safeApiCall('/api/out-of-field-analysis');
                currentData['out-of-field-jobs'] = data;
                currentData['out-of-field-reasons'] = data;
                currentData['academic-skills-needed'] = data;
                
                // Load out-of-field job types chart
                const jobsCtx = document.getElementById('outOfFieldJobsChart');
                if (jobsCtx && data.job_types && data.job_types.labels) {
                    if (charts.outOfFieldJobs) {
                        charts.outOfFieldJobs.destroy();
                    }
                    
                    charts.outOfFieldJobs = createModernChart(jobsCtx.getContext('2d'), 'doughnut', {
                        labels: data.job_types.labels,
                        datasets: [{
                            data: data.job_types.data,
                            backgroundColor: colors.palette.slice(0, data.job_types.labels.length),
                            borderWidth: 3,
                            borderColor: '#ffffff',
                            hoverOffset: 10
                        }]
                    }, {
                        cutout: '65%'
                    });
                }
                
                // Load reasons chart
                const reasonsCtx = document.getElementById('outOfFieldReasonsChart');
                if (reasonsCtx && data.reasons && data.reasons.labels) {
                    if (charts.outOfFieldReasons) {
                        charts.outOfFieldReasons.destroy();
                    }
                    
                    charts.outOfFieldReasons = createModernChart(reasonsCtx.getContext('2d'), 'bar', {
                        labels: data.reasons.labels,
                        datasets: [{
                            label: 'Number of Responses',
                            data: data.reasons.data,
                            backgroundColor: colors.palette.slice(0, data.reasons.labels.length),
                            borderRadius: 8
                        }]
                    }, {
                        indexAxis: 'y',
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            x: {
                                beginAtZero: true,
                                ticks: { color: '#6b7280' },
                                grid: { color: '#f3f4f6' }
                            },
                            y: {
                                ticks: { 
                                    color: '#6b7280',
                                    callback: function(value, index, values) {
                                        const label = this.getLabelForValue(value);
                                        return label && label.length > 25 ? label.substring(0, 22) + '...' : label;
                                    }
                                },
                                grid: { display: false }
                            }
                        }
                    });
                }
                
                // Load academic skills chart
                const skillsCtx = document.getElementById('academicSkillsChart');
                if (skillsCtx && data.academic_skills && data.academic_skills.labels) {
                    if (charts.academicSkills) {
                        charts.academicSkills.destroy();
                    }
                    
                    charts.academicSkills = createModernChart(skillsCtx.getContext('2d'), 'doughnut', {
                        labels: data.academic_skills.labels,
                        datasets: [{
                            data: data.academic_skills.data,
                            backgroundColor: colors.palette.slice(0, data.academic_skills.labels.length),
                            borderWidth: 3,
                            borderColor: '#ffffff',
                            hoverOffset: 10
                        }]
                    }, {
                        cutout: '65%'
                    });
                }
                
            } catch (error) {
                console.error('Error loading out-of-field analysis:', error);
            }
        }

        async function loadOutOfFieldStatistics() {
            try {
                const data = await safeApiCall('/api/out-of-field-analysis');
                
                if (data.summary) {
                    setTimeout(() => {
                        animateCounter(document.getElementById('outOfFieldCount'), data.summary.total_out_of_field);
                    }, 200);
                    
                    setTimeout(() => {
                        animateCounter(document.getElementById('outOfFieldPercentage'), data.summary.percentage_of_total, '%');
                    }, 400);
                    
                    setTimeout(() => {
                        if (data.academic_skills && data.academic_skills.data) {
                            const yesCount = data.academic_skills.labels.indexOf('Ya') >= 0 ? 
                                data.academic_skills.data[data.academic_skills.labels.indexOf('Ya')] : 0;
                            const total = data.academic_skills.data.reduce((sum, val) => sum + val, 0);
                            const percentage = total > 0 ? Math.round((yesCount / total) * 100) : 0;
                            animateCounter(document.getElementById('skillsStillNeeded'), percentage, '%');
                        }
                    }, 600);
                }
            } catch (error) {
                console.error('Error loading out-of-field statistics:', error);
            }
        }

        // Other existing chart loading functions (updated with filters)
        async function loadTimeToEmployment() {
            try {
                const data = await safeApiCall('/api/time-to-employment');
                currentData['time-employment'] = data;
                const ctx = document.getElementById('timeEmploymentChart');
                if (!ctx || !data.chart_data) return;
                
                if (charts.timeEmployment) {
                    charts.timeEmployment.destroy();
                }
                
                charts.timeEmployment = createModernChart(ctx.getContext('2d'), 'line', {
                    labels: data.chart_data.labels,
                    datasets: [{
                        label: 'Number of Graduates',
                        data: data.chart_data.data,
                        backgroundColor: 'rgba(25, 137, 172, 0.2)',
                        borderColor: '#1989AC',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#1989AC',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2,
                        pointRadius: 6
                    }]
                });
            } catch (error) {
                console.log('Time to employment data loading...');
            }
        }

        async function loadSuccessFactors() {
            try {
                const data = await safeApiCall('/api/success-factors');
                currentData['success-factors'] = data;
                const ctx = document.getElementById('successFactorsChart');
                if (!ctx || !data.chart_data) return;
                
                if (charts.successFactors) {
                    charts.successFactors.destroy();
                }
                
                charts.successFactors = createModernChart(ctx.getContext('2d'), 'doughnut', {
                    labels: data.chart_data.labels,
                    datasets: [{
                        data: data.chart_data.data,
                        backgroundColor: colors.palette.slice(0, data.chart_data.labels.length),
                        borderWidth: 3,
                        borderColor: '#ffffff',
                        hoverOffset: 8
                    }]
                }, {
                    cutout: '65%'
                });
            } catch (error) {
                console.log('Success factors data loading...');
            }
        }

        async function loadSectors() {
            try {
                const data = await safeApiCall('/api/employment-sectors');
                currentData['sectors'] = data;
                const ctx = document.getElementById('sectorsChart');
                if (!ctx || !data.chart_data) return;
                
                if (charts.sectors) {
                    charts.sectors.destroy();
                }
                
                charts.sectors = createModernChart(ctx.getContext('2d'), 'polarArea', {
                    labels: data.chart_data.labels,
                    datasets: [{
                        data: data.chart_data.data,
                        backgroundColor: colors.palette.slice(0, data.chart_data.labels.length),
                        borderWidth: 2,
                        borderColor: '#ffffff'
                    }]
                });
            } catch (error) {
                console.log('Sectors data loading...');
            }
        }

        async function loadCurrentSalary() {
            try {
                const data = await safeApiCall('/api/current-salary-by-field');
                currentData['current-salary'] = data;
                const ctx = document.getElementById('currentSalaryChart');
                if (!ctx || !data.chart_data) return;
                
                if (charts.currentSalary) {
                    charts.currentSalary.destroy();
                }
                
                charts.currentSalary = createModernChart(ctx.getContext('2d'), 'bar', {
                    labels: data.chart_data.labels,
                    datasets: data.chart_data.datasets.map((dataset, index) => ({
                        ...dataset,
                        backgroundColor: colors.palette[index % colors.palette.length],
                        borderRadius: 8
                    }))
                }, {
                    scales: {
                        x: { 
                            stacked: true,
                            ticks: { 
                                color: '#6b7280', 
                                maxRotation: 45,
                                callback: function(value, index, values) {
                                    const label = this.getLabelForValue(value);
                                    return label && label.length > 15 ? label.substring(0, 12) + '...' : label;
                                }
                            },
                            grid: { display: false }
                        },
                        y: { 
                            stacked: true,
                            beginAtZero: true,
                            ticks: { color: '#6b7280' },
                            grid: { color: '#f3f4f6' }
                        }
                    }
                });
            } catch (error) {
                console.log('Current salary data loading...');
            }
        }

        async function loadSalaryExpectation() {
            try {
                const data = await safeApiCall('/api/salary-comparison');
                currentData['salary-expectations'] = data;
                const ctx = document.getElementById('salaryExpectationChart');
                if (!ctx || !data.chart_data) return;
                
                if (charts.salaryExpectation) {
                    charts.salaryExpectation.destroy();
                }
                
                charts.salaryExpectation = createModernChart(ctx.getContext('2d'), 'bar', {
                    labels: data.chart_data.labels,
                    datasets: data.chart_data.datasets.map((dataset, index) => ({
                        ...dataset,
                        backgroundColor: index === 0 ? '#1989AC' : '#970747',
                        borderRadius: 8
                    }))
                }, {
                    scales: {
                        x: {
                            ticks: { 
                                color: '#6b7280',
                                maxRotation: 45,
                                callback: function(value, index, values) {
                                    const label = this.getLabelForValue(value);
                                    return label && label.length > 15 ? label.substring(0, 12) + '...' : label;
                                }
                            },
                            grid: { display: false }
                        },
                        y: {
                            beginAtZero: true,
                            ticks: { color: '#6b7280' },
                            grid: { color: '#f3f4f6' }
                        }
                    }
                });
            } catch (error) {
                console.log('Salary expectation data loading...');
            }
        }

        async function loadSalaryByField() {
            try {
                const data = await safeApiCall('/api/current-salary-by-field');
                currentData['salary-by-field'] = data;
                const ctx = document.getElementById('salaryByFieldChart');
                if (!ctx || !data.chart_data) return;
                
                if (charts.salaryByField) {
                    charts.salaryByField.destroy();
                }
                
                charts.salaryByField = createModernChart(ctx.getContext('2d'), 'bar', {
                    labels: data.chart_data.labels,
                    datasets: data.chart_data.datasets.map((dataset, index) => ({
                        ...dataset,
                        backgroundColor: colors.palette[index % colors.palette.length],
                        borderRadius: 8
                    }))
                }, {
                    indexAxis: 'y',
                    scales: {
                        x: {
                            beginAtZero: true,
                            ticks: { color: '#6b7280' },
                            grid: { color: '#f3f4f6' }
                        },
                        y: {
                            ticks: { 
                                color: '#6b7280',
                                callback: function(value, index, values) {
                                    const label = this.getLabelForValue(value);
                                    return label && label.length > 20 ? label.substring(0, 17) + '...' : label;
                                }
                            },
                            grid: { display: false }
                        }
                    }
                });
            } catch (error) {
                console.log('Salary by field data loading...');
            }
        }

        async function loadChallenges() {
            try {
                const data = await safeApiCall('/api/job-challenges');
                currentData['challenges'] = data;
                
                const ctx = document.getElementById('challengesChart');
                if (!ctx || !data.chart_data) return;
                
                if (charts.challenges) {
                    charts.challenges.destroy();
                }
                
                charts.challenges = createModernChart(ctx.getContext('2d'), 'bar', {
                    labels: data.chart_data.labels,
                    datasets: [{
                        label: 'Number of Responses',
                        data: data.chart_data.data,
                        backgroundColor: colors.palette.slice(0, data.chart_data.labels.length),
                        borderRadius: 8
                    }]
                }, {
                    indexAxis: 'y',
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            ticks: { color: '#6b7280' },
                            grid: { color: '#f3f4f6' }
                        },
                        y: {
                            ticks: { 
                                color: '#6b7280',
                                callback: function(value, index, values) {
                                    const label = this.getLabelForValue(value);
                                    return label && label.length > 25 ? label.substring(0, 22) + '...' : label;
                                }
                            },
                            grid: { display: false }
                        }
                    }
                });
            } catch (error) {
                console.error('Error loading challenges:', error);
            }
        }

        async function loadGigEconomy() {
            try {
                const data = await safeApiCall('/api/gig-economy');
                currentData['gig-economy'] = data;
                const ctx = document.getElementById('gigEconomyChart');
                if (!ctx || !data.chart_data) return;
                
                if (charts.gigEconomy) {
                    charts.gigEconomy.destroy();
                }
                
                charts.gigEconomy = createModernChart(ctx.getContext('2d'), 'doughnut', {
                    labels: data.chart_data.labels,
                    datasets: [{
                        data: data.chart_data.data,
                        backgroundColor: colors.palette.slice(0, data.chart_data.labels.length),
                        borderWidth: 3,
                        borderColor: '#ffffff'
                    }]
                }, {
                    cutout: '65%'
                });
            } catch (error) {
                console.log('Gig economy data loading...');
            }
        }

        async function loadCertifications() {
            try {
                const data = await safeApiCall('/api/certifications');
                currentData['certifications'] = data;
                const ctx = document.getElementById('certificationsChart');
                if (!ctx || !data.chart_data) return;
                
                if (charts.certifications) {
                    charts.certifications.destroy();
                }
                
                charts.certifications = createModernChart(ctx.getContext('2d'), 'doughnut', {
                    labels: data.chart_data.labels,
                    datasets: [{
                        data: data.chart_data.data,
                        backgroundColor: colors.palette.slice(0, data.chart_data.labels.length),
                        borderWidth: 3,
                        borderColor: '#ffffff'
                    }]
                }, {
                    cutout: '65%'
                });
            } catch (error) {
                console.log('Certifications data loading...');
            }
        }

        async function loadInternship() {
            try {
                const data = await safeApiCall('/api/internship-impact');
                currentData['internship'] = data;
                const ctx = document.getElementById('internshipChart');
                if (!ctx || !data.chart_data) return;
                
                if (charts.internship) {
                    charts.internship.destroy();
                }
                
                charts.internship = createModernChart(ctx.getContext('2d'), 'doughnut', {
                    labels: data.chart_data.labels,
                    datasets: [{
                        data: data.chart_data.data,
                        backgroundColor: colors.palette.slice(0, data.chart_data.labels.length),
                        borderWidth: 3,
                        borderColor: '#ffffff'
                    }]
                }, {
                    cutout: '65%'
                });
            } catch (error) {
                console.log('Internship data loading...');
            }
        }

        async function loadSupportNeeded() {
            try {
                const data = await safeApiCall('/api/support-needed');
                currentData['support-needed'] = data;
                const ctx = document.getElementById('supportNeededChart');
                if (!ctx || !data.chart_data) return;
                
                if (charts.supportNeeded) {
                    charts.supportNeeded.destroy();
                }
                
                charts.supportNeeded = createModernChart(ctx.getContext('2d'), 'bar', {
                    labels: data.chart_data.labels,
                    datasets: [{
                        label: 'Number of Requests',
                        data: data.chart_data.data,
                        backgroundColor: colors.palette.slice(0, data.chart_data.labels.length),
                        borderRadius: 8
                    }]
                }, {
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { color: '#6b7280' },
                            grid: { color: '#f3f4f6' }
                        },
                        x: {
                            ticks: { 
                                color: '#6b7280',
                                maxRotation: 45,
                                callback: function(value, index, values) {
                                    const label = this.getLabelForValue(value);
                                    return label && label.length > 20 ? label.substring(0, 17) + '...' : label;
                                }
                            },
                            grid: { display: false }
                        }
                    }
                });
            } catch (error) {
                console.log('Support needed data loading...');
            }
        }

        // Enhanced Modal functions with table support for all chart types
        function showTableModal(dataType) {
            const modal = document.getElementById('dataModal');
            const table = document.getElementById('dataTable');
            const title = document.getElementById('modalTitle');
            
            const data = currentData[dataType];
            if (!data) {
                showNotification('No data available for table view', 'error');
                return;
            }
            
            const titles = {
                'employment-status': '📊 Employment Status Data',
                'job-types': '💼 Job Type Distribution Data',
                'field-year': '🎓 Graduates by Field and Year Data',
                'time-employment': '⏱️ Time to Employment Data',
                'challenges': '⚠️ Job Search Challenges Data',
                'out-of-field-jobs': '🔄 Out-of-Field Job Types Data',
                'out-of-field-reasons': '❓ Out-of-Field Reasons Data',
                'academic-skills-needed': '🧠 Academic Skills Requirement Data'
            };
            
            if (title) title.textContent = titles[dataType] || 'Data Table';
            generateTable(table, data, dataType);
            modal.classList.remove('hidden');
        }

        function generateTable(table, data, dataType) {
            if (!table || !data) {
                if (table) {
                    table.innerHTML = '<tbody><tr><td class="p-8 text-center text-gray-500">No data available</td></tr></tbody>';
                }
                return;
            }
            
            let thead = '<tr>';
            let tbody = '';
            
            // Get table data based on chart type
            let tableData = null;
            
            if (data.table_data) {
                tableData = data.table_data;
            } else if (data.job_types && data.job_types.table_data) {
                tableData = data.job_types.table_data;
            } else if (data.reasons && data.reasons.table_data) {
                tableData = data.reasons.table_data;
            } else if (data.academic_skills && data.academic_skills.table_data) {
                tableData = data.academic_skills.table_data;
            }
            
            if (!tableData || tableData.length === 0) {
                table.innerHTML = '<tbody><tr><td class="p-8 text-center text-gray-500">No table data available for this chart</td></tr></tbody>';
                return;
            }
            
            switch(dataType) {
                case 'employment-status':
                    thead += '<th class="px-6 py-4 text-left text-sm font-bold text-gray-700 uppercase tracking-wider">Status</th>';
                    thead += '<th class="px-6 py-4 text-left text-sm font-bold text-gray-700 uppercase tracking-wider">Count</th>';
                    thead += '<th class="px-6 py-4 text-left text-sm font-bold text-gray-700 uppercase tracking-wider">Percentage</th>';
                    
                    tableData.forEach((row, index) => {
                        tbody += `<tr class="table-hover">
                            <td class="px-6 py-4 text-sm font-medium text-gray-900">${row.status}</td>
                            <td class="px-6 py-4 text-sm text-gray-600">${row.count.toLocaleString()}</td>
                            <td class="px-6 py-4 text-sm text-gray-600">
                                <div class="flex items-center">
                                    <div class="flex-1">
                                        <div class="h-2 bg-gray-200 rounded-full">
                                            <div class="h-2 bg-blue rounded-full" style="width: ${row.percentage}%;"></div>
                                        </div>
                                    </div>
                                    <span class="ml-2 font-medium">${row.percentage}%</span>
                                </div>
                            </td>
                        </tr>`;
                    });
                    break;

                case 'job-types':
                    thead += '<th class="px-6 py-4 text-left text-sm font-bold text-gray-700 uppercase tracking-wider">Job Type</th>';
                    thead += '<th class="px-6 py-4 text-left text-sm font-bold text-gray-700 uppercase tracking-wider">Count</th>';
                    thead += '<th class="px-6 py-4 text-left text-sm font-bold text-gray-700 uppercase tracking-wider">Percentage</th>';
                    
                    tableData.forEach((row, index) => {
                        tbody += `<tr class="table-hover">
                            <td class="px-6 py-4 text-sm font-medium text-gray-900">${row.job_type}</td>
                            <td class="px-6 py-4 text-sm text-gray-600">${row.count.toLocaleString()}</td>
                            <td class="px-6 py-4 text-sm text-gray-600">
                                <div class="flex items-center">
                                    <div class="flex-1">
                                        <div class="h-2 bg-gray-200 rounded-full">
                                            <div class="h-2 bg-maroon rounded-full" style="width: ${row.percentage}%;"></div>
                                        </div>
                                    </div>
                                    <span class="ml-2 font-medium">${row.percentage}%</span>
                                </div>
                            </td>
                        </tr>`;
                    });
                    break;

                case 'time-employment':
                    thead += '<th class="px-6 py-4 text-left text-sm font-bold text-gray-700 uppercase tracking-wider">Time Period</th>';
                    thead += '<th class="px-6 py-4 text-left text-sm font-bold text-gray-700 uppercase tracking-wider">Count</th>';
                    thead += '<th class="px-6 py-4 text-left text-sm font-bold text-gray-700 uppercase tracking-wider">Percentage</th>';
                    
                    tableData.forEach((row, index) => {
                        tbody += `<tr class="table-hover">
                            <td class="px-6 py-4 text-sm font-medium text-gray-900">${row.period}</td>
                            <td class="px-6 py-4 text-sm text-gray-600">${row.count.toLocaleString()}</td>
                            <td class="px-6 py-4 text-sm text-gray-600">
                                <div class="flex items-center">
                                    <div class="flex-1">
                                        <div class="h-2 bg-gray-200 rounded-full">
                                            <div class="h-2 bg-blue rounded-full" style="width: ${row.percentage}%;"></div>
                                        </div>
                                    </div>
                                    <span class="ml-2 font-medium">${row.percentage}%</span>
                                </div>
                            </td>
                        </tr>`;
                    });
                    break;

                case 'challenges':
                    thead += '<th class="px-6 py-4 text-left text-sm font-bold text-gray-700 uppercase tracking-wider">Challenge</th>';
                    thead += '<th class="px-6 py-4 text-left text-sm font-bold text-gray-700 uppercase tracking-wider">Count</th>';
                    thead += '<th class="px-6 py-4 text-left text-sm font-bold text-gray-700 uppercase tracking-wider">Percentage</th>';
                    
                    tableData.forEach((row, index) => {
                        tbody += `<tr class="table-hover">
                            <td class="px-6 py-4 text-sm font-medium text-gray-900">${row.challenge}</td>
                            <td class="px-6 py-4 text-sm text-gray-600">${row.count.toLocaleString()}</td>
                            <td class="px-6 py-4 text-sm text-gray-600">
                                <div class="flex items-center">
                                    <div class="flex-1">
                                        <div class="h-2 bg-gray-200 rounded-full">
                                            <div class="h-2 bg-navy rounded-full" style="width: ${row.percentage}%;"></div>
                                        </div>
                                    </div>
                                    <span class="ml-2 font-medium">${row.percentage}%</span>
                                </div>
                            </td>
                        </tr>`;
                    });
                    break;

                case 'out-of-field-jobs':
                    thead += '<th class="px-6 py-4 text-left text-sm font-bold text-gray-700 uppercase tracking-wider">Job Type</th>';
                    thead += '<th class="px-6 py-4 text-left text-sm font-bold text-gray-700 uppercase tracking-wider">Count</th>';
                    thead += '<th class="px-6 py-4 text-left text-sm font-bold text-gray-700 uppercase tracking-wider">Percentage</th>';
                    
                    tableData.forEach((row, index) => {
                        tbody += `<tr class="table-hover">
                            <td class="px-6 py-4 text-sm font-medium text-gray-900">${row.job_type}</td>
                            <td class="px-6 py-4 text-sm text-gray-600">${row.count.toLocaleString()}</td>
                            <td class="px-6 py-4 text-sm text-gray-600">
                                <div class="flex items-center">
                                    <div class="flex-1">
                                        <div class="h-2 bg-blue rounded-full" style="width: ${row.percentage}%;"></div>
                                        </div>
                                    </div>
                                    <span class="ml-2 font-medium">${row.percentage}%</span>
                                </div>
                            </td>
                        </tr>`;
                    });
                    break;

                case 'out-of-field-reasons':
                    thead += '<th class="px-6 py-4 text-left text-sm font-bold text-gray-700 uppercase tracking-wider">Reason</th>';
                    thead += '<th class="px-6 py-4 text-left text-sm font-bold text-gray-700 uppercase tracking-wider">Count</th>';
                    thead += '<th class="px-6 py-4 text-left text-sm font-bold text-gray-700 uppercase tracking-wider">Percentage</th>';
                    
                    tableData.forEach((row, index) => {
                        tbody += `<tr class="table-hover">
                            <td class="px-6 py-4 text-sm font-medium text-gray-900">${row.reason}</td>
                            <td class="px-6 py-4 text-sm text-gray-600">${row.count.toLocaleString()}</td>
                            <td class="px-6 py-4 text-sm text-gray-600">
                                <div class="flex items-center">
                                    <div class="flex-1">
                                        <div class="h-2 bg-gray-200 rounded-full">
                                            <div class="h-2 bg-maroon rounded-full" style="width: ${row.percentage}%;"></div>
                                        </div>
                                    </div>
                                    <span class="ml-2 font-medium">${row.percentage}%</span>
                                </div>
                            </td>
                        </tr>`;
                    });
                    break;

                case 'academic-skills-needed':
                    thead += '<th class="px-6 py-4 text-left text-sm font-bold text-gray-700 uppercase tracking-wider">Academic Skills Needed</th>';
                    thead += '<th class="px-6 py-4 text-left text-sm font-bold text-gray-700 uppercase tracking-wider">Count</th>';
                    thead += '<th class="px-6 py-4 text-left text-sm font-bold text-gray-700 uppercase tracking-wider">Percentage</th>';
                    
                    tableData.forEach((row, index) => {
                        tbody += `<tr class="table-hover">
                            <td class="px-6 py-4 text-sm font-medium text-gray-900">${row.academic_skills_needed}</td>
                            <td class="px-6 py-4 text-sm text-gray-600">${row.count.toLocaleString()}</td>
                            <td class="px-6 py-4 text-sm text-gray-600">
                                <div class="flex items-center">
                                    <div class="flex-1">
                                        <div class="h-2 bg-gray-200 rounded-full">
                                            <div class="h-2 bg-navy rounded-full" style="width: ${row.percentage}%;"></div>
                                        </div>
                                    </div>
                                    <span class="ml-2 font-medium">${row.percentage}%</span>
                                </div>
                            </td>
                        </tr>`;
                    });
                    break;

                case 'field-year':
                    // Complex table for field-year data
                    thead += '<th class="px-6 py-4 text-left text-sm font-bold text-gray-700 uppercase tracking-wider">Year</th>';
                    
                    // Get field names from the first row
                    if (tableData.length > 0) {
                        const firstRow = tableData[0];
                        Object.keys(firstRow).forEach(key => {
                            if (key !== 'year' && key !== 'total') {
                                thead += `<th class="px-6 py-4 text-left text-sm font-bold text-gray-700 uppercase tracking-wider">${key}</th>`;
                            }
                        });
                        thead += '<th class="px-6 py-4 text-left text-sm font-bold text-gray-700 uppercase tracking-wider">Total</th>';
                    }
                    
                    tableData.forEach((row, index) => {
                        tbody += `<tr class="table-hover">
                            <td class="px-6 py-4 text-sm font-medium text-gray-900">${row.year}</td>`;
                        
                        Object.keys(row).forEach(key => {
                            if (key !== 'year' && key !== 'total') {
                                const fieldData = row[key];
                                if (typeof fieldData === 'object' && fieldData.count !== undefined) {
                                    tbody += `<td class="px-6 py-4 text-sm text-gray-600">${fieldData.count} (${fieldData.percentage}%)</td>`;
                                }
                            }
                        });
                        
                        tbody += `<td class="px-6 py-4 text-sm font-bold text-gray-900">${row.total}</td>`;
                        tbody += '</tr>';
                    });
                    break;

                default:
                    thead += '<th class="px-6 py-4 text-left text-sm font-bold text-gray-700 uppercase tracking-wider">Data</th>';
                    tableData.forEach((row, index) => {
                        tbody += `<tr class="table-hover">
                            <td class="px-6 py-4 text-sm text-gray-900">${JSON.stringify(row)}</td>
                        </tr>`;
                    });
                    break;
            }
            
            thead += '</tr>';
            
            table.innerHTML = `
                <thead class="bg-gray-50">
                    ${thead}
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    ${tbody}
                </tbody>
            `;
        }

        function closeModal() {
            document.getElementById('dataModal').classList.add('hidden');
        }

        function exportTableData() {
            const table = document.getElementById('dataTable');
            if (!table) return;
            
            let csv = '\uFEFF';
            
            const headers = table.querySelectorAll('thead th');
            const headerRow = Array.from(headers).map(h => `"${h.textContent.trim()}"`).join(',');
            csv += headerRow + '\n';
            
            const rows = table.querySelectorAll('tbody tr');
            rows.forEach(row => {
                const cells = row.querySelectorAll('td');
                const rowData = Array.from(cells).map(cell => {
                    let text = cell.textContent.trim().replace(/\s+/g, ' ');
                    return `"${text}"`;
                }).join(',');
                csv += rowData + '\n';
            });
            
            const now = new Date();
            const timestamp = now.toISOString().slice(0, 19).replace(/:/g, '-');
            const filename = `graduate_analytics_${timestamp}.csv`;
            
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            
            showNotification('📥 Data exported successfully!', 'success');
        }

        // Utility functions
        function refreshAllData() {
            console.log('🔄 Refreshing all data...');
            showNotification('🔄 Refreshing dashboard data...', 'success');
            loadSummaryStats();
            const activeTab = document.querySelector('.tab-button.active');
            if (activeTab) {
                const tabName = activeTab.getAttribute('data-tab');
                loadTabData(tabName);
            }
        }

        function exportReport() {
            // Enhanced report export with current filter context
            const filterSummary = Object.entries(globalFilters)
                .filter(([key, value]) => value)
                .map(([key, value]) => `${key}: ${value}`)
                .join(', ') || 'No filters applied';
            
            showNotification(`📄 Generating report with filters: ${filterSummary}`, 'success', 4000);
            
            // Here you could implement actual PDF generation
            // For now, just show the notification
            setTimeout(() => {
                showNotification('📄 Advanced report export coming soon!', 'success');
            }, 2000);
        }

        function shareDashboard() {
            const shareData = {
                title: 'Graduate Analytics Dashboard - MARA Professional',
                text: 'Comprehensive analytics dashboard for graduate employment tracking and insights',
                url: window.location.href + (Object.values(globalFilters).some(v => v) ? 
                    '?filters=' + encodeURIComponent(JSON.stringify(globalFilters)) : '')
            };
            
            if (navigator.share) {
                navigator.share(shareData);
            } else {
                navigator.clipboard.writeText(shareData.url);
                showNotification('🔗 Dashboard URL with current filters copied to clipboard!', 'success');
            }
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 Enhanced Graduate Analytics Dashboard initialized');
            
            // Parse URL parameters for shared filters
            const urlParams = new URLSearchParams(window.location.search);
            const sharedFilters = urlParams.get('filters');
            if (sharedFilters) {
                try {
                    const filters = JSON.parse(decodeURIComponent(sharedFilters));
                    Object.assign(globalFilters, filters);
                    
                    // Apply shared filters to UI
                    Object.entries(filters).forEach(([key, value]) => {
                        const filterElement = document.getElementById(key + 'Filter');
                        if (filterElement && value) {
                            filterElement.value = value;
                        }
                    });
                    
                    updateActiveFiltersDisplay();
                    showNotification('📋 Shared filters applied!', 'success');
                } catch (error) {
                    console.error('Error parsing shared filters:', error);
                }
            }
            
            initializeFilters();
            loadSummaryStats();
            loadTabData('overview');
            
            // Tab navigation
            document.querySelectorAll('.tab-button').forEach(button => {
                button.addEventListener('click', function() {
                    const tab = this.getAttribute('data-tab');
                    if (tab) switchTab(tab);
                });
            });
            
            // Modal handling
            const modal = document.getElementById('dataModal');
            if (modal) {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        closeModal();
                    }
                });
            }
            
            // Enhanced keyboard shortcuts
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closeModal();
                    document.querySelectorAll('.summary-card').forEach(card => {
                        card.classList.add('hidden');
                    });
                }
                if (e.key === 'F5' && e.ctrlKey) {
                    e.preventDefault();
                    refreshAllData();
                }
                // Tab switching with number keys
                if (e.key >= '1' && e.key <= '5' && e.altKey) {
                    e.preventDefault();
                    const tabs = ['overview', 'employment', 'salary', 'out-of-field', 'challenges'];
                    const tabIndex = parseInt(e.key) - 1;
                    if (tabs[tabIndex]) {
                        switchTab(tabs[tabIndex]);
                    }
                }
                // Filter shortcuts
                if (e.key === 'r' && e.ctrlKey && e.shiftKey) {
                    e.preventDefault();
                    resetFilters();
                }
                if (e.key === 'c' && e.ctrlKey && e.shiftKey) {
                    e.preventDefault();
                    toggleComparison();
                }
            });
            
            // Auto-refresh data every 5 minutes when page is visible
            let refreshInterval;
            
            function startAutoRefresh() {
                refreshInterval = setInterval(() => {
                    if (document.visibilityState === 'visible') {
                        console.log('🔄 Auto-refreshing data...');
                        loadSummaryStats();
                    }
                }, 5 * 60 * 1000); // 5 minutes
            }
            
            function stopAutoRefresh() {
                if (refreshInterval) {
                    clearInterval(refreshInterval);
                }
            }
            
            document.addEventListener('visibilitychange', function() {
                if (document.visibilityState === 'visible') {
                    startAutoRefresh();
                } else {
                    stopAutoRefresh();
                }
            });
            
            startAutoRefresh();
        });

        // Responsive handling
        window.addEventListener('resize', function() {
            Object.values(charts).forEach(chart => {
                if (chart && chart.resize) {
                    try {
                        chart.resize();
                    } catch (error) {
                        console.warn('Chart resize failed:', error);
                    }
                }
            });
        });

        // Performance monitoring
        window.addEventListener('load', function() {
            const loadTime = performance.now();
            console.log(`✅ Enhanced dashboard loaded in ${loadTime.toFixed(2)}ms`);
            
            // Log memory usage if available
            if (performance.memory) {
                console.log(`📊 Memory usage: ${(performance.memory.usedJSHeapSize / 1024 / 1024).toFixed(2)} MB`);
            }
        });

        // Error handling for failed chart loads
        window.addEventListener('error', function(e) {
            console.error('Global error:', e.error);
            showNotification('An error occurred. Some features may not work properly.', 'error');
        });

        // Service worker registration for offline support (optional)
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/sw.js')
                    .then(function(registration) {
                        console.log('ServiceWorker registration successful');
                    })
                    .catch(function(err) {
                        console.log('ServiceWorker registration failed: ', err);
                    });
            });
        }

        console.log('✨ Enhanced Graduate Analytics Dashboard ready! 🎓');
        console.log('🎯 New Features:');
        console.log('   📊 Out-of-field employment analysis');
        console.log('   🔍 Enhanced filtering with comparison mode');
        console.log('   📋 Comprehensive table views');
        console.log('   ⌨️  Keyboard shortcuts (Alt+1-5 for tabs, Ctrl+Shift+R to reset filters)');
        console.log('   🔄 Auto-refresh every 5 minutes');
        console.log('   🔗 Shareable filtered URLs');
    </script>
</body>
</html>