<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Graduate Analytics Dashboard | MARA Professional</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'bg-light': '#E8E8E8',
                        'accent-red': '#F05454',
                        'primary-blue': '#30475E',
                        'dark-gray': '#222831'
                    },
                    fontFamily: {
                        'inter': ['Inter', 'sans-serif']
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.6s ease-out',
                        'slide-up': 'slideUp 0.5s ease-out',
                        'scale-in': 'scaleIn 0.4s ease-out'
                    }
                }
            }
        }
    </script>
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #E8E8E8;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes scaleIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }
        
        .minimal-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            transition: all 0.3s ease;
        }
        
        .minimal-card:hover {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transform: translateY(-2px);
        }
        
        .metric-card {
            background: white;
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            border-left: 4px solid;
        }
        
        .metric-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }
        
        .chart-container {
            position: relative;
            height: 400px;
            padding: 1rem;
        }
        
        .chart-container.large { height: 500px; }
        .chart-container.extra-large { height: 600px; }
        
        .nav-button {
            background: white;
            border: 1px solid #E5E7EB;
            border-radius: 8px;
            padding: 0.75rem 1.25rem;
            color: #6B7280;
            font-weight: 500;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .nav-button:hover {
            background: #F9FAFB;
            color: #30475E;
            border-color: #30475E;
        }
        
        .nav-button.active {
            background: #30475E;
            color: white;
            border-color: #30475E;
        }
        
        .filter-input {
            background: white;
            border: 1px solid #D1D5DB;
            border-radius: 8px;
            padding: 0.75rem;
            color: #374151;
            font-weight: 500;
            transition: all 0.2s ease;
            width: 100%;
        }
        
        .filter-input:focus {
            outline: none;
            border-color: #30475E;
            box-shadow: 0 0 0 3px rgba(48, 71, 94, 0.1);
        }
        
        .btn-primary {
            background: #30475E;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .btn-primary:hover {
            background: #222831;
            transform: translateY(-1px);
        }
        
        .btn-secondary {
            background: white;
            color: #30475E;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            border: 1px solid #30475E;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .btn-secondary:hover {
            background: #30475E;
            color: white;
        }
        
        .btn-accent {
            background: #F05454;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .btn-accent:hover {
            background: #E04444;
            transform: translateY(-1px);
        }
        
        .filter-badge {
            background: #30475E;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 500;
            margin: 0.25rem;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .comparison-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid #E5E7EB;
            transition: all 0.2s ease;
        }
        
        .comparison-card:hover {
            border-color: #30475E;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        .chart-action-btn {
            background: white;
            border: 1px solid #E5E7EB;
            border-radius: 6px;
            padding: 0.5rem 0.75rem;
            font-size: 0.75rem;
            font-weight: 500;
            color: #6B7280;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .chart-action-btn:hover {
            background: #30475E;
            color: white;
            border-color: #30475E;
        }
        
        .floating-btn {
            background: #F05454;
            color: white;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(240, 84, 84, 0.4);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
        }
        
        .floating-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 20px rgba(240, 84, 84, 0.5);
        }
        
        .notification {
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 1000;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.3s ease;
            transform: translateX(100%);
            opacity: 0;
            max-width: 400px;
        }
        
        .notification.show {
            transform: translateX(0);
            opacity: 1;
        }
        
        .notification.success {
            background: #10B981;
            color: white;
        }
        
        .notification.error {
            background: #F05454;
            color: white;
        }
        
        .loading-overlay {
            position: fixed;
            inset: 0;
            background: rgba(34, 40, 49, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }
        
        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .modal {
            position: fixed;
            inset: 0;
            background: rgba(34, 40, 49, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1500;
            padding: 2rem;
        }
        
        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            max-width: 90vw;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        
        .table-responsive {
            overflow-x: auto;
            border-radius: 8px;
            background: white;
            border: 1px solid #E5E7EB;
        }
        
        .table-hover:hover {
            background: #F9FAFB;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #F3F4F6;
        }

        ::-webkit-scrollbar-thumb {
            background: #D1D5DB;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #9CA3AF;
        }
    </style>
</head>

<body class="bg-bg-light">
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay hidden">
        <div class="text-center">
            <div class="loading-spinner mx-auto mb-4"></div>
            <h3 class="text-xl font-semibold text-white mb-2">Loading Analytics...</h3>
            <p class="text-gray-300">Processing graduate data</p>
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notificationContainer" class="fixed top-4 right-4 z-50 space-y-4"></div>

    <!-- Main Container -->
    <div>
        <!-- Header -->
        <header class="bg-white border-b border-gray-200">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-20">
                    <div class="flex items-center space-x-4">
                        <div class="w-12 h-12 bg-primary-blue rounded-lg flex items-center justify-center text-white">
                            <i class="fas fa-graduation-cap text-xl"></i>
                        </div>
                        <div>
                            <h1 class="text-2xl font-bold text-dark-gray">Graduate Analytics</h1>
                            <p class="text-sm text-gray-600">MARA Professional College</p>
                        </div>
                    </div>
                    
                    <div class="flex items-center space-x-8">
                        <div class="text-center">
                            <p class="text-sm text-gray-500">Total Graduates</p>
                            <p id="headerTotalGraduates" class="text-xl font-bold text-primary-blue">-</p>
                        </div>
                        <div class="text-center">
                            <p class="text-sm text-gray-500">Employment Rate</p>
                            <p id="headerEmploymentRate" class="text-xl font-bold text-accent-red">-</p>
                        </div>
                        <div class="flex items-center space-x-2">
                            <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                            <span class="text-sm font-medium text-gray-700">Live</span>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <div class="mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- Filter Section -->
            <div class="minimal-card p-6 mb-8 animate-fade-in">
                <div class="flex flex-col lg:flex-row items-start lg:items-center justify-between mb-6 gap-4">
                    <div>
                        <h2 class="text-xl font-semibold text-dark-gray mb-2">Filters & Analysis</h2>
                        <p class="text-gray-600">Apply filters to analyze specific graduate segments</p>
                    </div>
                    <div class="flex flex-wrap gap-3">
                        <button class="btn-primary" onclick="toggleComparison()">
                            <i class="fas fa-chart-line"></i>
                            Compare
                        </button>
                        <button class="btn-secondary" onclick="exportData()">
                            <i class="fas fa-download"></i>
                            Export
                        </button>
                        <button class="btn-accent" onclick="resetFilters()">
                            <i class="fas fa-undo"></i>
                            Reset
                        </button>
                    </div>
                </div>
                
                <!-- Filter Grid -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 mb-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Graduation Year</label>
                        <select id="yearFilter" class="filter-input" onchange="applyFilters()">
                            <option value="">All Years</option>
                            <option value="2020">2020</option>
                            <option value="2021">2021</option>
                            <option value="2022">2022</option>
                            <option value="2023">2023</option>
                            <option value="2024">2024</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Study Field</label>
                        <select id="fieldFilter" class="filter-input" onchange="applyFilters()">
                            <option value="">All Fields</option>
                            <option value="Teknologi Maklumat">IT & Technology</option>
                            <option value="Perniagaan">Business Studies</option>
                            <option value="Kejuruteraan">Engineering</option>
                            <option value="Perakaunan">Accounting</option>
                            <option value="Pemasaran">Marketing</option>
                            <option value="Sains Komputer">Computer Science</option>
                            <option value="Pengurusan">Management</option>
                            <option value="Kewangan">Finance</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Employment Status</label>
                        <select id="employmentFilter" class="filter-input" onchange="applyFilters()">
                            <option value="">All Status</option>
                            <option value="Ya, bekerja sepenuh masa">Full-time</option>
                            <option value="Ya, bekerja separuh masa">Part-time</option>
                            <option value="Tidak, sedang mencari pekerjaan">Job Seeking</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Gender</label>
                        <select id="genderFilter" class="filter-input" onchange="applyFilters()">
                            <option value="">All Genders</option>
                            <option value="Lelaki">Male</option>
                            <option value="Perempuan">Female</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Institution</label>
                        <select id="institutionFilter" class="filter-input" onchange="applyFilters()">
                            <option value="">All Institutions</option>
                            <option value="MARA Professional College">MARA Professional</option>
                            <option value="MARA University of Technology">MARA University</option>
                            <option value="MARA Skills Institute">MARA Skills</option>
                        </select>
                    </div>
                </div>
                
                <!-- Active Filters -->
                <div class="bg-gray-50 rounded-lg p-4">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-sm font-medium text-gray-700">Active Filters</span>
                        <span id="filterCount" class="text-xs bg-gray-200 text-gray-600 px-2 py-1 rounded-full">0 active</span>
                    </div>
                    <div id="activeFilters" class="flex flex-wrap gap-2 min-h-[1.5rem]">
                        <span class="text-sm text-gray-500 italic">No filters applied</span>
                    </div>
                </div>
            </div>

            <!-- Comparison Mode Panel -->
            <div id="comparisonPanel" class="minimal-card p-6 mb-8 hidden animate-slide-up">
                <h3 class="text-xl font-semibold text-dark-gray mb-6">Advanced Comparison</h3>
                
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                    <div class="comparison-card">
                        <h4 class="font-medium text-gray-800 mb-4">Year Comparison</h4>
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="block text-sm text-gray-600 mb-2">Year 1</label>
                                <select id="compareYear1" class="filter-input" onchange="updateComparison()">
                                    <option value="">Select Year</option>
                                    <option value="2020">2020</option>
                                    <option value="2021">2021</option>
                                    <option value="2022">2022</option>
                                    <option value="2023">2023</option>
                                    <option value="2024">2024</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm text-gray-600 mb-2">Year 2</label>
                                <select id="compareYear2" class="filter-input" onchange="updateComparison()">
                                    <option value="">Select Year</option>
                                    <option value="2020">2020</option>
                                    <option value="2021">2021</option>
                                    <option value="2022">2022</option>
                                    <option value="2023">2023</option>
                                    <option value="2024">2024</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="comparison-card">
                        <h4 class="font-medium text-gray-800 mb-4">Field Comparison</h4>
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="block text-sm text-gray-600 mb-2">Field 1</label>
                                <select id="compareField1" class="filter-input" onchange="updateComparison()">
                                    <option value="">Select Field</option>
                                    <option value="Teknologi Maklumat">IT & Technology</option>
                                    <option value="Perniagaan">Business</option>
                                    <option value="Kejuruteraan">Engineering</option>
                                    <option value="Perakaunan">Accounting</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm text-gray-600 mb-2">Field 2</label>
                                <select id="compareField2" class="filter-input" onchange="updateComparison()">
                                    <option value="">Select Field</option>
                                    <option value="Teknologi Maklumat">IT & Technology</option>
                                    <option value="Perniagaan">Business</option>
                                    <option value="Kejuruteraan">Engineering</option>
                                    <option value="Perakaunan">Accounting</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="comparison-card">
                        <h4 class="font-medium text-gray-800 mb-4">Institution Comparison</h4>
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="block text-sm text-gray-600 mb-2">Institution 1</label>
                                <select id="compareInst1" class="filter-input" onchange="updateComparison()">
                                    <option value="">Select Institution</option>
                                    <option value="MARA Professional College">MARA Professional</option>
                                    <option value="MARA University of Technology">MARA University</option>
                                    <option value="MARA Skills Institute">MARA Skills</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm text-gray-600 mb-2">Institution 2</label>
                                <select id="compareInst2" class="filter-input" onchange="updateComparison()">
                                    <option value="">Select Institution</option>
                                    <option value="MARA Professional College">MARA Professional</option>
                                    <option value="MARA University of Technology">MARA University</option>
                                    <option value="MARA Skills Institute">MARA Skills</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Comparison Results -->
                <div id="comparisonResults" class="hidden">
                    <h4 class="text-lg font-semibold text-gray-800 mb-6">Comparison Results</h4>
                    
                    <!-- Comparison Charts -->
                    <div class="grid grid-cols-1 xl:grid-cols-2 gap-6 mb-8">
                        <div class="minimal-card p-4">
                            <h5 class="font-medium text-gray-800 mb-4">Employment Rate Comparison</h5>
                            <div class="chart-container">
                                <canvas id="comparisonChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="minimal-card p-4">
                            <h5 class="font-medium text-gray-800 mb-4">Performance Radar</h5>
                            <div class="chart-container">
                                <canvas id="comparisonRadarChart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Comparison Summary -->
                    <div id="comparisonContent" class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <!-- Dynamic comparison results -->
                    </div>
                </div>
            </div>

            <!-- Summary Metrics -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="metric-card border-l-primary-blue animate-scale-in">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-600 mb-1">Total Graduates</p>
                            <p id="totalGraduates" class="text-3xl font-bold text-dark-gray">-</p>
                        </div>
                        <div class="w-12 h-12 bg-primary-blue rounded-lg flex items-center justify-center text-white">
                            <i class="fas fa-users"></i>
                        </div>
                    </div>
                    <div class="mt-4">
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div id="graduatesProgress" class="bg-primary-blue h-2 rounded-full transition-all duration-1000" style="width: 0%"></div>
                        </div>
                    </div>
                </div>

                <div class="metric-card border-l-accent-red animate-scale-in" style="animation-delay: 0.1s">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-600 mb-1">Employment Rate</p>
                            <p id="employmentRate" class="text-3xl font-bold text-dark-gray">-</p>
                        </div>
                        <div class="w-12 h-12 bg-accent-red rounded-lg flex items-center justify-center text-white">
                            <i class="fas fa-briefcase"></i>
                        </div>
                    </div>
                    <div class="mt-4">
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div id="employmentProgress" class="bg-accent-red h-2 rounded-full transition-all duration-1000" style="width: 0%"></div>
                        </div>
                    </div>
                </div>

                <div class="metric-card border-l-green-500 animate-scale-in" style="animation-delay: 0.2s">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-600 mb-1">Study Fields</p>
                            <p id="fieldsCount" class="text-3xl font-bold text-dark-gray">-</p>
                        </div>
                        <div class="w-12 h-12 bg-green-500 rounded-lg flex items-center justify-center text-white">
                            <i class="fas fa-book"></i>
                        </div>
                    </div>
                    <div class="mt-4">
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div id="fieldsProgress" class="bg-green-500 h-2 rounded-full transition-all duration-1000" style="width: 0%"></div>
                        </div>
                    </div>
                </div>

                <div class="metric-card border-l-blue-500 animate-scale-in" style="animation-delay: 0.3s">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-600 mb-1">Years Covered</p>
                            <p id="yearRange" class="text-3xl font-bold text-dark-gray">-</p>
                        </div>
                        <div class="w-12 h-12 bg-blue-500 rounded-lg flex items-center justify-center text-white">
                            <i class="fas fa-calendar"></i>
                        </div>
                    </div>
                    <div class="mt-4">
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div id="yearsProgress" class="bg-blue-500 h-2 rounded-full transition-all duration-1000" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Navigation Tabs -->
            <div class="flex flex-wrap gap-2 mb-8">
                <button class="nav-button active" data-tab="overview" onclick="switchTab('overview')">
                    <i class="fas fa-tachometer-alt"></i>
                    <span class="hidden sm:inline">Overview</span>
                </button>
                <button class="nav-button" data-tab="employment" onclick="switchTab('employment')">
                    <i class="fas fa-briefcase"></i>
                    <span class="hidden sm:inline">Employment</span>
                </button>
                <button class="nav-button" data-tab="salary" onclick="switchTab('salary')">
                    <i class="fas fa-dollar-sign"></i>
                    <span class="hidden sm:inline">Salary</span>
                </button>
                <button class="nav-button" data-tab="outfield" onclick="switchTab('outfield')">
                    <i class="fas fa-exchange-alt"></i>
                    <span class="hidden sm:inline">Out-of-Field</span>
                </button>
                <button class="nav-button" data-tab="challenges" onclick="switchTab('challenges')">
                    <i class="fas fa-exclamation-triangle"></i>
                    <span class="hidden sm:inline">Challenges</span>
                </button>
            </div>

            <!-- Tab Content -->
            <div class="tab-content-container">
                <!-- Overview Tab -->
                <div id="overview" class="tab-content">
                    <div class="grid grid-cols-1 xl:grid-cols-2 gap-6 mb-6">
                        <!-- Employment Status Chart -->
                        <div class="minimal-card">
                            <div class="p-6 border-b border-gray-100">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h3 class="text-lg font-semibold text-dark-gray">Employment Status</h3>
                                        <p class="text-sm text-gray-600 mt-1">Current employment distribution</p>
                                    </div>
                                    <div class="text-right">
                                        <span class="text-xs text-gray-500">Total Responses</span>
                                        <div id="employmentStatusTotal" class="text-lg font-semibold text-primary-blue">-</div>
                                    </div>
                                </div>
                            </div>
                            <div class="relative">
                                <div class="absolute top-4 right-4 flex gap-2 z-10">
                                    <button class="chart-action-btn" onclick="showAnalysis('employmentStatus')">
                                        <i class="fas fa-lightbulb"></i>
                                    </button>
                                    <button class="chart-action-btn" onclick="showTableModal('employmentStatus')">
                                        <i class="fas fa-table"></i>
                                    </button>
                                </div>
                                <div class="chart-container large">
                                    <canvas id="employmentStatusChart"></canvas>
                                </div>
                            </div>
                        </div>

                        <!-- Job Types Chart -->
                        <div class="minimal-card">
                            <div class="p-6 border-b border-gray-100">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h3 class="text-lg font-semibold text-dark-gray">Job Types</h3>
                                        <p class="text-sm text-gray-600 mt-1">Distribution of employment types</p>
                                    </div>
                                    <div class="text-right">
                                        <span class="text-xs text-gray-500">Total Responses</span>
                                        <div id="jobTypesTotal" class="text-lg font-semibold text-accent-red">-</div>
                                    </div>
                                </div>
                            </div>
                            <div class="relative">
                                <div class="absolute top-4 right-4 flex gap-2 z-10">
                                    <button class="chart-action-btn" onclick="showAnalysis('jobTypes')">
                                        <i class="fas fa-lightbulb"></i>
                                    </button>
                                    <button class="chart-action-btn" onclick="showTableModal('jobTypes')">
                                        <i class="fas fa-table"></i>
                                    </button>
                                </div>
                                <div class="chart-container large">
                                    <canvas id="jobTypesChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Time to Employment Chart -->
                    <div class="minimal-card mb-6">
                        <div class="p-6 border-b border-gray-100">
                            <div class="flex items-center justify-between">
                                <div>
                                    <h3 class="text-lg font-semibold text-dark-gray">Time to Employment</h3>
                                    <p class="text-sm text-gray-600 mt-1">Duration to find first job after graduation</p>
                                </div>
                                <div class="text-right">
                                    <span class="text-xs text-gray-500">Employed Graduates</span>
                                    <div id="timeToEmploymentTotal" class="text-lg font-semibold text-green-600">-</div>
                                </div>
                            </div>
                        </div>
                        <div class="relative">
                            <div class="absolute top-4 right-4 flex gap-2 z-10">
                                <button class="chart-action-btn" onclick="showAnalysis('timeToEmployment')">
                                    <i class="fas fa-lightbulb"></i>
                                </button>
                                <button class="chart-action-btn" onclick="showTableModal('timeToEmployment')">
                                    <i class="fas fa-table"></i>
                                </button>
                            </div>
                            <div class="chart-container large">
                                <canvas id="timeToEmploymentChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Field and Year Chart -->
                    <div class="minimal-card">
                        <div class="p-6 border-b border-gray-100">
                            <div class="flex items-center justify-between">
                                <div>
                                    <h3 class="text-lg font-semibold text-dark-gray">Graduates by Field and Year</h3>
                                    <p class="text-sm text-gray-600 mt-1">Trends across different study fields over time</p>
                                </div>
                                <div class="text-right">
                                    <span class="text-xs text-gray-500">Total Graduates</span>
                                    <div id="fieldYearTotal" class="text-lg font-semibold text-blue-600">-</div>
                                </div>
                            </div>
                        </div>
                        <div class="relative">
                            <div class="absolute top-4 right-4 flex gap-2 z-10">
                                <button class="chart-action-btn" onclick="showAnalysis('fieldYear')">
                                    <i class="fas fa-lightbulb"></i>
                                </button>
                                <button class="chart-action-btn" onclick="showTableModal('fieldYear')">
                                    <i class="fas fa-table"></i>
                                </button>
                            </div>
                            <div class="chart-container extra-large">
                                <canvas id="fieldYearChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Employment Tab -->
                <div id="employment" class="tab-content hidden">
                    <div class="grid grid-cols-1 xl:grid-cols-2 gap-6">
                        <!-- Success Factors -->
                        <div class="minimal-card">
                            <div class="p-6 border-b border-gray-100">
                                <h3 class="text-lg font-semibold text-dark-gray">Success Factors</h3>
                                <p class="text-sm text-gray-600 mt-1">Key factors leading to employment success</p>
                            </div>
                            <div class="relative">
                                <div class="absolute top-4 right-4 flex gap-2 z-10">
                                    <button class="chart-action-btn" onclick="showAnalysis('successFactors')">
                                        <i class="fas fa-lightbulb"></i>
                                    </button>
                                    <button class="chart-action-btn" onclick="showTableModal('successFactors')">
                                        <i class="fas fa-table"></i>
                                    </button>
                                </div>
                                <div class="chart-container large">
                                    <canvas id="successFactorsChart"></canvas>
                                </div>
                            </div>
                        </div>

                        <!-- Employment Sectors -->
                        <div class="minimal-card">
                            <div class="p-6 border-b border-gray-100">
                                <h3 class="text-lg font-semibold text-dark-gray">Employment Sectors</h3>
                                <p class="text-sm text-gray-600 mt-1">Industry distribution and sector analysis</p>
                            </div>
                            <div class="relative">
                                <div class="absolute top-4 right-4 flex gap-2 z-10">
                                    <button class="chart-action-btn" onclick="showAnalysis('employmentSectors')">
                                        <i class="fas fa-lightbulb"></i>
                                    </button>
                                    <button class="chart-action-btn" onclick="showTableModal('employmentSectors')">
                                        <i class="fas fa-table"></i>
                                    </button>
                                </div>
                                <div class="chart-container large">
                                    <canvas id="employmentSectorsChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Salary Tab -->
                <div id="salary" class="tab-content hidden">
                    <div class="grid grid-cols-1 xl:grid-cols-2 gap-6 mb-6">
                        <!-- Current Salary by Field -->
                        <div class="minimal-card">
                            <div class="p-6 border-b border-gray-100">
                                <h3 class="text-lg font-semibold text-dark-gray">Salary by Field</h3>
                                <p class="text-sm text-gray-600 mt-1">Current salary distribution across fields</p>
                            </div>
                            <div class="relative">
                                <div class="absolute top-4 right-4 flex gap-2 z-10">
                                    <button class="chart-action-btn" onclick="showAnalysis('salaryByField')">
                                        <i class="fas fa-lightbulb"></i>
                                    </button>
                                    <button class="chart-action-btn" onclick="showTableModal('salaryByField')">
                                        <i class="fas fa-table"></i>
                                    </button>
                                </div>
                                <div class="chart-container large">
                                    <canvas id="salaryByFieldChart"></canvas>
                                </div>
                            </div>
                        </div>

                        <!-- Salary Expectations vs Reality -->
                        <div class="minimal-card">
                            <div class="p-6 border-b border-gray-100">
                                <h3 class="text-lg font-semibold text-dark-gray">Salary Expectations vs Reality</h3>
                                <p class="text-sm text-gray-600 mt-1">Expected vs actual salary comparison</p>
                            </div>
                            <div class="relative">
                                <div class="absolute top-4 right-4 flex gap-2 z-10">
                                    <button class="chart-action-btn" onclick="showAnalysis('salaryComparison')">
                                        <i class="fas fa-lightbulb"></i>
                                    </button>
                                    <button class="chart-action-btn" onclick="showTableModal('salaryComparison')">
                                        <i class="fas fa-table"></i>
                                    </button>
                                </div>
                                <div class="chart-container large">
                                    <canvas id="salaryComparisonChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Out-of-Field Tab -->
                <div id="outfield" class="tab-content hidden">
                    <div class="grid grid-cols-1 xl:grid-cols-2 gap-6 mb-6">
                        <!-- Out-of-Field Job Types -->
                        <div class="minimal-card">
                            <div class="p-6 border-b border-gray-100">
                                <h3 class="text-lg font-semibold text-dark-gray">Out-of-Field Jobs</h3>
                                <p class="text-sm text-gray-600 mt-1">Job types for graduates working outside their field</p>
                            </div>
                            <div class="relative">
                                <div class="absolute top-4 right-4 flex gap-2 z-10">
                                    <button class="chart-action-btn" onclick="showAnalysis('outOfFieldJobs')">
                                        <i class="fas fa-lightbulb"></i>
                                    </button>
                                    <button class="chart-action-btn" onclick="showTableModal('outOfFieldJobs')">
                                        <i class="fas fa-table"></i>
                                    </button>
                                </div>
                                <div class="chart-container large">
                                    <canvas id="outOfFieldJobsChart"></canvas>
                                </div>
                            </div>
                        </div>

                        <!-- Out-of-Field Reasons -->
                        <div class="minimal-card">
                            <div class="p-6 border-b border-gray-100">
                                <h3 class="text-lg font-semibold text-dark-gray">Reasons for Out-of-Field Work</h3>
                                <p class="text-sm text-gray-600 mt-1">Why graduates work outside their field</p>
                            </div>
                            <div class="relative">
                                <div class="absolute top-4 right-4 flex gap-2 z-10">
                                    <button class="chart-action-btn" onclick="showAnalysis('outOfFieldReasons')">
                                        <i class="fas fa-lightbulb"></i>
                                    </button>
                                    <button class="chart-action-btn" onclick="showTableModal('outOfFieldReasons')">
                                        <i class="fas fa-table"></i>
                                    </button>
                                </div>
                                <div class="chart-container large">
                                    <canvas id="outOfFieldReasonsChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Academic Skills Requirement -->
                    <div class="minimal-card">
                        <div class="p-6 border-b border-gray-100">
                            <h3 class="text-lg font-semibold text-dark-gray">Academic Skills Requirement</h3>
                            <p class="text-sm text-gray-600 mt-1">Whether out-of-field jobs still require academic skills</p>
                        </div>
                        <div class="relative">
                            <div class="absolute top-4 right-4 flex gap-2 z-10">
                                <button class="chart-action-btn" onclick="showAnalysis('academicSkills')">
                                    <i class="fas fa-lightbulb"></i>
                                </button>
                                <button class="chart-action-btn" onclick="showTableModal('academicSkills')">
                                    <i class="fas fa-table"></i>
                                </button>
                            </div>
                            <div class="chart-container large">
                                <canvas id="academicSkillsChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Challenges Tab -->
                <div id="challenges" class="tab-content hidden">
                    <div class="grid grid-cols-1 xl:grid-cols-2 gap-6 mb-6">
                        <!-- Job Search Challenges -->
                        <div class="minimal-card">
                            <div class="p-6 border-b border-gray-100">
                                <h3 class="text-lg font-semibold text-dark-gray">Job Search Challenges</h3>
                                <p class="text-sm text-gray-600 mt-1">Main obstacles faced by graduates (12 categories)</p>
                            </div>
                            <div class="relative">
                                <div class="absolute top-4 right-4 flex gap-2 z-10">
                                    <button class="chart-action-btn" onclick="showAnalysis('jobChallenges')">
                                        <i class="fas fa-lightbulb"></i>
                                    </button>
                                    <button class="chart-action-btn" onclick="showTableModal('jobChallenges')">
                                        <i class="fas fa-table"></i>
                                    </button>
                                </div>
                                <div class="chart-container large">
                                    <canvas id="jobChallengesChart"></canvas>
                                </div>
                            </div>
                        </div>

                        <!-- Support Needed -->
                        <div class="minimal-card">
                            <div class="p-6 border-b border-gray-100">
                                <h3 class="text-lg font-semibold text-dark-gray">Support Needed</h3>
                                <p class="text-sm text-gray-600 mt-1">Types of support graduates need for success</p>
                            </div>
                            <div class="relative">
                                <div class="absolute top-4 right-4 flex gap-2 z-10">
                                    <button class="chart-action-btn" onclick="showAnalysis('supportNeeded')">
                                        <i class="fas fa-lightbulb"></i>
                                    </button>
                                    <button class="chart-action-btn" onclick="showTableModal('supportNeeded')">
                                        <i class="fas fa-table"></i>
                                    </button>
                                </div>
                                <div class="chart-container large">
                                    <canvas id="supportNeededChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Key Insights Section -->
                    <div class="minimal-card p-8">
                        <h3 class="text-xl font-semibold text-dark-gray mb-6">Key Insights & Recommendations</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            <div class="bg-gray-50 rounded-lg p-6">
                                <div class="flex items-center gap-3 mb-4">
                                    <div class="w-10 h-10 bg-primary-blue rounded-lg flex items-center justify-center text-white">
                                        <i class="fas fa-lightbulb"></i>
                                    </div>
                                    <h4 class="font-semibold text-gray-800">Challenge Mitigation</h4>
                                </div>
                                <p class="text-gray-600 text-sm leading-relaxed">Address the top employment challenges through targeted support programs and skill development initiatives.</p>
                            </div>
                            
                            <div class="bg-gray-50 rounded-lg p-6">
                                <div class="flex items-center gap-3 mb-4">
                                    <div class="w-10 h-10 bg-accent-red rounded-lg flex items-center justify-center text-white">
                                        <i class="fas fa-exchange-alt"></i>
                                    </div>
                                    <h4 class="font-semibold text-gray-800">Field Alignment</h4>
                                </div>
                                <p class="text-gray-600 text-sm leading-relaxed">Improve curriculum alignment with market demands to reduce out-of-field employment rates.</p>
                            </div>
                            
                            <div class="bg-gray-50 rounded-lg p-6">
                                <div class="flex items-center gap-3 mb-4">
                                    <div class="w-10 h-10 bg-green-500 rounded-lg flex items-center justify-center text-white">
                                        <i class="fas fa-graduation-cap"></i>
                                    </div>
                                    <h4 class="font-semibold text-gray-800">Skills Enhancement</h4>
                                </div>
                                <p class="text-gray-600 text-sm leading-relaxed">Focus on developing transferable skills and industry-relevant competencies for better employability.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for Table View and Analysis -->
    <div id="modal" class="modal hidden">
        <div class="modal-content w-full max-w-6xl">
            <div class="flex items-center justify-between mb-6">
                <h3 id="modalTitle" class="text-xl font-semibold text-dark-gray">Analysis</h3>
                <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600 transition-colors">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <div id="modalContent" class="max-h-[70vh] overflow-y-auto">
                <!-- Dynamic content will be loaded here -->
            </div>
            
            <div class="mt-6 flex justify-end space-x-3">
                <button onclick="exportModalData()" class="btn-primary">
                    <i class="fas fa-download"></i>
                    Export
                </button>
                <button onclick="closeModal()" class="btn-secondary">
                    Close
                </button>
            </div>
        </div>
    </div>

    <!-- Floating Action Buttons -->
    <div class="fixed bottom-6 right-6 flex flex-col gap-3 z-40">
        <button class="floating-btn" title="Refresh Data" onclick="refreshData()">
            <i class="fas fa-sync-alt"></i>
        </button>
        <button class="floating-btn" title="Export Report" onclick="exportReport()">
            <i class="fas fa-file-export"></i>
        </button>
        <button class="floating-btn" title="Settings" onclick="showSettings()">
            <i class="fas fa-cog"></i>
        </button>
    </div>

    <script>
        // Global variables
        let currentData = {};
        let filteredData = {};
        let charts = {};
        let globalFilters = {
            year: '',
            field: '',
            employment: '',
            gender: '',
            institution: ''
        };

        // Modern minimal color palette using your specified colors
        const colors = {
            primary: ['#30475E', '#F05454', '#E8E8E8', '#222831'],
            chart: ['#30475E', '#F05454', '#10B981', '#3B82F6', '#8B5CF6', '#F59E0B'],
            gradients: {
                blue: '#30475E',
                red: '#F05454',
                green: '#10B981',
                purple: '#8B5CF6',
                orange: '#F59E0B'
            }
        };

        // Chart configuration with minimal design
        const chartDefaults = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        padding: 15,
                        usePointStyle: true,
                        font: { family: 'Inter', size: 11, weight: '500' },
                        color: '#374151',
                        boxWidth: 10,
                        boxHeight: 10
                    }
                },
                tooltip: {
                    backgroundColor: 'rgba(255, 255, 255, 0.95)',
                    titleColor: '#374151',
                    bodyColor: '#6b7280',
                    borderColor: '#e5e7eb',
                    borderWidth: 1,
                    cornerRadius: 8,
                    padding: 12,
                    titleFont: { family: 'Inter', size: 13, weight: '600' },
                    bodyFont: { family: 'Inter', size: 12, weight: '500' }
                }
            },
            animation: { 
                duration: 800, 
                easing: 'easeOutQuart'
            }
        };

        // Utility functions
        function showNotification(message, type = 'success', duration = 3000) {
            const container = document.getElementById('notificationContainer');
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-triangle'} mr-2"></i>
                ${message}
            `;
            container.appendChild(notification);
            
            setTimeout(() => notification.classList.add('show'), 100);
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, duration);
        }

        function showLoading() {
            document.getElementById('loadingOverlay').classList.remove('hidden');
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').classList.add('hidden');
        }

        function animateCounter(element, target, suffix = '', duration = 1500) {
            if (!element || isNaN(target)) return;
            let current = 0;
            const increment = target / (duration / 16);
            const timer = setInterval(() => {
                current += increment;
                if (current >= target) {
                    current = target;
                    clearInterval(timer);
                }
                element.textContent = Math.round(current) + suffix;
            }, 16);
        }

        // API call wrapper
        async function apiCall(endpoint) {
            try {
                const urlParams = new URLSearchParams();
                Object.entries(globalFilters).forEach(([key, value]) => {
                    if (value) {
                        urlParams.append(key, value);
                    }
                });
                
                const url = urlParams.toString() ? `${endpoint}?${urlParams.toString()}` : endpoint;
                
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const result = await response.json();
                
                if (result.success === false) {
                    throw new Error(result.error || 'API call failed');
                }
                
                return result.data || result;
            } catch (error) {
                console.error(`API Error for ${endpoint}:`, error);
                return generateFallbackData(endpoint);
            }
        }

        function generateFallbackData(endpoint) {
            const baseTotal = 49;
            let adjustedTotal = baseTotal;
            
            if (globalFilters.year) adjustedTotal = Math.floor(adjustedTotal * 0.7);
            if (globalFilters.field) adjustedTotal = Math.floor(adjustedTotal * 0.6);
            if (globalFilters.employment) adjustedTotal = Math.floor(adjustedTotal * 0.8);
            if (globalFilters.gender) adjustedTotal = Math.floor(adjustedTotal * 0.5);
            if (globalFilters.institution) adjustedTotal = Math.floor(adjustedTotal * 0.6);
            
            switch(endpoint) {
                case '/api/summary-stats':
                    return {
                        total_graduates: adjustedTotal,
                        employment_rate: 73.5,
                        fields_count: globalFilters.field ? 1 : 6,
                        year_range: '2020-2024'
                    };
                default:
                    return { labels: [], data: [], total: adjustedTotal };
            }
        }

        // Filter functions
        function applyFilters() {
            globalFilters.year = document.getElementById('yearFilter').value;
            globalFilters.field = document.getElementById('fieldFilter').value;
            globalFilters.employment = document.getElementById('employmentFilter').value;
            globalFilters.gender = document.getElementById('genderFilter').value;
            globalFilters.institution = document.getElementById('institutionFilter').value;
            
            updateActiveFiltersDisplay();
            loadCurrentTabData();
            loadSummaryStats();
            
            showNotification('Filters applied successfully', 'success', 2000);
        }

        function updateActiveFiltersDisplay() {
            const container = document.getElementById('activeFilters');
            const filterCount = document.getElementById('filterCount');
            
            container.innerHTML = '';
            let activeCount = 0;
            
            Object.entries(globalFilters).forEach(([key, value]) => {
                if (value) {
                    activeCount++;
                    const badge = document.createElement('span');
                    badge.className = 'filter-badge';
                    badge.innerHTML = `
                        ${key.charAt(0).toUpperCase() + key.slice(1)}: ${value}
                        <button onclick="removeFilter('${key}')" class="ml-2 hover:bg-white hover:text-primary-blue rounded-full w-4 h-4 flex items-center justify-center text-xs">
                            <i class="fas fa-times"></i>
                        </button>
                    `;
                    container.appendChild(badge);
                }
            });
            
            if (activeCount === 0) {
                container.innerHTML = '<span class="text-sm text-gray-500 italic">No filters applied</span>';
            }
            
            filterCount.textContent = `${activeCount} active`;
            filterCount.className = activeCount > 0 ? 
                'text-xs bg-primary-blue text-white px-2 py-1 rounded-full' :
                'text-xs bg-gray-200 text-gray-600 px-2 py-1 rounded-full';
        }

        function removeFilter(filterKey) {
            globalFilters[filterKey] = '';
            document.getElementById(filterKey + 'Filter').value = '';
            applyFilters();
        }

        function resetFilters() {
            Object.keys(globalFilters).forEach(key => {
                globalFilters[key] = '';
                const element = document.getElementById(key + 'Filter');
                if (element) element.value = '';
            });
            updateActiveFiltersDisplay();
            loadCurrentTabData();
            loadSummaryStats();
            showNotification('All filters reset', 'success');
        }

        // Tab functions
        function switchTab(tabName) {
            document.querySelectorAll('.nav-button').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            document.getElementById(tabName).classList.remove('hidden');
            
            loadTabData(tabName);
            showNotification(`${tabName.charAt(0).toUpperCase() + tabName.slice(1)} tab loaded`, 'success', 1500);
        }

        function loadCurrentTabData() {
            const activeTab = document.querySelector('.nav-button.active');
            if (activeTab) {
                const tabName = activeTab.getAttribute('data-tab');
                loadTabData(tabName);
            }
        }

        // Data loading functions
        async function loadSummaryStats() {
            try {
                showLoading();
                
                const data = await apiCall('/api/summary-stats');
                
                const totalGraduates = data.total_graduates || 49;
                const employmentRate = data.employment_rate || 73.5;
                const fieldsCount = data.fields_count || 6;
                const yearRange = data.year_range || '2020-2024';
                
                setTimeout(() => {
                    animateCounter(document.getElementById('totalGraduates'), totalGraduates);
                    animateCounter(document.getElementById('headerTotalGraduates'), totalGraduates);
                    document.getElementById('graduatesProgress').style.width = '100%';
                }, 200);
                
                setTimeout(() => {
                    animateCounter(document.getElementById('employmentRate'), employmentRate, '%');
                    animateCounter(document.getElementById('headerEmploymentRate'), employmentRate, '%');
                    document.getElementById('employmentProgress').style.width = employmentRate + '%';
                }, 400);
                
                setTimeout(() => {
                    animateCounter(document.getElementById('fieldsCount'), fieldsCount);
                    document.getElementById('fieldsProgress').style.width = Math.min((fieldsCount / 8) * 100, 100) + '%';
                }, 600);
                
                setTimeout(() => {
                    document.getElementById('yearRange').textContent = yearRange;
                    document.getElementById('yearsProgress').style.width = '80%';
                }, 800);
                
                currentData.summaryStats = { totalGraduates, employmentRate, fieldsCount, yearRange };
                
            } catch (error) {
                console.error('Error loading summary stats:', error);
                showNotification('Failed to load summary statistics', 'error');
            } finally {
                hideLoading();
            }
        }

        async function loadTabData(tabName) {
            showLoading();
            try {
                switch(tabName) {
                    case 'overview':
                        await Promise.all([
                            loadEmploymentStatus(),
                            loadJobTypes(),
                            loadTimeToEmployment(),
                            loadFieldYear()
                        ]);
                        break;
                    case 'employment':
                        await Promise.all([
                            loadSuccessFactors(),
                            loadEmploymentSectors()
                        ]);
                        break;
                    case 'salary':
                        await Promise.all([
                            loadSalaryByField(),
                            loadSalaryComparison()
                        ]);
                        break;
                    case 'outfield':
                        await Promise.all([
                            loadOutOfFieldJobs(),
                            loadOutOfFieldReasons(),
                            loadAcademicSkills()
                        ]);
                        break;
                    case 'challenges':
                        await Promise.all([
                            loadJobChallenges(),
                            loadSupportNeeded()
                        ]);
                        break;
                }
            } catch (error) {
                console.error(`Error loading ${tabName} data:`, error);
                showNotification(`Failed to load ${tabName} data`, 'error');
            } finally {
                hideLoading();
            }
        }

        // Chart loading functions
        async function loadEmploymentStatus() {
            try {
                const data = await apiCall('/api/employment-status');
                currentData.employmentStatus = data;
                
                const ctx = document.getElementById('employmentStatusChart');
                if (!ctx) return;
                
                if (charts.employmentStatus) {
                    charts.employmentStatus.destroy();
                }
                
                const chartData = data.chart_data || generateEmploymentStatusData();
                
                charts.employmentStatus = new Chart(ctx.getContext('2d'), {
                    type: 'doughnut',
                    data: {
                        labels: chartData.labels,
                        datasets: [{
                            data: chartData.data,
                            backgroundColor: colors.chart.slice(0, chartData.labels.length),
                            borderWidth: 3,
                            borderColor: '#ffffff',
                            hoverOffset: 8
                        }]
                    },
                    options: {
                        ...chartDefaults,
                        cutout: '65%'
                    }
                });
                
                const total = chartData.data ? chartData.data.reduce((sum, val) => sum + val, 0) : 0;
                document.getElementById('employmentStatusTotal').textContent = total;
                
            } catch (error) {
                console.error('Error loading employment status:', error);
            }
        }

        function generateEmploymentStatusData() {
            let baseData = {
                labels: ['Ya, bekerja sepenuh masa', 'Tidak, sedang mencari pekerjaan', 'Ya, bekerja separuh masa'],
                data: [30, 12, 7],
                total: 49
            };
            
            if (globalFilters.employment) {
                if (globalFilters.employment === 'Ya, bekerja sepenuh masa') {
                    baseData = { labels: ['Ya, bekerja sepenuh masa'], data: [30], total: 30 };
                } else if (globalFilters.employment === 'Tidak, sedang mencari pekerjaan') {
                    baseData = { labels: ['Tidak, sedang mencari pekerjaan'], data: [12], total: 12 };
                } else if (globalFilters.employment === 'Ya, bekerja separuh masa') {
                    baseData = { labels: ['Ya, bekerja separuh masa'], data: [7], total: 7 };
                }
            }
            
            if (globalFilters.year || globalFilters.field || globalFilters.gender || globalFilters.institution) {
                const reductionFactor = 0.6;
                baseData.data = baseData.data.map(val => Math.floor(val * reductionFactor));
                baseData.total = baseData.data.reduce((sum, val) => sum + val, 0);
            }
            
            return baseData;
        }

        async function loadJobTypes() {
            try {
                const data = await apiCall('/api/job-types');
                currentData.jobTypes = data;
                
                const ctx = document.getElementById('jobTypesChart');
                if (!ctx) return;
                
                if (charts.jobTypes) {
                    charts.jobTypes.destroy();
                }
                
                const chartData = data.chart_data || generateJobTypesData();
                
                charts.jobTypes = new Chart(ctx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: chartData.labels,
                        datasets: [{
                            label: 'Number of Graduates',
                            data: chartData.data,
                            backgroundColor: colors.chart.slice(0, chartData.labels.length),
                            borderRadius: 6,
                            borderSkipped: false
                        }]
                    },
                    options: {
                        ...chartDefaults,
                        plugins: {
                            ...chartDefaults.plugins,
                            legend: { display: false }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: { color: '#6b7280', font: { family: 'Inter' } },
                                grid: { color: '#f3f4f6' }
                            },
                            x: {
                                ticks: { color: '#6b7280', font: { family: 'Inter' }, maxRotation: 45 },
                                grid: { display: false }
                            }
                        }
                    }
                });
                
                const total = chartData.data ? chartData.data.reduce((sum, val) => sum + val, 0) : 0;
                document.getElementById('jobTypesTotal').textContent = total;
                
            } catch (error) {
                console.error('Error loading job types:', error);
            }
        }

        function generateJobTypesData() {
            let baseData = {
                labels: [
                    'Bekerja dalam bidang pengajian',
                    'Bekerja di luar bidang pengajian',
                    'Pekerja ekonomi gig',
                    'Tidak bekerja',
                    'Mengusahakan perniagaan sendiri'
                ],
                data: [20, 15, 8, 4, 2],
                total: 49
            };
            
            if (globalFilters.year || globalFilters.field || globalFilters.gender || globalFilters.institution) {
                const reductionFactor = 0.7;
                baseData.data = baseData.data.map(val => Math.floor(val * reductionFactor));
                baseData.total = baseData.data.reduce((sum, val) => sum + val, 0);
            }
            
            return baseData;
        }

        async function loadTimeToEmployment() {
            try {
                const data = await apiCall('/api/time-to-employment');
                currentData.timeToEmployment = data;
                
                const ctx = document.getElementById('timeToEmploymentChart');
                if (!ctx) return;
                
                if (charts.timeToEmployment) {
                    charts.timeToEmployment.destroy();
                }
                
                const chartData = data.chart_data || generateTimeToEmploymentData();
                
                charts.timeToEmployment = new Chart(ctx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: chartData.labels,
                        datasets: [{
                            label: 'Number of Graduates',
                            data: chartData.data,
                            backgroundColor: 'rgba(48, 71, 94, 0.1)',
                            borderColor: '#30475E',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4,
                            pointBackgroundColor: '#30475E',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2,
                            pointRadius: 6
                        }]
                    },
                    options: {
                        ...chartDefaults,
                        plugins: {
                            ...chartDefaults.plugins,
                            legend: { display: false }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: { color: '#6b7280' },
                                grid: { color: '#f3f4f6' }
                            },
                            x: {
                                ticks: { color: '#6b7280' },
                                grid: { display: false }
                            }
                        }
                    }
                });
                
                const total = chartData.data ? chartData.data.reduce((sum, val) => sum + val, 0) : 0;
                document.getElementById('timeToEmploymentTotal').textContent = total;
                
            } catch (error) {
                console.error('Error loading time to employment:', error);
            }
        }

        function generateTimeToEmploymentData() {
            let baseData = {
                labels: ['Kurang dari 3 bulan', '3-6 bulan', '6-12 bulan', 'Lebih dari 1 tahun'],
                data: [15, 12, 7, 3],
                total: 37
            };
            
            if (globalFilters.year || globalFilters.field || globalFilters.gender || globalFilters.institution) {
                const reductionFactor = 0.6;
                baseData.data = baseData.data.map(val => Math.floor(val * reductionFactor));
                baseData.total = baseData.data.reduce((sum, val) => sum + val, 0);
            }
            
            return baseData;
        }

        async function loadFieldYear() {
            try {
                const data = await apiCall('/api/graduates-by-field-year');
                currentData.fieldYear = data;
                
                const ctx = document.getElementById('fieldYearChart');
                if (!ctx) return;
                
                if (charts.fieldYear) {
                    charts.fieldYear.destroy();
                }
                
                const chartData = data.chart_data || generateFieldYearData();
                
                charts.fieldYear = new Chart(ctx.getContext('2d'), {
                    type: 'bar',
                    data: chartData,
                    options: {
                        ...chartDefaults,
                        scales: {
                            x: { 
                                stacked: true,
                                ticks: { color: '#6b7280' },
                                grid: { display: false }
                            },
                            y: { 
                                stacked: true,
                                beginAtZero: true,
                                ticks: { color: '#6b7280' },
                                grid: { color: '#f3f4f6' }
                            }
                        }
                    }
                });
                
                let total = 0;
                if (chartData.datasets && chartData.datasets.length > 0) {
                    total = chartData.datasets.reduce((sum, dataset) => {
                        return sum + dataset.data.reduce((dataSum, val) => dataSum + val, 0);
                    }, 0);
                }
                document.getElementById('fieldYearTotal').textContent = total;
                
            } catch (error) {
                console.error('Error loading field year:', error);
            }
        }

        function generateFieldYearData() {
            const fields = ['Teknologi Maklumat', 'Perniagaan', 'Kejuruteraan', 'Perakaunan'];
            const years = ['2020', '2021', '2022', '2023', '2024'];
            const yearTotals = [8, 10, 12, 11, 8];
            
            return {
                labels: years,
                datasets: fields.map((field, index) => ({
                    label: field,
                    data: yearTotals.map(total => {
                        const fieldShare = Math.floor(total / fields.length) + (index < (total % fields.length) ? 1 : 0);
                        return fieldShare;
                    }),
                    backgroundColor: colors.chart[index % colors.chart.length],
                    borderRadius: 4
                }))
            };
        }

        // Load other chart functions with minimal design
        async function loadSuccessFactors() {
            const data = generateSuccessFactorsData();
            currentData.successFactors = data;
            
            const ctx = document.getElementById('successFactorsChart');
            if (!ctx) return;
            
            if (charts.successFactors) {
                charts.successFactors.destroy();
            }
            
            charts.successFactors = new Chart(ctx.getContext('2d'), {
                type: 'doughnut',
                data: {
                    labels: data.labels,
                    datasets: [{
                        data: data.data,
                        backgroundColor: colors.chart.slice(0, data.labels.length),
                        borderWidth: 3,
                        borderColor: '#ffffff'
                    }]
                },
                options: {
                    ...chartDefaults,
                    cutout: '60%'
                }
            });
        }

        function generateSuccessFactorsData() {
            return {
                labels: [
                    'Kemahiran komunikasi',
                    'Pengalaman praktikal',
                    'Networking yang kuat',
                    'Sijil profesional',
                    'Prestasi akademik'
                ],
                data: [120, 100, 80, 60, 40]
            };
        }

        async function loadEmploymentSectors() {
            const data = generateEmploymentSectorsData();
            currentData.employmentSectors = data;
            
            const ctx = document.getElementById('employmentSectorsChart');
            if (!ctx) return;
            
            if (charts.employmentSectors) {
                charts.employmentSectors.destroy();
            }
            
            charts.employmentSectors = new Chart(ctx.getContext('2d'), {
                type: 'polarArea',
                data: {
                    labels: data.labels,
                    datasets: [{
                        data: data.data,
                        backgroundColor: colors.chart.slice(0, data.labels.length)
                    }]
                },
                options: {
                    ...chartDefaults,
                    scales: {
                        r: {
                            beginAtZero: true,
                            ticks: { color: '#6b7280' },
                            grid: { color: '#f3f4f6' }
                        }
                    }
                }
            });
        }

        function generateEmploymentSectorsData() {
            return {
                labels: ['Sektor Swasta', 'Sektor Kerajaan', 'GLC', 'Multinasional', 'SME'],
                data: [200, 125, 75, 50, 40]
            };
        }

        async function loadSalaryByField() {
            const data = generateSalaryByFieldData();
            currentData.salaryByField = data;
            
            const ctx = document.getElementById('salaryByFieldChart');
            if (!ctx) return;
            
            if (charts.salaryByField) {
                charts.salaryByField.destroy();
            }
            
            charts.salaryByField = new Chart(ctx.getContext('2d'), {
                type: 'bar',
                data: data,
                options: {
                    ...chartDefaults,
                    scales: {
                        x: { 
                            stacked: true,
                            ticks: { color: '#6b7280', maxRotation: 45 },
                            grid: { display: false }
                        },
                        y: { 
                            stacked: true,
                            beginAtZero: true,
                            ticks: { color: '#6b7280' },
                            grid: { color: '#f3f4f6' }
                        }
                    }
                }
            });
        }

        function generateSalaryByFieldData() {
            const fields = ['IT', 'Engineering', 'Business', 'Accounting'];
            const salaryRanges = ['RM2000-2999', 'RM3000-3999', 'RM4000-4999', 'RM5000+'];
            
            return {
                labels: fields,
                datasets: salaryRanges.map((range, index) => ({
                    label: range,
                    data: fields.map(() => Math.floor(Math.random() * 30) + 10),
                    backgroundColor: colors.chart[index % colors.chart.length],
                    borderRadius: 4
                }))
            };
        }

        async function loadSalaryComparison() {
            const data = generateSalaryComparisonData();
            currentData.salaryComparison = data;
            
            const ctx = document.getElementById('salaryComparisonChart');
            if (!ctx) return;
            
            if (charts.salaryComparison) {
                charts.salaryComparison.destroy();
            }
            
            charts.salaryComparison = new Chart(ctx.getContext('2d'), {
                type: 'bar',
                data: data,
                options: {
                    ...chartDefaults,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { color: '#6b7280' },
                            grid: { color: '#f3f4f6' }
                        },
                        x: {
                            ticks: { color: '#6b7280', maxRotation: 45 },
                            grid: { display: false }
                        }
                    }
                }
            });
        }

        function generateSalaryComparisonData() {
            const ranges = ['RM2000-2999', 'RM3000-3999', 'RM4000-4999', 'RM5000+'];
            return {
                labels: ranges,
                datasets: [
                    {
                        label: 'Expected',
                        data: [80, 120, 100, 60],
                        backgroundColor: '#30475E',
                        borderRadius: 4
                    },
                    {
                        label: 'Actual',
                        data: [120, 100, 80, 40],
                        backgroundColor: '#F05454',
                        borderRadius: 4
                    }
                ]
            };
        }

        async function loadOutOfFieldJobs() {
            const data = generateOutOfFieldJobsData();
            currentData.outOfFieldJobs = data;
            
            const ctx = document.getElementById('outOfFieldJobsChart');
            if (!ctx) return;
            
            if (charts.outOfFieldJobs) {
                charts.outOfFieldJobs.destroy();
            }
            
            charts.outOfFieldJobs = new Chart(ctx.getContext('2d'), {
                type: 'doughnut',
                data: {
                    labels: data.labels,
                    datasets: [{
                        data: data.data,
                        backgroundColor: colors.chart.slice(0, data.labels.length),
                        borderWidth: 3,
                        borderColor: '#ffffff'
                    }]
                },
                options: {
                    ...chartDefaults,
                    cutout: '60%'
                }
            });
        }

        function generateOutOfFieldJobsData() {
            return {
                labels: ['Gig Economy', 'Customer Service', 'Sales', 'Admin', 'Others'],
                data: [50, 30, 25, 20, 15]
            };
        }

        async function loadOutOfFieldReasons() {
            const data = generateOutOfFieldReasonsData();
            currentData.outOfFieldReasons = data;
            
            const ctx = document.getElementById('outOfFieldReasonsChart');
            if (!ctx) return;
            
            if (charts.outOfFieldReasons) {
                charts.outOfFieldReasons.destroy();
            }
            
            charts.outOfFieldReasons = new Chart(ctx.getContext('2d'), {
                type: 'bar',
                data: {
                    labels: data.labels,
                    datasets: [{
                        label: 'Responses',
                        data: data.data,
                        backgroundColor: colors.chart.slice(0, data.labels.length),
                        borderRadius: 4
                    }]
                },
                options: {
                    ...chartDefaults,
                    indexAxis: 'y',
                    plugins: {
                        ...chartDefaults.plugins,
                        legend: { display: false }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            ticks: { color: '#6b7280' },
                            grid: { color: '#f3f4f6' }
                        },
                        y: {
                            ticks: { color: '#6b7280' },
                            grid: { display: false }
                        }
                    }
                }
            });
        }

        function generateOutOfFieldReasonsData() {
            return {
                labels: [
                    'No opportunities in field',
                    'Higher salary outside',
                    'Personal interest',
                    'Better career prospects',
                    'Location preference'
                ],
                data: [45, 35, 30, 25, 15]
            };
        }

        async function loadAcademicSkills() {
            const data = generateAcademicSkillsData();
            currentData.academicSkills = data;
            
            const ctx = document.getElementById('academicSkillsChart');
            if (!ctx) return;
            
            if (charts.academicSkills) {
                charts.academicSkills.destroy();
            }
            
            charts.academicSkills = new Chart(ctx.getContext('2d'), {
                type: 'doughnut',
                data: {
                    labels: data.labels,
                    datasets: [{
                        data: data.data,
                        backgroundColor: colors.primary.slice(0, data.labels.length),
                        borderWidth: 3,
                        borderColor: '#ffffff'
                    }]
                },
                options: {
                    ...chartDefaults,
                    cutout: '60%'
                }
            });
        }

        function generateAcademicSkillsData() {
            return {
                labels: ['Yes', 'No', 'Partially'],
                data: [60, 20, 20]
            };
        }

        async function loadJobChallenges() {
            const data = generateJobChallengesData();
            currentData.jobChallenges = data;
            
            const ctx = document.getElementById('jobChallengesChart');
            if (!ctx) return;
            
            if (charts.jobChallenges) {
                charts.jobChallenges.destroy();
            }
            
            charts.jobChallenges = new Chart(ctx.getContext('2d'), {
                type: 'bar',
                data: {
                    labels: data.labels,
                    datasets: [{
                        label: 'Responses',
                        data: data.data,
                        backgroundColor: colors.chart.slice(0, data.labels.length),
                        borderRadius: 4
                    }]
                },
                options: {
                    ...chartDefaults,
                    indexAxis: 'y',
                    plugins: {
                        ...chartDefaults.plugins,
                        legend: { display: false }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            ticks: { color: '#6b7280' },
                            grid: { color: '#f3f4f6' }
                        },
                        y: {
                            ticks: { color: '#6b7280' },
                            grid: { display: false }
                        }
                    }
                }
            });
        }

        function generateJobChallengesData() {
            return {
                labels: [
                    'Lack of experience',
                    'High competition',
                    'Skills mismatch',
                    'No field opportunities',
                    'Low salary offers',
                    'Location issues',
                    'Soft skills gap',
                    'Poor networking',
                    'Interview difficulties',
                    'No certifications',
                    'Communication barriers',
                    'No practical experience'
                ],
                data: [85, 75, 65, 55, 50, 45, 40, 35, 30, 25, 20, 15]
            };
        }

        async function loadSupportNeeded() {
            const data = generateSupportNeededData();
            currentData.supportNeeded = data;
            
            const ctx = document.getElementById('supportNeededChart');
            if (!ctx) return;
            
            if (charts.supportNeeded) {
                charts.supportNeeded.destroy();
            }
            
            charts.supportNeeded = new Chart(ctx.getContext('2d'), {
                type: 'bar',
                data: {
                    labels: data.labels,
                    datasets: [{
                        label: 'Requests',
                        data: data.data,
                        backgroundColor: colors.chart.slice(0, data.labels.length),
                        borderRadius: 4
                    }]
                },
                options: {
                    ...chartDefaults,
                    plugins: {
                        ...chartDefaults.plugins,
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { color: '#6b7280' },
                            grid: { color: '#f3f4f6' }
                        },
                        x: {
                            ticks: { color: '#6b7280', maxRotation: 45 },
                            grid: { display: false }
                        }
                    }
                }
            });
        }

        function generateSupportNeededData() {
            return {
                labels: [
                    'Skills Training',
                    'Financial Aid',
                    'Career Guidance',
                    'Networking',
                    'Job Access',
                    'Entrepreneurship'
                ],
                data: [90, 75, 60, 55, 50, 35]
            };
        }

        // Comparison functions
        function toggleComparison() {
            const panel = document.getElementById('comparisonPanel');
            const isHidden = panel.classList.contains('hidden');
            
            if (isHidden) {
                panel.classList.remove('hidden');
                showNotification('Comparison mode enabled', 'success');
            } else {
                panel.classList.add('hidden');
                document.getElementById('comparisonResults').classList.add('hidden');
                showNotification('Comparison mode disabled', 'success');
            }
        }

        async function updateComparison() {
            const year1 = document.getElementById('compareYear1').value;
            const year2 = document.getElementById('compareYear2').value;
            const field1 = document.getElementById('compareField1').value;
            const field2 = document.getElementById('compareField2').value;
            const inst1 = document.getElementById('compareInst1').value;
            const inst2 = document.getElementById('compareInst2').value;
            
            let comparisons = [];
            
            try {
                if (year1 && year2 && year1 !== year2) {
                    const yearComparison = await performYearComparison(year1, year2);
                    comparisons.push(yearComparison);
                }
                
                if (field1 && field2 && field1 !== field2) {
                    const fieldComparison = await performFieldComparison(field1, field2);
                    comparisons.push(fieldComparison);
                }
                
                if (inst1 && inst2 && inst1 !== inst2) {
                    const instComparison = await performInstitutionComparison(inst1, inst2);
                    comparisons.push(instComparison);
                }
                
                if (comparisons.length > 0) {
                    displayComparisonResults(comparisons);
                    createComparisonCharts(comparisons);
                    document.getElementById('comparisonResults').classList.remove('hidden');
                    showNotification(`Comparison analysis completed`, 'success');
                } else {
                    showNotification('Please select comparison parameters', 'error');
                }
                
            } catch (error) {
                console.error('Comparison error:', error);
                showNotification('Comparison analysis failed', 'error');
            }
        }

        async function performYearComparison(year1, year2) {
            return {
                type: 'Year Comparison',
                subtitle: `${year1} vs ${year2}`,
                items: [
                    { name: year1, employmentRate: 72, totalGraduates: 25, fieldsCount: 6 },
                    { name: year2, employmentRate: 78, totalGraduates: 24, fieldsCount: 6 }
                ]
            };
        }

        async function performFieldComparison(field1, field2) {
            return {
                type: 'Field Comparison',
                subtitle: `${field1} vs ${field2}`,
                items: [
                    { name: field1, employmentRate: 82, totalGraduates: 15, fieldsCount: 1 },
                    { name: field2, employmentRate: 76, totalGraduates: 12, fieldsCount: 1 }
                ]
            };
        }

        async function performInstitutionComparison(inst1, inst2) {
            return {
                type: 'Institution Comparison',
                subtitle: `${inst1} vs ${inst2}`,
                items: [
                    { name: inst1, employmentRate: 79, totalGraduates: 20, fieldsCount: 5 },
                    { name: inst2, employmentRate: 73, totalGraduates: 18, fieldsCount: 4 }
                ]
            };
        }

        function createComparisonCharts(comparisons) {
            const comparisonCtx = document.getElementById('comparisonChart');
            if (comparisonCtx && comparisons.length > 0) {
                if (charts.comparison) {
                    charts.comparison.destroy();
                }
                
                const comparison = comparisons[0];
                charts.comparison = new Chart(comparisonCtx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: comparison.items.map(item => item.name),
                        datasets: [{
                            label: 'Employment Rate (%)',
                            data: comparison.items.map(item => item.employmentRate),
                            backgroundColor: ['#30475E', '#F05454'],
                            borderRadius: 6
                        }]
                    },
                    options: {
                        ...chartDefaults,
                        plugins: {
                            ...chartDefaults.plugins,
                            legend: { display: false }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100,
                                ticks: { 
                                    color: '#6b7280',
                                    callback: function(value) {
                                        return value + '%';
                                    }
                                },
                                grid: { color: '#f3f4f6' }
                            },
                            x: {
                                ticks: { color: '#6b7280' },
                                grid: { display: false }
                            }
                        }
                    }
                });
            }
            
            const radarCtx = document.getElementById('comparisonRadarChart');
            if (radarCtx && comparisons.length > 0) {
                if (charts.comparisonRadar) {
                    charts.comparisonRadar.destroy();
                }
                
                const comparison = comparisons[0];
                charts.comparisonRadar = new Chart(radarCtx.getContext('2d'), {
                    type: 'radar',
                    data: {
                        labels: ['Employment Rate', 'Total Graduates', 'Field Diversity', 'Market Readiness'],
                        datasets: comparison.items.map((item, index) => ({
                            label: item.name,
                            data: [
                                item.employmentRate,
                                (item.totalGraduates / 50) * 100,
                                (item.fieldsCount / 8) * 100,
                                Math.random() * 30 + 70
                            ],
                            backgroundColor: index === 0 ? 'rgba(48, 71, 94, 0.2)' : 'rgba(240, 84, 84, 0.2)',
                            borderColor: index === 0 ? '#30475E' : '#F05454',
                            borderWidth: 2,
                            pointBackgroundColor: index === 0 ? '#30475E' : '#F05454'
                        }))
                    },
                    options: {
                        ...chartDefaults,
                        scales: {
                            r: {
                                beginAtZero: true,
                                max: 100,
                                ticks: { color: '#6b7280' },
                                grid: { color: '#e5e7eb' }
                            }
                        }
                    }
                });
            }
        }

        function displayComparisonResults(comparisons) {
            const content = document.getElementById('comparisonContent');
            content.innerHTML = '';
            
            comparisons.forEach((comparison) => {
                const item1 = comparison.items[0];
                const item2 = comparison.items[1];
                
                const employmentDiff = (item2.employmentRate - item1.employmentRate).toFixed(1);
                const graduatesDiff = item2.totalGraduates - item1.totalGraduates;
                
                const comparisonHTML = `
                    <div class="minimal-card p-6">
                        <div class="text-center mb-4">
                            <h5 class="text-lg font-semibold text-dark-gray">${comparison.type}</h5>
                            <p class="text-sm text-gray-600">${comparison.subtitle}</p>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4 mb-6">
                            <div class="text-center p-4 bg-gray-50 rounded-lg">
                                <h6 class="font-medium text-gray-800 mb-2">${item1.name}</h6>
                                <div class="text-2xl font-bold text-primary-blue">${item1.employmentRate}%</div>
                                <div class="text-xs text-gray-500">Employment Rate</div>
                                <div class="text-lg font-semibold text-gray-700 mt-2">${item1.totalGraduates}</div>
                                <div class="text-xs text-gray-500">Graduates</div>
                            </div>
                            
                            <div class="text-center p-4 bg-gray-50 rounded-lg">
                                <h6 class="font-medium text-gray-800 mb-2">${item2.name}</h6>
                                <div class="text-2xl font-bold text-accent-red">${item2.employmentRate}%</div>
                                <div class="text-xs text-gray-500">Employment Rate</div>
                                <div class="text-lg font-semibold text-gray-700 mt-2">${item2.totalGraduates}</div>
                                <div class="text-xs text-gray-500">Graduates</div>
                            </div>
                        </div>
                        
                        <div class="bg-gray-50 rounded-lg p-4">
                            <h6 class="font-medium text-gray-800 mb-3 text-center">Key Differences</h6>
                            <div class="grid grid-cols-2 gap-4 text-sm">
                                <div class="text-center">
                                    <span class="font-bold ${parseFloat(employmentDiff) >= 0 ? 'text-green-600' : 'text-red-600'}">
                                        ${parseFloat(employmentDiff) >= 0 ? '+' : ''}${employmentDiff}%
                                    </span>
                                    <div class="text-xs text-gray-500">Employment Rate</div>
                                </div>
                                <div class="text-center">
                                    <span class="font-bold ${graduatesDiff >= 0 ? 'text-green-600' : 'text-red-600'}">
                                        ${graduatesDiff >= 0 ? '+' : ''}${graduatesDiff}
                                    </span>
                                    <div class="text-xs text-gray-500">Graduates</div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                content.innerHTML += comparisonHTML;
            });
        }

        // Modal functions
        function showAnalysis(chartType) {
            const modal = document.getElementById('modal');
            const title = document.getElementById('modalTitle');
            const content = document.getElementById('modalContent');
            
            title.textContent = `${chartType.charAt(0).toUpperCase() + chartType.slice(1)} Analysis`;
            
            const analysisData = currentData[chartType];
            if (analysisData) {
                content.innerHTML = generateAnalysisContent(chartType, analysisData);
            } else {
                content.innerHTML = '<div class="text-center py-8"><p class="text-gray-500">No analysis data available.</p></div>';
            }
            
            modal.classList.remove('hidden');
        }

        function showTableModal(chartType) {
            const modal = document.getElementById('modal');
            const title = document.getElementById('modalTitle');
            const content = document.getElementById('modalContent');
            
            title.textContent = `${chartType.charAt(0).toUpperCase() + chartType.slice(1)} Data Table`;
            
            const tableData = currentData[chartType];
            if (tableData) {
                content.innerHTML = generateTableContent(chartType, tableData);
            } else {
                content.innerHTML = '<div class="text-center py-8"><p class="text-gray-500">No table data available.</p></div>';
            }
            
            modal.classList.remove('hidden');
        }

        function generateAnalysisContent(chartType, data) {
            const total = data.data ? data.data.reduce((sum, val) => sum + val, 0) : 0;
            
            return `
                <div class="space-y-6">
                    <div class="bg-gray-50 border border-gray-200 rounded-lg p-6">
                        <h4 class="font-semibold text-gray-800 mb-4">Key Insights</h4>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="text-center p-4 bg-white rounded-lg">
                                <div class="text-2xl font-bold text-primary-blue">${total}</div>
                                <div class="text-sm text-gray-600">Total Responses</div>
                            </div>
                            <div class="text-center p-4 bg-white rounded-lg">
                                <div class="text-2xl font-bold text-accent-red">${data.labels ? data.labels.length : 0}</div>
                                <div class="text-sm text-gray-600">Categories</div>
                            </div>
                            <div class="text-center p-4 bg-white rounded-lg">
                                <div class="text-2xl font-bold text-green-600">${data.data ? Math.max(...data.data) : 0}</div>
                                <div class="text-sm text-gray-600">Highest Value</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-6">
                        <h4 class="font-semibold text-blue-800 mb-3">Strategic Recommendations</h4>
                        <div class="text-blue-700 space-y-2">
                            <p> Focus on addressing the most significant challenges identified in the data</p>
                            <p> Develop targeted programs to improve employment outcomes</p>
                            <p> Enhance industry partnerships and career guidance services</p>
                            <p> Monitor progress through regular data collection and analysis</p>
                        </div>
                    </div>
                </div>
            `;
        }

        function generateTableContent(chartType, data) {
            if (!data.labels || !data.data) {
                return '<div class="text-center py-8"><p class="text-gray-500">No table data available</p></div>';
            }
            
            let tableHTML = `
                <div class="table-responsive">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Category</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Count</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Percentage</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Visual</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
            `;
            
            const total = data.data.reduce((sum, val) => sum + val, 0);
            
            data.labels.forEach((label, index) => {
                const count = data.data[index];
                const percentage = total > 0 ? Math.round((count / total) * 100) : 0;
                
                tableHTML += `
                    <tr class="table-hover">
                        <td class="px-6 py-4 text-sm font-medium text-gray-900">${label}</td>
                        <td class="px-6 py-4 text-sm text-gray-600">${count.toLocaleString()}</td>
                        <td class="px-6 py-4 text-sm text-gray-600">${percentage}%</td>
                        <td class="px-6 py-4">
                            <div class="flex items-center">
                                <div class="flex-1 mr-4">
                                    <div class="w-full bg-gray-200 rounded-full h-2">
                                        <div class="bg-primary-blue h-2 rounded-full" style="width: ${percentage}%"></div>
                                    </div>
                                </div>
                                <span class="text-sm font-medium">${percentage}%</span>
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            tableHTML += `
                        </tbody>
                    </table>
                </div>
            `;
            
            return tableHTML;
        }

        function closeModal() {
            document.getElementById('modal').classList.add('hidden');
        }

        // Export functions
        function exportData() {
            showNotification('Data export started', 'success');
        }

        function exportModalData() {
            showNotification('Modal data exported', 'success');
        }

        function exportReport() {
            showNotification('Report generation started', 'success');
        }

        // Utility functions
        function refreshData() {
            showNotification('Refreshing data...', 'success');
            loadSummaryStats();
            loadCurrentTabData();
        }

        function showSettings() {
            showNotification('Settings panel coming soon', 'success');
        }

        // Event listeners and initialization
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Graduate Analytics Dashboard initialized');
            
            loadSummaryStats();
            loadTabData('overview');
            updateActiveFiltersDisplay();
            
            document.getElementById('modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeModal();
                }
            });
            
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closeModal();
                }
                if (e.altKey && e.key >= '1' && e.key <= '5') {
                    e.preventDefault();
                    const tabs = ['overview', 'employment', 'salary', 'outfield', 'challenges'];
                    const tabIndex = parseInt(e.key) - 1;
                    if (tabs[tabIndex]) {
                        switchTab(tabs[tabIndex]);
                    }
                }
            });
            
            window.addEventListener('resize', function() {
                Object.values(charts).forEach(chart => {
                    if (chart && chart.resize) {
                        try {
                            chart.resize();
                        } catch (error) {
                            console.warn('Chart resize failed:', error);
                        }
                    }
                });
            });
            
            showNotification('Dashboard loaded successfully', 'success');
        });
    </script>
</body>
</html>