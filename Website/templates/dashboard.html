{% extends "base.html" %}

{% block title %}Papan Pemuka Eksekutif - Analitik Kecerdasan Graduan{% endblock %}



{% block content %}
<div x-data="dashboardKorporat()" x-init="initialize()" class="min-h-screen bg-corporate-light font-inter">
    
    <!-- Professional Loading Overlay -->
    <div x-show="isLoading" 
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="transition ease-in duration-200"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         class="fixed inset-0 bg-white bg-opacity-95 flex items-center justify-center z-50">
        <div class="text-center">
            <div class="loading-ring mx-auto mb-6"></div>
            <h3 class="text-2xl font-bold text-gray-800 mb-3">Memuatkan Papan Pemuka Eksekutif</h3>
            <p class="text-lg text-gray-600 mb-4">Menyediakan analitik kecerdasan graduan...</p>
            <div class="flex justify-center space-x-2">
                <div class="w-3 h-3 bg-corporate-blue rounded-full animate-bounce"></div>
                <div class="w-3 h-3 bg-emerald-500 rounded-full animate-bounce" style="animation-delay: 0.15s;"></div>
                <div class="w-3 h-3 bg-corporate-red rounded-full animate-bounce" style="animation-delay: 0.3s;"></div>
            </div>
        </div>
    </div>

    <!-- Corporate Navigation Header -->
    <nav class="bg-white shadow-lg border-b border-gray-200 sticky top-0 z-40">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-20">
                <!-- Brand Section -->
                <div class="flex items-center space-x-8">
                    <div class="flex items-center space-x-4 bg-gray-50 px-6 py-3 rounded-xl">
                        <img src="{{ url_for('static', filename='img/1. UPTM.png') }}" alt="Logo UPTM"
                            style="width: auto; height: 30px;">
                        <img src="{{ url_for('static', filename='img/2.MARA 2.png') }}" alt="Logo MARA"
                            style="width: auto; height: 30px;">
                        <img src="{{ url_for('static', filename='img/3.KKWK.png') }}" alt="Logo KKWK"
                            style="width: auto; height: 30px;">
                        <img src="{{ url_for('static', filename='img/4.KPTM.png') }}" alt="Logo KPTM"
                            style="width: auto; height: 30px;">
                        <img src="{{ url_for('static', filename='img/5.IKEB.jpg') }}" alt="Logo IKEB"
                            style="width: auto; height: 27px;">
                    </div>
                </div>

                <!-- Controls Section -->
                <div class="flex items-center space-x-4">
                    <div class="hidden md:flex items-center space-x-4">
                        <div class="flex items-center space-x-2 bg-green-50 px-4 py-2 rounded-lg">
                            <div class="status-dot bg-green-500"></div>
                            <span class="text-sm font-semibold text-green-700">Data Langsung</span>
                        </div>
                        <span x-text="lastUpdated" class="text-sm font-mono text-gray-500 bg-gray-100 px-3 py-2 rounded-lg"></span>
                    </div>
                    
                    <button @click="refreshAllData()" 
                            :disabled="isRefreshing"
                            class="btn-corporate-secondary px-4 py-2 text-sm">
                        <i class="fas fa-sync-alt" :class="{'animate-spin': isRefreshing}"></i>
                        <span class="hidden md:inline ml-2">Kemaskini</span>
                    </button>
                    
                </div>
            </div>
        </div>
    </nav>

    <!-- Welcome Hero Section -->
        <section class="bg-primary-500 to-indigo-800 text-white py-20">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-16">
                
                <h1 class="text-5xl md:text-7xl font-black mb-8">
                    <span class="block">Grad360- IPMA </span>
                    <span class="block bg-gradient-to-r from-yellow-300 to-orange-300 bg-clip-text text-transparent">
                       Graduate System
                    </span>
                </h1>
                
                <div class="max-w-4xl mx-auto mb-12">
                    <p class="text-lg text-blue-200 leading-relaxed">
                        Sistem ini menyediakan wawasan mendalam mengenai demografi, sosioekonomi, status pekerjaan, serta faktor kejayaan graduan bagi menyokong pengambilan keputusan strategik yang berasaskan data dan bukti empirikal.
                    </p>
                </div>
                
                <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6 mb-12">
                    <div class="bg-white bg-opacity-10 backdrop-blur-sm rounded-2xl p-6 border border-white border-opacity-20">
                        <div class="w-16 h-16 bg-gradient-to-br from-emerald-400 to-emerald-600 rounded-2xl flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-users text-white text-2xl"></i>
                        </div>
                        <h3 class="text-xl font-bold mb-3">39 Responden</h3>
                        <p class="text-blue-100 text-sm leading-relaxed">Graduan yang mengambil bahagian dalam kajian komprehensif</p>
                    </div>
                    
                    <div class="bg-white bg-opacity-10 backdrop-blur-sm rounded-2xl p-6 border border-white border-opacity-20">
                        <div class="w-16 h-16 bg-gradient-to-br from-purple-400 to-purple-600 rounded-2xl flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-chart-pie text-white text-2xl"></i>
                        </div>
                        <h3 class="text-xl font-bold mb-3">9 Modul Analitik</h3>
                        <p class="text-blue-100 text-sm leading-relaxed">Kajian menyeluruh merangkumi semua aspek prestasi graduan</p>
                    </div>
                    
                    <div class="bg-white bg-opacity-10 backdrop-blur-sm rounded-2xl p-6 border border-white border-opacity-20">
                        <div class="w-16 h-16 bg-gradient-to-br from-orange-400 to-orange-600 rounded-2xl flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-briefcase text-white text-2xl"></i>
                        </div>
                        <h3 class="text-xl font-bold mb-3">84.2% Bekerja</h3>
                        <p class="text-blue-100 text-sm leading-relaxed">Kadar penggajian yang menggalakkan di kalangan graduan</p>
                    </div>
                    
                    <div class="bg-white bg-opacity-10 backdrop-blur-sm rounded-2xl p-6 border border-white border-opacity-20">
                        <div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-2xl flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-lightbulb text-white text-2xl"></i>
                        </div>
                        <h3 class="text-xl font-bold mb-3">Wawasan Strategik</h3>
                        <p class="text-blue-100 text-sm leading-relaxed">Cadangan berasaskan data untuk penambahbaikan</p>
                    </div>
                </div>
                
                <div class="flex flex-col sm:flex-row items-center justify-center gap-6">
                    <button @click="scrollToKPI()" 
                            class="bg-gradient-to-r from-emerald-500 to-emerald-600 hover:from-emerald-600 hover:to-emerald-700 text-white font-bold py-4 px-8 rounded-xl text-lg transition-all duration-300 transform hover:scale-105 shadow-2xl">
                        <i class="fas fa-chart-bar mr-3"></i>
                        Lihat Statistik Utama
                    </button>
                    <button @click="scrollToAnalytics()" 
                            class="bg-white bg-opacity-10 hover:bg-opacity-20 backdrop-blur-sm text-white font-bold py-4 px-8 rounded-xl text-lg transition-all duration-300 border-2 border-white border-opacity-30">
                        <i class="fas fa-rocket mr-3"></i>
                        Eksplorasi Data Analitik
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- KPI Statistics Section -->
    <section id="kpi-section" class="py-20 bg-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <!-- Section Header -->
            <div class="text-center mb-16">
                <div class="inline-flex items-center bg-corporate-blue bg-opacity-10 px-6 py-3 rounded-full mb-6">
                    <i class="fas fa-trophy text-corporate-blue mr-3"></i>
                    <span class="text-sm font-semibold text-corporate-blue uppercase tracking-wide">Prestasi Utama</span>
                </div>
                <h2 class="text-4xl md:text-5xl font-black text-gray-900 mb-6">Statistik Prestasi Graduan</h2>
                <p class="text-xl text-gray-600 max-w-4xl mx-auto leading-relaxed">
                    Ringkasan komprehensif prestasi graduan berdasarkan analisis data terkini yang menunjukkan 
                    kejayaan program pendidikan dan kebolehpasaran graduan dalam pasaran kerja semasa
                </p>
            </div>
            
            <!-- KPI Cards Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
                <template x-for="(kpi, index) in kpiData" :key="index">
                    <div class="corporate-card p-8 text-center group transition-all duration-300"
                         :class="index === 2 ? 'cursor-pointer hover:scale-105 hover:shadow-2xl' : ''"
                         @click="index === 2 ? navigateToFieldAlignment() : null">
                        <div class="relative mb-6">
                            <div class="w-20 h-20 rounded-2xl flex items-center justify-center mx-auto shadow-lg group-hover:shadow-xl transition-shadow"
                                 :class="kpi.iconBg">
                                <i :class="kpi.icon + ' text-white text-2xl'"></i>
                            </div>
                            <div class="absolute -top-2 -right-2">
                                <div class="text-xs font-bold px-2 py-1 rounded-full"
                                     :class="kpi.trendClass"
                                     x-text="kpi.trend"></div>
                            </div>

                            <!-- Clickable indicator for field alignment KPI -->
                            <div x-show="index === 2" class="absolute -bottom-2 -right-2">
                                <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center shadow-lg animate-pulse">
                                    <i class="fas fa-arrow-right text-white text-sm"></i>
                                </div>
                            </div>
                        </div>

                        <div class="text-4xl font-black mb-3"
                             :class="kpi.valueColor"
                             x-text="kpi.value"></div>
                        <div class="text-lg font-bold text-gray-800 mb-3" x-text="kpi.title"></div>
                        <p class="text-sm text-gray-600 leading-relaxed" x-text="kpi.description"></p>

                        <!-- Click hint for field alignment KPI -->
                        <div x-show="index === 2" class="mt-4 text-xs text-blue-600 font-semibold">
                            <i class="fas fa-mouse-pointer mr-1"></i>
                            Klik untuk analisis terperinci
                        </div>
                    </div>
                </template>
            </div>
        </div>
    </section>

    <!-- Section Divider -->
    <div class="section-divider"></div>

    <!-- Analytics Carousel Section -->
    <section id="analytics-section" class="py-20 bg-gradient-to-br from-gray-50 to-blue-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <!-- Section Header -->
            <div class="text-center mb-16">
                <div class="inline-flex items-center bg-indigo-100 px-6 py-3 rounded-full mb-6">
                    <i class="fas fa-microscope text-indigo-600 mr-3"></i>
                    <span class="text-sm font-semibold text-indigo-600 uppercase tracking-wide">Sistem Analitik</span>
                </div>
                <h2 class="text-4xl md:text-5xl font-black text-gray-900 mb-6">Platform Kecerdasan Strategik</h2>
                <p class="text-xl text-gray-600 max-w-5xl mx-auto leading-relaxed mb-8">
                    Sistem analitik komprehensif yang mengintegrasikan 10 modul utama untuk memberikan wawasan 
                    mendalam tentang prestasi graduan, trend industri, dan faktor-faktor yang mempengaruhi kebolehpasaran. 
                    Setiap modul direka khusus untuk membantu pembuat dasar membuat keputusan strategik berdasarkan bukti empirik.
                </p>
                
                <!-- Carousel Progress -->
                <div class="flex justify-center items-center space-x-6 mb-8">
                    <span class="text-lg font-bold text-gray-700">Modul</span>
                    <div class="flex space-x-2">
                        <template x-for="(slide, index) in slideData" :key="index">
                            <button
                                @click="goToSlide(index)"
                                :class="currentSlide === index ?
                                    'w-16 h-4 bg-gradient-to-r from-corporate-blue to-indigo-600' :
                                    'w-4 h-4 bg-gray-300 hover:bg-gray-400'"
                                class="rounded-full transition-all duration-300 transform hover:scale-110">
                            </button>
                        </template>
                    </div>
                    <span class="text-lg font-bold text-corporate-blue"
                          x-text="`${currentSlide + 1} daripada ${slideData.length}`"></span>
                </div>
            </div>

            <!-- Enhanced Carousel Container -->
            <div class="corporate-card overflow-hidden">
                <div class="relative">
                    <!-- Slides Container -->
                    <div class="carousel-slides flex"
                         :style="`transform: translateX(-${currentSlide * 100}%)`">

                        <template x-for="(slide, index) in slideData" :key="index">
                            <div class="w-full flex-shrink-0 p-8 lg:p-12"
                                 :class="`gradient-overlay-${slide.colorTheme}`">
                                <div class="grid lg:grid-cols-2 gap-12 items-center">

                                    <!-- Left Column - Information -->
                                    <div class="space-y-8">
                                        <!-- Module Header -->
                                        <div class="flex items-start space-x-6">
                                        <div class="w-20 h-20 rounded-2xl flex items-center justify-center shadow-2xl flex-shrink-0"
                                            :class="slide.iconBg">
                                            <i :class="slide.icon + ' text-white text-3xl'"></i>
                                        </div>
                                        <div class="flex-1 min-w-0">
                                            <div class="flex items-start space-x-3 mb-3">
                                            <h3 class="text-2xl lg:text-3xl font-black text-gray-900 flex-1 min-w-0" x-text="slide.title"></h3>
                                            <span class="text-xs bg-gray-200 text-gray-700 px-2 py-1 rounded-full font-semibold whitespace-nowrap flex-shrink-0"
                                                    x-text="`Modul ${index + 1}`"></span>
                                            </div>
                                            <!-- ✅ use x-html instead of x-text -->
                                            <p class="text-base lg:text-lg text-gray-600 leading-relaxed" x-html="slide.subtitle"></p>
                                        </div>
                                        </div>


                                        <!-- Detailed Description -->
                                        <div class="bg-white bg-opacity-80 backdrop-blur-sm rounded-xl p-6 border border-gray-200">
                                            <p class="text-gray-800 leading-relaxed" x-text="slide.description"></p>
                                        </div>

                                        <!-- Key Metrics -->
                                        <div class="grid grid-cols-2 gap-6">
                                            <div class="bg-white rounded-xl p-6 text-center shadow-lg border border-gray-100">
                                                <div class="text-3xl font-black mb-2"
                                                     :class="slide.primaryColor"
                                                     x-text="getMetric(index, 'primary')"></div>
                                                <div class="text-sm font-semibold text-gray-600 uppercase tracking-wide"
                                                     x-text="getMetric(index, 'primaryLabel')"></div>
                                            </div>

                                            <div class="bg-white rounded-xl p-6 text-center shadow-lg border border-gray-100">
                                                <div class="text-2xl font-bold mb-2"
                                                     :class="slide.secondaryColor"
                                                     x-text="getMetric(index, 'secondary')"></div>
                                                <div class="text-sm font-semibold text-gray-600 uppercase tracking-wide"
                                                     x-text="getMetric(index, 'secondaryLabel')"></div>
                                            </div>
                                        </div>

                                        <!-- Action Button -->
                                        <button @click="viewDetailedAnalysis(index)"
                                                :class="slide.buttonClass"
                                                class="w-full py-4 px-6 rounded-xl font-bold text-lg transition-all duration-300 transform hover:scale-105 shadow-lg">
                                            <i class="fas fa-microscope mr-3"></i>
                                            Lihat Analisis Terperinci
                                        </button>
                                    </div>

                                    <!-- Right Column - Chart -->
                                    <div class="bg-white rounded-2xl p-8 shadow-xl border border-gray-200">
                                        <div class="mb-6">
                                            <h4 class="text-xl font-bold text-gray-800 mb-2" x-text="slide.chartTitle"></h4>
                                            <p class="text-gray-600 text-sm leading-relaxed" x-text="slide.chartDescription"></p>
                                        </div>

                                        <div class="chart-container">
                                            <canvas :id="`chart-${index}`" class="w-full h-full"></canvas>

                                            <!-- Loading State -->
                                            <div x-show="!chartLoaded(index) && !chartError(index)"
                                                 class="absolute inset-0 flex items-center justify-center bg-gray-50 rounded-lg">
                                                <div class="text-center">
                                                    <div class="loading-ring mx-auto mb-4"></div>
                                                    <p class="text-gray-600 font-medium">Memuatkan visualisasi data...</p>
                                                </div>
                                            </div>

                                            <!-- Error State -->
                                            <div x-show="chartError(index)"
                                                 class="absolute inset-0 flex items-center justify-center bg-red-50 rounded-lg border-2 border-red-200 border-dashed">
                                                <div class="text-center p-6">
                                                    <i class="fas fa-exclamation-triangle text-red-500 text-4xl mb-4"></i>
                                                    <h5 class="text-lg font-bold text-red-800 mb-2">Tidak Dapat Memuatkan Carta</h5>
                                                    <p class="text-red-600 mb-4 text-sm">Data visualisasi tidak tersedia</p>
                                                    <button @click="retryChart(index)"
                                                            class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg transition-colors">
                                                        <i class="fas fa-redo mr-2"></i>
                                                        Cuba Semula
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </template>
                    </div>

                    <!-- Navigation Controls -->
                    <button @click="previousSlide()"
                            class="absolute left-6 top-1/2 transform -translate-y-1/2 bg-white bg-opacity-90 hover:bg-opacity-100 p-4 rounded-full shadow-xl transition-all duration-200 group">
                        <i class="fas fa-chevron-left text-gray-700 text-xl group-hover:text-corporate-blue transition-colors"></i>
                    </button>

                    <button @click="nextSlide()"
                            class="absolute right-6 top-1/2 transform -translate-y-1/2 bg-white bg-opacity-90 hover:bg-opacity-100 p-4 rounded-full shadow-xl transition-all duration-200 group">
                        <i class="fas fa-chevron-right text-gray-700 text-xl group-hover:text-corporate-blue transition-colors"></i>
                    </button>
                </div>

                <!-- Carousel Status -->
                <div class="bg-gradient-to-r from-gray-100 to-blue-100 px-8 py-6 border-t border-gray-200">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-4">
                            <div class="status-dot"
                                 :class="slideData[currentSlide]?.statusColor || 'bg-corporate-blue'"></div>
                            <h4 class="text-lg font-bold text-gray-800"
                                x-text="slideData[currentSlide]?.title || 'Memuatkan...'"></h4>
                            <span class="text-sm text-gray-500 bg-white px-3 py-1 rounded-full font-semibold"
                                  x-text="`Modul ${currentSlide + 1} daripada ${slideData.length}`"></span>
                            <div class="flex items-center space-x-2 text-sm"
                                 :class="carouselPaused ? 'text-red-600' : 'text-green-600'">
                                <i :class="carouselPaused ? 'fas fa-pause' : 'fas fa-play'" class="text-xs"></i>
                                <span x-text="carouselPaused ? 'Dijeda' : 'Auto-scroll Aktif'"></span>
                            </div>
                        </div>

                        <div class="hidden lg:flex items-center space-x-4 text-sm text-gray-500">
                            <span class="font-medium">Kawalan Navigasi:</span>
                            <kbd class="px-2 py-1 bg-gray-200 rounded font-mono text-xs">←→</kbd>
                            <kbd class="px-2 py-1 bg-gray-200 rounded font-mono text-xs">Ruang</kbd>
                            <kbd class="px-2 py-1 bg-gray-200 rounded font-mono text-xs">1-0</kbd>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Section Divider -->
    <div class="section-divider"></div>

    <!-- Quick Access Modules -->
    <section class="py-20 bg-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <!-- Section Header -->
            <div class="text-center mb-16">
                <div class="inline-flex items-center bg-emerald-100 px-6 py-3 rounded-full mb-6">
                    <i class="fas fa-rocket text-emerald-600 mr-3"></i>
                    <span class="text-sm font-semibold text-emerald-600 uppercase tracking-wide">Akses Pantas</span>
                </div>
                <h2 class="text-4xl md:text-5xl font-black text-gray-900 mb-6">Modul Analitik Khusus</h2>
                <p class="text-xl text-gray-600 max-w-4xl mx-auto leading-relaxed">
                    Akses terus kepada modul-modul analitik spesifik untuk mendapatkan maklumat terperinci tentang 
                    aspek-aspek khusus dalam kajian prestasi graduan. Setiap modul menyediakan analisis mendalam 
                    dengan visualisasi data interaktif dan laporan komprehensif
                </p>
            </div>

            <!-- Quick Access Grid -->
            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-8">
                <template x-for="(module, index) in quickAccessModules" :key="index">
                    <a :href="module.url" 
                       class="corporate-card p-6 text-center transition-all duration-300 transform hover:scale-105 group">
                        <div class="w-16 h-16 mx-auto mb-4 rounded-2xl flex items-center justify-center shadow-lg group-hover:shadow-xl transition-shadow" 
                             :class="module.iconBg">
                            <i :class="module.icon + ' text-white text-2xl'"></i>
                        </div>
                        <h3 class="text-lg font-bold text-gray-800 mb-2" x-text="module.title"></h3>
                        <p class="text-sm text-gray-600 mb-4 leading-relaxed" x-text="module.description"></p>
                        <div class="flex items-center justify-center font-medium text-sm group-hover:translate-x-1 transition-transform"
                             :class="module.linkColor">
                            Terokai <i class="fas fa-arrow-right ml-2 text-xs"></i>
                        </div>
                    </a>
                </template>
            </div>
        </div>
    </section>

</div>

<!-- Fixed JavaScript Implementation -->
<script>
// Avoid conflicts by using a unique namespace
window.DashboardCharts = window.DashboardCharts || new Map();

document.addEventListener('alpine:init', () => {
    Alpine.data('dashboardKorporat', () => ({
        // Core State
        isLoading: true,
        isRefreshing: false,
        carouselPaused: false,
        currentSlide: 0,
        carouselTimer: null,
        lastUpdated: '',
        loadedCharts: new Set(),
        chartErrors: new Set(),
        
        // Auto-scroll settings
        autoScrollInterval: 8000, // 8 seconds
        randomIntervals: [6000, 8000, 10000, 12000], // Random intervals
        
        // KPI Data
        kpiData: [
            {
                title: 'Jumlah Responden Kajian',
                value: '39',
                description: 'Peratus graduan yang berjaya mendapat pekerjaan dalam tempoh 6 bulan selepas tamat pengajian',
                icon: 'fas fa-users',
                iconBg: 'bg-gradient-to-br from-blue-500 to-green-600',
                valueColor: 'text-corporate-blue',
                trend: '+15%',
                trendClass: 'text-green-600 bg-green-100'
            },
            {
                title: 'Kadar Penggajian Keseluruhan',
                value: '84.2%',
                description: 'Peratus graduan yang berjaya mendapat pekerjaan dalam tempoh 6 bulan selepas tamat pengajian',
                icon: 'fas fa-briefcase',
                iconBg: 'bg-gradient-to-br from-emerald-500 to-green-600',
                valueColor: 'text-emerald-600',
                trend: 'Cemerlang',
                trendClass: 'text-emerald-600 bg-emerald-100'
            },
            {
                title: 'Padanan Bidang Pengajian',
                value: '71.3%',
                description: 'Peratus graduan yang bekerja dalam bidang yang berkaitan dengan pengajian mereka',
                icon: 'fas fa-crosshairs',
                iconBg: 'bg-gradient-to-br from-yellow-500 to-orange-500',
                valueColor: 'text-orange-600',
                trend: 'Sederhana',
                trendClass: 'text-yellow-600 bg-yellow-100'
            },
            {
                title: 'Purata Masa ke Pekerjaan',
                value: '3.2 bulan',
                description: 'Tempoh purata yang diperlukan graduan untuk mendapat pekerjaan pertama selepas graduasi',
                icon: 'fas fa-stopwatch',
                iconBg: 'bg-gradient-to-br from-purple-500 to-indigo-600',
                valueColor: 'text-purple-600',
                trend: 'Baik',
                trendClass: 'text-green-600 bg-green-100'
            }
        ],
        
        // Slide Data
        slideData: [
            {
                title: 'Demografi & Latar Belakang Akademik',
                subtitle: 'Kajian mendalam ciri-ciri populasi dan trend demografi',
                description: 'Modul ini menganalisis profil demografi graduan termasuk taburan umur mengikut tahun graduasi, komposisi jantina, dan trend populasi. Data ini penting untuk memahami profil graduan dan merancang program yang sesuai dengan keperluan demografik semasa.',
                icon: 'fas fa-users',
                iconBg: 'bg-gradient-to-br from-blue-500 to-blue-700',
                colorTheme: 'blue',
                primaryColor: 'text-blue-600',
                secondaryColor: 'text-blue-500',
                buttonClass: 'bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white',
                statusColor: 'bg-blue-500',
                chartTitle: 'Taburan Umur Mengikut Tahun Graduasi',
                chartDescription: 'Visualisasi yang menunjukkan sebaran kumpulan umur graduan berdasarkan tahun mereka menamatkan pengajian'
            },
            {
                title: 'Sosioekonomi Graduan',
                subtitle: 'Latar belakang ekonomi dan sumber pembiayaan pendidikan',
                description: 'Kajian komprehensif tentang latar belakang sosioekonomi graduan meliputi sumber pembiayaan pendidikan, status ekonomi keluarga, dan kesan faktor sosial terhadap prestasi akademik serta pencapaian kerjaya.',
                icon: 'fas fa-coins',
                iconBg: 'bg-gradient-to-br from-emerald-500 to-green-600',
                colorTheme: 'green',
                primaryColor: 'text-emerald-600',
                secondaryColor: 'text-emerald-500',
                buttonClass: 'bg-gradient-to-r from-emerald-500 to-emerald-600 hover:from-emerald-600 hover:to-emerald-700 text-white',
                statusColor: 'bg-emerald-500',
                chartTitle: 'Kaedah Pembiayaan Pendidikan',
                chartDescription: 'Analisis terperinci sumber-sumber kewangan yang digunakan graduan untuk membiayai pengajian mereka'
            },
            {
                title: 'Graduan Bekerja di Luar Bidang',
                subtitle: 'Fenomena ketidakpadanan bidang pengajian dengan pekerjaan',
                description: 'Modul khusus yang mengkaji fenomena graduan bekerja di luar bidang pengajian mereka. Menganalisis sebab-sebab, implikasi ekonomi, dan trend ketidakpadanan untuk membantu institusi pendidikan membuat penambahbaikan strategik.',
                icon: 'fas fa-exchange-alt',
                iconBg: 'bg-gradient-to-br from-red-500 to-red-700',
                colorTheme: 'red',
                primaryColor: 'text-red-600',
                secondaryColor: 'text-red-500',
                buttonClass: 'bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white',
                statusColor: 'bg-red-500',
                chartTitle: 'Faktor-faktor Bekerja Luar Bidang',
                chartDescription: 'Sebab-sebab utama yang mendorong graduan memilih kerjaya di luar bidang pengajian mereka'
            },
            {
                title: 'Sektor, Industri & Pendapatan Graduan',
                subtitle: 'Kesesuaian kompensasi dengan tahap pendidikan dan bidang',
                description: 'Kajian menyeluruh tentang sektor pekerjaan graduan, analisis struktur gaji yang diterima, dan penilaian kesesuaian kompensasi dengan tahap pendidikan. Termasuk analisis ROI pendidikan dan daya saing di pasaran kerja.',
                icon: 'fas fa-chart-line',
                iconBg: 'bg-gradient-to-br from-purple-500 to-indigo-600',
                colorTheme: 'purple',
                primaryColor: 'text-purple-600',
                secondaryColor: 'text-purple-500',
                buttonClass: 'bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white',
                statusColor: 'bg-purple-500',
                chartTitle: 'Persepsi Kesesuaian Gaji dengan Kelulusan',
                chartDescription: 'Pandangan graduan terhadap kesesuaian gaji yang diterima dengan tahap pendidikan dan kemahiran mereka'
            },
            {
                title: 'Latihan Industri & Cabaran Mendapat Kerja ',
                subtitle: "Keberkesanan latihan industri dan program <i>Capacity Building</i>",
                description: 'Penilaian holistik terhadap program latihan industri, magang, dan cabaran yang dihadapi graduan dalam transisi dari institusi pendidikan ke alam pekerjaan. Termasuk analisis impak dan cadangan penambahbaikan program.',
                icon: 'fas fa-user-tie',
                iconBg: 'bg-gradient-to-br from-amber-500 to-yellow-600',
                colorTheme: 'orange',
                primaryColor: 'text-amber-600',
                secondaryColor: 'text-amber-500',
                buttonClass: 'bg-gradient-to-r from-amber-500 to-amber-600 hover:from-amber-600 hover:to-amber-700 text-white',
                statusColor: 'bg-amber-500',
                chartTitle: 'Impak Program Latihan Industri',
                chartDescription: 'Perbandingan keberkesanan dan manfaat antara graduan yang mengikuti program latihan dengan yang tidak'
            },
            {
                title: 'Status Pekerjaan & Kesesuaian dengan Bidang Pengajian',
                subtitle: 'Analisis jenis pekerjaan dan trend sektor penggajian',
                description: 'Kajian terperinci tentang status pekerjaan semasa graduan, jenis sektor yang diminati, corak penggajian, dan trend dalam pemilihan kerjaya. Data ini membantu memahami dinamik pasaran kerja dan keperluan industri terkini.',
                icon: 'fas fa-briefcase',
                iconBg: 'bg-gradient-to-br from-pink-500 to-rose-600',
                colorTheme: 'pink',
                primaryColor: 'text-pink-600',
                secondaryColor: 'text-pink-500',
                buttonClass: 'bg-gradient-to-r from-pink-500 to-pink-600 hover:from-pink-600 hover:to-pink-700 text-white',
                statusColor: 'bg-pink-500',
                chartTitle: 'Sebaran Sektor Pekerjaan Semasa',
                chartDescription: 'Distribusi graduan mengikut jenis sektor dan industri yang mereka ceburi dalam pasaran kerja'
            },
            {
                title: 'Graduan Mengikut bidang & Tahun Graduasi',
                subtitle: 'Evolusi minat akademik dan proyeksi masa hadapan',
                description: 'Analisis komprehensif trend bidang pengajian yang diminati, perubahan corak pilihan kursus mengikut tahun, dan ramalan keperluan masa hadapan berdasarkan data historik dan trend industri semasa.',
                icon: 'fas fa-graduation-cap',
                iconBg: 'bg-gradient-to-br from-indigo-500 to-blue-600',
                colorTheme: 'indigo',
                primaryColor: 'text-indigo-600',
                secondaryColor: 'text-indigo-500',
                buttonClass: 'bg-gradient-to-r from-indigo-500 to-indigo-600 hover:from-indigo-600 hover:to-indigo-700 text-white',
                statusColor: 'bg-indigo-500',
                chartTitle: 'Evolusi Minat Bidang Pengajian',
                chartDescription: 'Perubahan trend dan minat graduan terhadap bidang pengajian tertentu sepanjang masa'
            },
            {
                title: 'Trend Ekonomi Gig & Usahawanan',
                subtitle: 'Adaptasi kepada ekonomi gig dan pekerjaan masa hadapan',
                description: 'Kajian mendalam tentang trend ekonomi digital, pekerjaan freelance, dan kemahiran yang diperlukan untuk masa depan. Menganalisis kesiapan graduan menghadapi revolusi industri 4.0 dan perubahan paradigma kerja.',
                icon: 'fas fa-laptop',
                iconBg: 'bg-gradient-to-br from-teal-500 to-cyan-600',
                colorTheme: 'teal',
                primaryColor: 'text-teal-600',
                secondaryColor: 'text-teal-500',
                buttonClass: 'bg-gradient-to-r from-teal-500 to-teal-600 hover:from-teal-600 hover:to-teal-700 text-white',
                statusColor: 'bg-teal-500',
                chartTitle: 'Strategi Pemerolehan Kemahiran Digital',
                chartDescription: 'Kaedah dan pendekatan graduan dalam memperoleh kemahiran tambahan untuk ekonomi digital'
            },
            {
                title: 'Faktor Menpengaruhi Kebolehpasaran Graduan',
                subtitle: 'Determinan kejayaan dan prestasi kerjaya graduan',
                description: 'Analisis komprehensif faktor-faktor yang menentukan kejayaan graduan dalam kerjaya, kemahiran yang paling dihargai majikan, dan strategi optimum untuk meningkatkan kebolehpasaran graduan masa hadapan.',
                icon: 'fas fa-star',
                iconBg: 'bg-gradient-to-br from-orange-500 to-red-600',
                colorTheme: 'yellow',
                primaryColor: 'text-orange-600',
                secondaryColor: 'text-orange-500',
                buttonClass: 'bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 text-white',
                statusColor: 'bg-orange-500',
                chartTitle: 'Kemahiran Kritikal untuk Kebolehpasaran',
                chartDescription: 'Kemahiran-kemahiran utama yang paling mempengaruhi kejayaan dan kebolehpasaran graduan'
            }
        ],
        
        // Metrics data
        metricsData: {
            0: { primary: '23-25 Tahun', primaryLabel: 'Kumpulan Umur Dominan', secondary: '52% P / 48% L', secondaryLabel: 'Keseimbangan Jantina' },
            1: { primary: 'Pinjaman MARA', primaryLabel: 'Sumber Pembiayaan Utama', secondary: '68%', secondaryLabel: 'Bergantung Pembiayaan' },
            2: { primary: '28.7%', primaryLabel: 'Graduan Luar Bidang', secondary: 'Prospek Lebih Baik', secondaryLabel: 'Sebab Utama' },
            3: { primary: '73%', primaryLabel: 'Gaji Bersesuaian', secondary: 'Sektor Swasta', secondaryLabel: 'Sektor Dominan' },
            4: { primary: '76%', primaryLabel: 'Mengikuti Latihan', secondary: 'Pengalaman Kerja', secondaryLabel: 'Manfaat Utama' },
            5: { primary: '84%', primaryLabel: 'Kadar Bekerja', secondary: 'Sektor Swasta', secondaryLabel: 'Pilihan Utama' },
            6: { primary: '8', primaryLabel: 'Bidang Pengajian', secondary: 'Kejuruteraan', secondaryLabel: 'Bidang Popular' },
            7: { primary: '23%', primaryLabel: 'Ekonomi Digital', secondary: 'Pembelajaran Kendiri', secondaryLabel: 'Kaedah Utama' },
            8: { primary: '89%', primaryLabel: 'Kadar Kejayaan', secondary: 'Komunikasi', secondaryLabel: 'Kemahiran Utama' },
            9: { primary: '3.2 bulan', primaryLabel: 'Masa Purata', secondary: '1-3 bulan', secondaryLabel: 'Majoriti' }
        },
        
        // Quick Access Modules
        quickAccessModules: [
            { title: 'Analisis Demografi', description: 'Profil dan ciri-ciri populasi graduan', url: '/demografi', icon: 'fas fa-users', iconBg: 'bg-gradient-to-br from-blue-500 to-blue-600', linkColor: 'text-blue-600' },
            { title: 'Status Sosioekonomi', description: 'Latar belakang ekonomi dan pembiayaan', url: '/sosioekonomi', icon: 'fas fa-coins', iconBg: 'bg-gradient-to-br from-emerald-500 to-emerald-600', linkColor: 'text-emerald-600' },
            { title: 'Graduan Luar Bidang', description: 'Ketidakpadanan bidang dengan pekerjaan', url: '/graduan-luar', icon: 'fas fa-exchange-alt', iconBg: 'bg-gradient-to-br from-red-500 to-red-600', linkColor: 'text-red-600' },
            { title: 'Sektor & Gaji', description: 'Analisis struktur gaji dan sektor', url: '/sektor-gaji', icon: 'fas fa-chart-line', iconBg: 'bg-gradient-to-br from-purple-500 to-purple-600', linkColor: 'text-purple-600' },
            { title: 'Latihan Industri', description: 'Keberkesanan latihan dan magang', url: '/intern', icon: 'fas fa-user-tie', iconBg: 'bg-gradient-to-br from-amber-500 to-amber-600', linkColor: 'text-amber-600' },
            { title: 'Status Pekerjaan', description: 'Jenis dan corak pekerjaan semasa', url: '/status-pekerjaan', icon: 'fas fa-briefcase', iconBg: 'bg-gradient-to-br from-pink-500 to-pink-600', linkColor: 'text-pink-600' },
            { title: 'Ekonomi Gig & Usahawanan', description: 'Trend ekonomi gig dan digital', url: '/gig-economy', icon: 'fas fa-laptop', iconBg: 'bg-gradient-to-br from-teal-500 to-teal-600', linkColor: 'text-teal-600' },
            { title: 'Faktor Kebolehpasaran', description: 'Penentu kebolehpasaran graduan', url: '/faktor-graduan', icon: 'fas fa-star', iconBg: 'bg-gradient-to-br from-orange-500 to-orange-600', linkColor: 'text-orange-600' }
        ],
        
        // Initialization
        async initialize() {
            console.log('Memulakan Dashboard Korporat...');
            
            try {
                this.updateTime();
                await this.loadChartLibrary();
                await this.loadData();
                this.startCarousel();
                this.setupEventListeners();
                this.startTimeUpdates();
                
                // Create first chart
                setTimeout(() => {
                    this.createChart(0);
                }, 1000);
                
            } catch (error) {
                console.error('Ralat memulakan dashboard:', error);
            } finally {
                setTimeout(() => {
                    this.isLoading = false;
                }, 2000);
            }
        },
        
        async loadChartLibrary() {
            return new Promise((resolve, reject) => {
                let attempts = 0;
                const checkChart = () => {
                    attempts++;
                    if (typeof Chart !== 'undefined') {
                        console.log('Chart.js library loaded successfully');
                        resolve();
                    } else if (attempts >= 50) {
                        reject(new Error('Chart.js library failed to load'));
                    } else {
                        setTimeout(checkChart, 100);
                    }
                };
                checkChart();
            });
        },
        
        async loadData() {
            // Load KPI data
            try {
                const response = await fetch('/api/summary');
                if (response.ok) {
                    const data = await response.json();
                    this.updateKPIData(data);
                }
            } catch (error) {
                console.warn('Using default KPI data:', error.message);
            }
        },
        
        updateKPIData(data) {
            if (data.total_records !== undefined) {
                this.kpiData[0].value = data.total_records.toString();
            }
            if (data.employment_rate !== undefined) {
                this.kpiData[1].value = `${data.employment_rate}%`;
            }
            if (data.field_alignment !== undefined) {
                this.kpiData[2].value = `${data.field_alignment}%`;
            }
            if (data.avg_time_to_employment !== undefined) {
                this.kpiData[3].value = `${data.avg_time_to_employment} bulan`;
            }
        },
        
        updateTime() {
            const now = new Date();
            this.lastUpdated = now.toLocaleString('ms-MY', {
                hour: '2-digit',
                minute: '2-digit',
                day: '2-digit',
                month: '2-digit',
                hour12: false
            });
        },
        
        startTimeUpdates() {
            setInterval(() => this.updateTime(), 30000);
        },
        
        getMetric(index, type) {
            return this.metricsData[index]?.[type] || 'Memuatkan...';
        },
        
        // Chart Management
        chartLoaded(index) {
            return this.loadedCharts.has(index);
        },
        
        chartError(index) {
            return this.chartErrors.has(index);
        },
        
        async createChart(slideIndex) {
            const canvasId = `chart-${slideIndex}`;
            
            try {
                await this.waitForCanvas(canvasId);
                
                const canvas = document.getElementById(canvasId);
                if (!canvas) throw new Error(`Canvas ${canvasId} not found`);
                
                this.destroyChart(canvasId);
                
                const ctx = canvas.getContext('2d');
                if (!ctx) throw new Error('Cannot get canvas context');
                
                const data = this.getChartData(slideIndex);
                const options = this.getChartOptions(slideIndex);
                const chartType = this.getChartType(slideIndex);

                const chart = new Chart(ctx, {
                    type: chartType,
                    data: data,
                    options: options
                });
                
                window.DashboardCharts.set(canvasId, chart);
                this.loadedCharts.add(slideIndex);
                this.chartErrors.delete(slideIndex);
                
                console.log(`Chart created for slide ${slideIndex}`);
                
            } catch (error) {
                console.error(`Chart error for slide ${slideIndex}:`, error);
                this.chartErrors.add(slideIndex);
                this.loadedCharts.delete(slideIndex);
            }
        },
        
        async waitForCanvas(canvasId) {
            return new Promise((resolve, reject) => {
                let attempts = 0;
                const checkCanvas = () => {
                    attempts++;
                    const canvas = document.getElementById(canvasId);
                    if (canvas && canvas.getContext) {
                        resolve(canvas);
                    } else if (attempts >= 30) {
                        reject(new Error(`Canvas ${canvasId} not found after 30 attempts`));
                    } else {
                        setTimeout(checkCanvas, 100);
                    }
                };
                checkCanvas();
            });
        },
        
        destroyChart(canvasId) {
            try {
                const chart = window.DashboardCharts.get(canvasId);
                if (chart) {
                    chart.destroy();
                    window.DashboardCharts.delete(canvasId);
                }
                
                const slideIndex = parseInt(canvasId.replace('chart-', ''));
                this.loadedCharts.delete(slideIndex);
                this.chartErrors.delete(slideIndex);
                
            } catch (error) {
                console.warn(`Error destroying chart ${canvasId}:`, error);
            }
        },
        
        getChartData(slideIndex) {
            const corporateBlue = '#296899';
            const corporateRed = '#ba454d';
            const emeraldGreen = '#10B981';
            const purpleViolet = '#8B5CF6';
            const orangeAmber = '#F97316';
            const pinkRose = '#EC4899';
            const tealCyan = '#14B8A6';
            const indigoBlue = '#6366F1';
            
            const mockDataSets = [
                // Demographics
                { 
                    labels: ['2020', '2021', '2022', '2023', '2024'], 
                    datasets: [
                        { label: '21-23 Tahun', data: [8, 12, 15, 18, 14], backgroundColor: corporateBlue, borderColor: corporateBlue, borderWidth: 2 },
                        { label: '24-26 Tahun', data: [12, 8, 10, 16, 11], backgroundColor: '#4A90B8', borderColor: '#4A90B8', borderWidth: 2 },
                        { label: '27+ Tahun', data: [4, 6, 8, 5, 7], backgroundColor: '#6BA4C7', borderColor: '#6BA4C7', borderWidth: 2 }
                    ]
                },
                // Sosioekonomi
                { 
                    labels: ['Pinjaman MARA', 'Pinjaman Kerajaan', 'Biasiswa', 'Ibu Bapa', 'Lain-lain'], 
                    datasets: [{ 
                        data: [15, 8, 6, 7, 3], 
                        backgroundColor: [corporateBlue, '#4A90B8', emeraldGreen, orangeAmber, corporateRed],
                        borderWidth: 2 
                    }]
                },
                // Graduan Luar
                { 
                    labels: ['Prospek Lebih Baik', 'Gaji Lebih Tinggi', 'Peluang Terhad', 'Minat Berubah'], 
                    datasets: [{ 
                        label: 'Sebab Luar Bidang', 
                        data: [8, 6, 5, 4], 
                        backgroundColor: corporateRed, 
                        borderColor: corporateRed, 
                        borderWidth: 2 
                    }]
                },
                // Sektor Gaji
                { 
                    labels: ['Sangat Bersesuaian', 'Bersesuaian', 'Kurang Bersesuaian', 'Tidak Bersesuaian'], 
                    datasets: [{ 
                        data: [8, 18, 6, 2], 
                        backgroundColor: [emeraldGreen, corporateBlue, orangeAmber, corporateRed],
                        borderWidth: 2 
                    }]
                },
                // Latihan
                { 
                    labels: ['Pengalaman', 'Rangkaian', 'Kemahiran', 'Keyakinan'], 
                    datasets: [
                        { label: 'Dengan Latihan', data: [92, 85, 88, 82], backgroundColor: orangeAmber, borderColor: orangeAmber, borderWidth: 2 },
                        { label: 'Tanpa Latihan', data: [65, 45, 58, 52], backgroundColor: '#9CA3AF', borderColor: '#9CA3AF', borderWidth: 2 }
                    ]
                },
                // Status Pekerjaan
                { 
                    labels: ['Sektor Swasta', 'Sektor Awam', 'Bekerja Sendiri', 'Pekerja Bebas'], 
                    datasets: [{ 
                        label: 'Jenis Pekerjaan', 
                        data: [22, 8, 4, 3], 
                        backgroundColor: [corporateBlue, emeraldGreen, orangeAmber, purpleViolet],
                        borderWidth: 2 
                    }]
                },
                // Graduan Bidang
                { 
                    labels: ['2020', '2021', '2022', '2023', '2024'], 
                    datasets: [
                        { label: 'Kejuruteraan', data: [12, 15, 18, 22, 16], backgroundColor: corporateBlue, borderColor: corporateBlue, borderWidth: 3, fill: false, tension: 0.4 },
                        { label: 'IT', data: [8, 10, 12, 14, 11], backgroundColor: emeraldGreen, borderColor: emeraldGreen, borderWidth: 3, fill: false, tension: 0.4 },
                        { label: 'Perniagaan', data: [6, 8, 7, 9, 8], backgroundColor: orangeAmber, borderColor: orangeAmber, borderWidth: 3, fill: false, tension: 0.4 }
                    ]
                },
                // Ekonomi Digital
                { 
                    labels: ['Pembelajaran Kendiri', 'Kursus Online', 'Pengalaman Kerja', 'Bimbingan'], 
                    datasets: [{ 
                        label: 'Kaedah Pembelajaran', 
                        data: [18, 12, 10, 6], 
                        backgroundColor: tealCyan, 
                        borderColor: tealCyan, 
                        borderWidth: 2 
                    }]
                },
                // Faktor Kejayaan
                { 
                    labels: ['Komunikasi', 'Pemikiran Kritis', 'Digital', 'Kepimpinan'], 
                    datasets: [{ 
                        label: 'Kemahiran Penting', 
                        data: [22, 18, 16, 14], 
                        backgroundColor: orangeAmber, 
                        borderColor: orangeAmber, 
                        borderWidth: 2 
                    }]
                },
                // Wawasan Strategik
                { 
                    labels: ['< 1 bulan', '1-3 bulan', '4-6 bulan', '7-12 bulan', '> 1 tahun'], 
                    datasets: [{ 
                        label: 'Masa ke Pekerjaan', 
                        data: [8, 15, 12, 3, 1], 
                        backgroundColor: 'rgba(41, 104, 153, 0.3)', 
                        borderColor: corporateBlue, 
                        borderWidth: 3, 
                        fill: true, 
                        tension: 0.4 
                    }]
                }
            ];
            
            return mockDataSets[slideIndex] || mockDataSets[0];
        },

        getChartType(slideIndex) {
            // Define appropriate chart types for each carousel slide
            const chartTypes = [
                'bar',        // 0: Demographics - Bar chart for age groups by year
                'doughnut',   // 1: Sosioekonomi - Pie chart for funding sources
                'bar',        // 2: Graduan Luar - Bar chart for reasons
                'doughnut',   // 3: Sektor Gaji - Pie chart for salary suitability
                'bar',        // 4: Latihan - Bar chart comparing with/without training
                'doughnut',   // 5: Status Pekerjaan - Pie chart for job sectors
                'line',       // 6: Graduan Bidang - Line chart for trends over time
                'bar',        // 7: Ekonomi Digital - Bar chart for learning methods
                'bar',        // 8: Faktor Kejayaan - Bar chart for skills importance
                'line'        // 9: Wawasan Strategik - Area chart for time to employment
            ];

            return chartTypes[slideIndex] || 'bar';
        },

        getChartOptions(slideIndex) {
            const chartType = this.getChartType(slideIndex);

            const baseOptions = {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            usePointStyle: true,
                            padding: 16,
                            font: { size: 12, weight: '600', family: 'Inter' },
                            color: '#374151'
                        }
                    },
                    tooltip: {
                        backgroundColor: 'rgba(31, 41, 55, 0.95)',
                        titleColor: '#fff',
                        bodyColor: '#fff',
                        borderColor: '#6B7280',
                        borderWidth: 1,
                        cornerRadius: 8,
                        padding: 12
                    }
                },
                animation: {
                    duration: 800,
                    easing: 'easeInOutQuart'
                }
            };

            // Add scales for charts that need them (bar and line charts)
            if (chartType === 'bar' || chartType === 'line') {
                baseOptions.scales = {
                    x: {
                        grid: { display: chartType === 'line' },
                        ticks: { color: '#6B7280', font: { size: 11 } }
                    },
                    y: {
                        beginAtZero: true,
                        grid: { color: '#E5E7EB', drawBorder: false },
                        ticks: { color: '#6B7280', font: { size: 11 } }
                    }
                };
            }

            // Special configurations for specific chart types
            if (chartType === 'doughnut') {
                baseOptions.cutout = '60%';
                baseOptions.plugins.legend.position = 'right';
            }

            if (chartType === 'line') {
                baseOptions.interaction = {
                    intersect: false,
                    mode: 'index'
                };
                baseOptions.scales.x.grid.display = true;
                baseOptions.scales.x.grid.color = '#F3F4F6';
            }

            return baseOptions;
        },
        
        retryChart(index) {
            this.chartErrors.delete(index);
            this.loadedCharts.delete(index);
            this.createChart(index);
        },
        
        // Carousel Management with Random Intervals
        startCarousel() {
            this.scheduleNextSlide();
        },
        
        scheduleNextSlide() {
            if (this.carouselTimer) {
                clearTimeout(this.carouselTimer);
            }
            
            if (!this.carouselPaused) {
                // Use random interval between 6-12 seconds
                const randomInterval = this.randomIntervals[Math.floor(Math.random() * this.randomIntervals.length)];
                
                this.carouselTimer = setTimeout(() => {
                    this.nextSlide();
                    this.scheduleNextSlide();
                }, randomInterval);
            }
        },
        
        nextSlide() {
            this.currentSlide = (this.currentSlide + 1) % this.slideData.length;
            this.onSlideChange();
        },
        
        previousSlide() {
            this.currentSlide = this.currentSlide === 0 ? 
                this.slideData.length - 1 : this.currentSlide - 1;
            this.onSlideChange();
        },
        
        goToSlide(index) {
            if (index >= 0 && index < this.slideData.length && index !== this.currentSlide) {
                this.currentSlide = index;
                this.onSlideChange();
            }
        },
        
        onSlideChange() {
            setTimeout(() => {
                if (!this.chartLoaded(this.currentSlide)) {
                    this.createChart(this.currentSlide);
                }
            }, 300);
        },
        
        toggleCarousel() {
            this.carouselPaused = !this.carouselPaused;
            if (!this.carouselPaused) {
                this.scheduleNextSlide();
            } else if (this.carouselTimer) {
                clearTimeout(this.carouselTimer);
            }
        },
        
        // Data Management
        async refreshAllData() {
            if (this.isRefreshing) return;
            
            this.isRefreshing = true;
            try {
                await this.loadData();
                this.createChart(this.currentSlide);
                this.updateTime();
                console.log('Data refreshed successfully');
            } catch (error) {
                console.error('Refresh error:', error);
            } finally {
                this.isRefreshing = false;
            }
        },
        
        // Navigation Functions
        scrollToKPI() {
            document.getElementById('kpi-section')?.scrollIntoView({ 
                behavior: 'smooth', 
                block: 'start' 
            });
        },
        
        scrollToAnalytics() {
            document.getElementById('analytics-section')?.scrollIntoView({ 
                behavior: 'smooth', 
                block: 'start' 
            });
        },
        
        viewDetailedAnalysis(index) {
            const slide = this.slideData[index];
            console.log(`Opening detailed analysis for: ${slide.title}`);

            // Map carousel slides to their corresponding detailed analysis pages
            const analysisUrls = [
                '/demografi',           // 0: Analisis Demografi Graduan
                '/sosioekonomi',        // 1: Status Sosioekonomi Graduan
                '/graduan-luar',        // 2: Graduan Bekerja Luar Bidang
                '/sektor-gaji',         // 3: Analisis Sektor dan Struktur Gaji
                '/intern',              // 4: Program Latihan dan Pembangunan
                '/status-pekerjaan',    // 5: Status dan Corak Pekerjaan
                '/graduan-bidang',      // 6: Trend Bidang Pengajian
                '/gig-economy',         // 7: Ekonomi Digital dan Masa Depan Kerja
                '/faktor-graduan',      // 8: Faktor-faktor Kebolehpasaran
                '/dashboard'            // 9: Integrasi Strategik dan Wawasan
            ];

            // Navigate to the corresponding detailed analysis page
            if (index >= 0 && index < analysisUrls.length) {
                window.location.href = analysisUrls[index];
            } else {
                console.error(`Invalid slide index: ${index}`);
            }
        },
        
        // Event Listeners
        setupEventListeners() {
            document.addEventListener('keydown', (e) => {
                if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
                
                switch(e.key) {
                    case 'ArrowLeft':
                    case 'ArrowUp':
                        e.preventDefault();
                        this.previousSlide();
                        break;
                    case 'ArrowRight':
                    case 'ArrowDown':
                        e.preventDefault();
                        this.nextSlide();
                        break;
                    case ' ':
                    case 'k':
                        e.preventDefault();
                        this.toggleCarousel();
                        break;
                    case 'r':
                        e.preventDefault();
                        this.refreshAllData();
                        break;
                    case 'Home':
                        e.preventDefault();
                        this.goToSlide(0);
                        break;
                    case 'End':
                        e.preventDefault();
                        this.goToSlide(this.slideData.length - 1);
                        break;
                    default:
                        const num = parseInt(e.key);
                        if (!isNaN(num)) {
                            e.preventDefault();
                            const slideIndex = num === 0 ? 9 : num - 1;
                            if (slideIndex < this.slideData.length) {
                                this.goToSlide(slideIndex);
                            }
                        }
                        break;
                }
            });
            
            // Handle window resize
            window.addEventListener('resize', () => {
                this.loadedCharts.forEach(index => {
                    const chart = window.DashboardCharts.get(`chart-${index}`);
                    if (chart) {
                        chart.resize();
                    }
                });
            });
        },

        navigateToFieldAlignment() {
            // Navigate to Status Pekerjaan page with field alignment focus
            console.log('Navigating to field alignment analysis...');
            window.location.href = '/status-pekerjaan';
        }
    }));
});

console.log('Dashboard Korporat Malaysia - Loaded Successfully');
</script>
{% endblock %}